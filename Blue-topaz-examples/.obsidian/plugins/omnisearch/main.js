/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Fc=Object.create;var Fr=Object.defineProperty,Ec=Object.defineProperties,Tc=Object.getOwnPropertyDescriptor,Dc=Object.getOwnPropertyDescriptors,Oc=Object.getOwnPropertyNames,io=Object.getOwnPropertySymbols,kc=Object.getPrototypeOf,so=Object.prototype.hasOwnProperty,Ic=Object.prototype.propertyIsEnumerable;var oo=(t,e,r)=>e in t?Fr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e)=>{for(var r in e||(e={}))so.call(e,r)&&oo(t,r,e[r]);if(io)for(var r of io(e))Ic.call(e,r)&&oo(t,r,e[r]);return t},je=(t,e)=>Ec(t,Dc(e)),ao=t=>Fr(t,"__esModule",{value:!0});var uo=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Pc=(t,e)=>{ao(t);for(var r in e)Fr(t,r,{get:e[r],enumerable:!0})},Mc=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Oc(e))!so.call(t,n)&&n!=="default"&&Fr(t,n,{get:()=>e[n],enumerable:!(r=Tc(e,n))||r.enumerable});return t},Ae=t=>Mc(ao(Fr(t!=null?Fc(kc(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var xa=uo((Zr,js)=>{(function(t,e){if(typeof Zr=="object"&&typeof js=="object")js.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var r=e();for(var n in r)(typeof Zr=="object"?Zr:t)[n]=r[n]}})(typeof self!="undefined"?self:Zr,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(n,i,s){r.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:s})},r.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,i){if(1&i&&(n=r(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var o in n)r.d(s,o,function(a){return n[a]}.bind(null,o));return s},r.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(i,"a",i),i},r.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"md5",function(){return w});var n="0123456789abcdef".split(""),i=function(b){for(var f="",y=0;y<4;y++)f+=n[b>>8*y+4&15]+n[b>>8*y&15];return f},s=function(b){for(var f=b.length,y=0;y<f;y++)b[y]=i(b[y]);return b.join("")},o=function(b,f){return b+f&4294967295},a=function(b,f,y,p,m,v,x){return function(j,C,E){return o(j<<C|j>>>32-C,E)}(f=function(j,C,E,T){return C=o(o(C,j),o(E,T))}(b,f,p,v),m,y)},l=function(b,f,y,p,m,v,x,j){return a(y&p|~y&m,f,y,v,x,j,b)},u=function(b,f,y,p,m,v,x,j){return a(y&m|p&~m,f,y,v,x,j,b)},c=function(b,f,y,p,m,v,x,j){return a(y^p^m,f,y,v,x,j,b)},h=function(b,f,y,p,m,v,x,j){return a(p^(y|~m),f,y,v,x,j,b)},d=function(b,f,y){y===void 0&&(y=o);var p=b[0],m=b[1],v=b[2],x=b[3],j=l.bind(null,y);p=j(p,m,v,x,f[0],7,-680876936),x=j(x,p,m,v,f[1],12,-389564586),v=j(v,x,p,m,f[2],17,606105819),m=j(m,v,x,p,f[3],22,-1044525330),p=j(p,m,v,x,f[4],7,-176418897),x=j(x,p,m,v,f[5],12,1200080426),v=j(v,x,p,m,f[6],17,-1473231341),m=j(m,v,x,p,f[7],22,-45705983),p=j(p,m,v,x,f[8],7,1770035416),x=j(x,p,m,v,f[9],12,-1958414417),v=j(v,x,p,m,f[10],17,-42063),m=j(m,v,x,p,f[11],22,-1990404162),p=j(p,m,v,x,f[12],7,1804603682),x=j(x,p,m,v,f[13],12,-40341101),v=j(v,x,p,m,f[14],17,-1502002290),m=j(m,v,x,p,f[15],22,1236535329);var C=u.bind(null,y);p=C(p,m,v,x,f[1],5,-165796510),x=C(x,p,m,v,f[6],9,-1069501632),v=C(v,x,p,m,f[11],14,643717713),m=C(m,v,x,p,f[0],20,-373897302),p=C(p,m,v,x,f[5],5,-701558691),x=C(x,p,m,v,f[10],9,38016083),v=C(v,x,p,m,f[15],14,-660478335),m=C(m,v,x,p,f[4],20,-405537848),p=C(p,m,v,x,f[9],5,568446438),x=C(x,p,m,v,f[14],9,-1019803690),v=C(v,x,p,m,f[3],14,-187363961),m=C(m,v,x,p,f[8],20,1163531501),p=C(p,m,v,x,f[13],5,-1444681467),x=C(x,p,m,v,f[2],9,-51403784),v=C(v,x,p,m,f[7],14,1735328473),m=C(m,v,x,p,f[12],20,-1926607734);var E=c.bind(null,y);p=E(p,m,v,x,f[5],4,-378558),x=E(x,p,m,v,f[8],11,-2022574463),v=E(v,x,p,m,f[11],16,1839030562),m=E(m,v,x,p,f[14],23,-35309556),p=E(p,m,v,x,f[1],4,-1530992060),x=E(x,p,m,v,f[4],11,1272893353),v=E(v,x,p,m,f[7],16,-155497632),m=E(m,v,x,p,f[10],23,-1094730640),p=E(p,m,v,x,f[13],4,681279174),x=E(x,p,m,v,f[0],11,-358537222),v=E(v,x,p,m,f[3],16,-722521979),m=E(m,v,x,p,f[6],23,76029189),p=E(p,m,v,x,f[9],4,-640364487),x=E(x,p,m,v,f[12],11,-421815835),v=E(v,x,p,m,f[15],16,530742520),m=E(m,v,x,p,f[2],23,-995338651);var T=h.bind(null,y);p=T(p,m,v,x,f[0],6,-198630844),x=T(x,p,m,v,f[7],10,1126891415),v=T(v,x,p,m,f[14],15,-1416354905),m=T(m,v,x,p,f[5],21,-57434055),p=T(p,m,v,x,f[12],6,1700485571),x=T(x,p,m,v,f[3],10,-1894986606),v=T(v,x,p,m,f[10],15,-1051523),m=T(m,v,x,p,f[1],21,-2054922799),p=T(p,m,v,x,f[8],6,1873313359),x=T(x,p,m,v,f[15],10,-30611744),v=T(v,x,p,m,f[6],15,-1560198380),m=T(m,v,x,p,f[13],21,1309151649),p=T(p,m,v,x,f[4],6,-145523070),x=T(x,p,m,v,f[11],10,-1120210379),v=T(v,x,p,m,f[2],15,718787259),m=T(m,v,x,p,f[9],21,-343485551),b[0]=y(p,b[0]),b[1]=y(m,b[1]),b[2]=y(v,b[2]),b[3]=y(x,b[3])},g=function(b){for(var f=[],y=0;y<64;y+=4)f[y>>2]=b.charCodeAt(y)+(b.charCodeAt(y+1)<<8)+(b.charCodeAt(y+2)<<16)+(b.charCodeAt(y+3)<<24);return f},_=function(b,f){var y,p=b.length,m=[1732584193,-271733879,-1732584194,271733878];for(y=64;y<=p;y+=64)d(m,g(b.substring(y-64,y)),f);var v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=(b=b.substring(y-64)).length;for(y=0;y<x;y++)v[y>>2]|=b.charCodeAt(y)<<(y%4<<3);if(v[y>>2]|=128<<(y%4<<3),y>55)for(d(m,v,f),y=16;y--;)v[y]=0;return v[14]=8*p,d(m,v,f),m};function w(b){var f;return s(_("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(f=function(y,p){var m=(65535&y)+(65535&p);return(y>>16)+(p>>16)+(m>>16)<<16|65535&m}),s(_(b,f))}}])})});var uc=uo(gi=>{function eo(t){return eo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eo(t)}(function(t,e){if(typeof define=="function"&&define.amd)define(["exports"],e);else if(typeof gi!="undefined")e(gi);else{var r={exports:{}};e(r.exports),t.CancelablePromise=r.exports}})(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:gi,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancelablePromise=void 0,t.cancelable=B,t.default=void 0,t.isCancelablePromise=O;function e(A,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(S&&S.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),Object.defineProperty(A,"prototype",{writable:!1}),S&&r(A,S)}function r(A,S){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(k,Q){return k.__proto__=Q,k},r(A,S)}function n(A){var S=o();return function(){var k=a(A),Q;if(S){var se=a(this).constructor;Q=Reflect.construct(k,arguments,se)}else Q=k.apply(this,arguments);return i(this,Q)}}function i(A,S){if(S&&(eo(S)==="object"||typeof S=="function"))return S;if(S!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s(A)}function s(A){if(A===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}function o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(A){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(F){return F.__proto__||Object.getPrototypeOf(F)},a(A)}function l(A,S){var F=typeof Symbol!="undefined"&&A[Symbol.iterator]||A["@@iterator"];if(!F){if(Array.isArray(A)||(F=u(A))||S&&A&&typeof A.length=="number"){F&&(A=F);var k=0,Q=function(){};return{s:Q,n:function(){return k>=A.length?{done:!0}:{done:!1,value:A[k++]}},e:function(We){throw We},f:Q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var se=!0,Oe=!1,un;return{s:function(){F=F.call(A)},n:function(){var We=F.next();return se=We.done,We},e:function(We){Oe=!0,un=We},f:function(){try{!se&&F.return!=null&&F.return()}finally{if(Oe)throw un}}}}function u(A,S){if(!!A){if(typeof A=="string")return c(A,S);var F=Object.prototype.toString.call(A).slice(8,-1);if(F==="Object"&&A.constructor&&(F=A.constructor.name),F==="Map"||F==="Set")return Array.from(A);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return c(A,S)}}function c(A,S){(S==null||S>A.length)&&(S=A.length);for(var F=0,k=new Array(S);F<S;F++)k[F]=A[F];return k}function h(A,S){if(!(A instanceof S))throw new TypeError("Cannot call a class as a function")}function d(A,S){for(var F=0;F<S.length;F++){var k=S[F];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(A,k.key,k)}}function g(A,S,F){return S&&d(A.prototype,S),F&&d(A,F),Object.defineProperty(A,"prototype",{writable:!1}),A}function _(A,S,F){return S in A?Object.defineProperty(A,S,{value:F,enumerable:!0,configurable:!0,writable:!0}):A[S]=F,A}function w(A,S,F){b(A,S),S.set(A,F)}function b(A,S){if(S.has(A))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(A,S){var F=m(A,S,"get");return y(A,F)}function y(A,S){return S.get?S.get.call(A):S.value}function p(A,S,F){var k=m(A,S,"set");return v(A,k,F),F}function m(A,S,F){if(!S.has(A))throw new TypeError("attempted to "+F+" private field on non-instance");return S.get(A)}function v(A,S,F){if(S.set)S.set.call(A,F);else{if(!S.writable)throw new TypeError("attempted to set read only private field");S.value=F}}var x=typeof Symbol!="undefined"?Symbol.toStringTag:"@@toStringTag",j=new WeakMap,C=new WeakMap,E=function(){function A(S){var F=S.executor,k=F===void 0?function(){}:F,Q=S.internals,se=Q===void 0?D():Q,Oe=S.promise,un=Oe===void 0?new Promise(function(He,We){return k(He,We,function(vi){se.onCancelList.push(vi)})}):Oe;h(this,A),w(this,j,{writable:!0,value:void 0}),w(this,C,{writable:!0,value:void 0}),_(this,x,"CancelablePromise"),this.cancel=this.cancel.bind(this),p(this,j,se),p(this,C,un||new Promise(function(He,We){return k(He,We,function(vi){se.onCancelList.push(vi)})}))}return g(A,[{key:"then",value:function(F,k){return Y(f(this,C).then(K(F,f(this,j)),K(k,f(this,j))),f(this,j))}},{key:"catch",value:function(F){return Y(f(this,C).catch(K(F,f(this,j))),f(this,j))}},{key:"finally",value:function(F,k){var Q=this;return k&&f(this,j).onCancelList.push(F),Y(f(this,C).finally(K(function(){if(F)return k&&(f(Q,j).onCancelList=f(Q,j).onCancelList.filter(function(se){return se!==F})),F()},f(this,j))),f(this,j))}},{key:"cancel",value:function(){f(this,j).isCanceled=!0;var F=f(this,j).onCancelList;f(this,j).onCancelList=[];var k=l(F),Q;try{for(k.s();!(Q=k.n()).done;){var se=Q.value;if(typeof se=="function")try{se()}catch(Oe){console.error(Oe)}}}catch(Oe){k.e(Oe)}finally{k.f()}}},{key:"isCanceled",value:function(){return f(this,j).isCanceled===!0}}]),A}(),T=function(A){e(F,A);var S=n(F);function F(k){return h(this,F),S.call(this,{executor:k})}return g(F)}(E);t.CancelablePromise=T,_(T,"all",function(S){return U(S,Promise.all(S))}),_(T,"allSettled",function(S){return U(S,Promise.allSettled(S))}),_(T,"any",function(S){return U(S,Promise.any(S))}),_(T,"race",function(S){return U(S,Promise.race(S))}),_(T,"resolve",function(S){return B(Promise.resolve(S))}),_(T,"reject",function(S){return B(Promise.reject(S))}),_(T,"isCancelable",O);var I=T;t.default=I;function B(A){return Y(A,D())}function O(A){return A instanceof T||A instanceof E}function K(A,S){if(A)return function(F){if(!S.isCanceled){var k=A(F);return O(k)&&S.onCancelList.push(k.cancel),k}return F}}function Y(A,S){return new E({internals:S,promise:A})}function U(A,S){var F=D();return F.onCancelList.push(function(){var k=l(A),Q;try{for(k.s();!(Q=k.n()).done;){var se=Q.value;O(se)&&se.cancel()}}catch(Oe){k.e(Oe)}finally{k.f()}}),new E({internals:F,promise:S})}function D(){return{isCanceled:!1,onCancelList:[]}}})});Pc(exports,{default:()=>no});var Cr=Ae(require("obsidian"));var Ac=Ae(require("obsidian"));function ae(){}function Rc(t,e){for(let r in e)t[r]=e[r];return t}function _i(t){return t()}function lo(){return Object.create(null)}function Ne(t){t.forEach(_i)}function $t(t){return typeof t=="function"}function he(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var ln;function bi(t,e){return ln||(ln=document.createElement("a")),ln.href=e,t===ln.href}function co(t){return Object.keys(t).length===0}function fo(t,...e){if(t==null)return ae;let r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}function cn(t,e,r){t.$$.on_destroy.push(fo(e,r))}function Ut(t,e,r,n){if(t){let i=ho(t,e,r,n);return t[0](i)}}function ho(t,e,r,n){return t[1]&&n?Rc(r.ctx.slice(),t[1](n(e))):r.ctx}function Gt(t,e,r,n){if(t[2]&&n){let i=t[2](n(r));if(e.dirty===void 0)return i;if(typeof i=="object"){let s=[],o=Math.max(e.dirty.length,i.length);for(let a=0;a<o;a+=1)s[a]=e.dirty[a]|i[a];return s}return e.dirty|i}return e.dirty}function qt(t,e,r,n,i,s){if(i){let o=ho(e,r,n,s);t.p(o,i)}}function Qt(t){if(t.ctx.length>32){let e=[],r=t.ctx.length/32;for(let n=0;n<r;n++)e[n]=-1;return e}return-1}function po(t){return t&&$t(t.destroy)?t.destroy:ae}var mo=!1;function Bc(){mo=!0}function Lc(){mo=!1}function R(t,e){t.appendChild(e)}function W(t,e,r){t.insertBefore(e,r||null)}function H(t){t.parentNode&&t.parentNode.removeChild(t)}function fn(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function L(t){return document.createElement(t)}function Be(t){return document.createTextNode(t)}function q(){return Be(" ")}function Yt(){return Be("")}function ke(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}function z(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function Nc(t){return Array.from(t.childNodes)}function Jt(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function xi(t,e){t.value=e??""}function Ie(t,e,r,n){r===null?t.style.removeProperty(e):t.style.setProperty(e,r,n?"important":"")}function wi(t,e,r){t.classList[r?"add":"remove"](e)}function Kc(t,e,{bubbles:r=!1,cancelable:n=!1}={}){let i=document.createEvent("CustomEvent");return i.initCustomEvent(t,r,n,e),i}var Er;function Tr(t){Er=t}function ji(){if(!Er)throw new Error("Function called outside component initialization");return Er}function Dr(t){ji().$$.on_mount.push(t)}function Or(t){ji().$$.on_destroy.push(t)}function Ai(){let t=ji();return(e,r,{cancelable:n=!1}={})=>{let i=t.$$.callbacks[e];if(i){let s=Kc(e,r,{cancelable:n});return i.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function $e(t,e){let r=t.$$.callbacks[e.type];r&&r.slice().forEach(n=>n.call(this,e))}var kr=[];var lt=[],dn=[],go=[],yo=Promise.resolve(),Si=!1;function vo(){Si||(Si=!0,yo.then(_o))}function ct(){return vo(),yo}function Ci(t){dn.push(t)}var Fi=new Set,hn=0;function _o(){let t=Er;do{for(;hn<kr.length;){let e=kr[hn];hn++,Tr(e),zc(e.$$)}for(Tr(null),kr.length=0,hn=0;lt.length;)lt.pop()();for(let e=0;e<dn.length;e+=1){let r=dn[e];Fi.has(r)||(Fi.add(r),r())}dn.length=0}while(kr.length);for(;go.length;)go.pop()();Si=!1,Fi.clear(),Tr(t)}function zc(t){if(t.fragment!==null){t.update(),Ne(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ci)}}var pn=new Set,Dt;function Ot(){Dt={r:0,c:[],p:Dt}}function kt(){Dt.r||Ne(Dt.c),Dt=Dt.p}function J(t,e){t&&t.i&&(pn.delete(t),t.i(e))}function Z(t,e,r,n){if(t&&t.o){if(pn.has(t))return;pn.add(t),Dt.c.push(()=>{pn.delete(t),n&&(r&&t.d(1),n())}),t.o(e)}else n&&n()}var Ry=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function Te(t){t&&t.c()}function Se(t,e,r,n){let{fragment:i,after_update:s}=t.$$;i&&i.m(e,r),n||Ci(()=>{let o=t.$$.on_mount.map(_i).filter($t);t.$$.on_destroy?t.$$.on_destroy.push(...o):Ne(o),t.$$.on_mount=[]}),s.forEach(Ci)}function _e(t,e){let r=t.$$;r.fragment!==null&&(Ne(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function Vc(t,e){t.$$.dirty[0]===-1&&(kr.push(t),vo(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function be(t,e,r,n,i,s,o,a=[-1]){let l=Er;Tr(t);let u=t.$$={fragment:null,ctx:[],props:s,update:ae,not_equal:i,bound:lo(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:lo(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(u.root);let c=!1;if(u.ctx=r?r(t,e.props||{},(h,d,...g)=>{let _=g.length?g[0]:d;return u.ctx&&i(u.ctx[h],u.ctx[h]=_)&&(!u.skip_bound&&u.bound[h]&&u.bound[h](_),c&&Vc(t,h)),d}):[],u.update(),c=!0,Ne(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){Bc();let h=Nc(e.target);u.fragment&&u.fragment.l(h),h.forEach(H)}else u.fragment&&u.fragment.c();e.intro&&J(t.$$.fragment),Se(t,e.target,e.anchor,e.customElement),Lc(),_o()}Tr(l)}var Hc;typeof HTMLElement=="function"&&(Hc=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(_i).filter($t);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,r){this[t]=r}disconnectedCallback(){Ne(this.$$.on_disconnect)}$destroy(){_e(this,1),this.$destroy=ae}$on(t,e){if(!$t(e))return ae;let r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{let n=r.indexOf(e);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!co(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var ge=class{$destroy(){_e(this,1),this.$destroy=ae}$on(e,r){if(!$t(r))return ae;let n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{let i=n.indexOf(r);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!co(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Tt=Ae(require("obsidian"));var Pa=Ae(require("obsidian"));var Ei=class{constructor(){this.handlers=new Map;this.disabled=[]}on(e,r,n){if(e.includes("@")||r.includes("@"))throw new Error("Invalid context/event name - Cannot contain @");this.handlers.set(`${e}@${r}`,n)}off(e,r){if(r)this.handlers.delete(`${e}@${r}`);else for(let[n]of this.handlers.entries())n.startsWith(`${e}@`)&&this.handlers.delete(n)}disable(e){this.enable(e),this.disabled.push(e)}enable(e){this.disabled=this.disabled.filter(r=>r!==e)}emit(e,...r){let n=[...this.handlers.entries()].filter(([i,s])=>!this.disabled.includes(i.split("@")[0]));for(let[i,s]of n)i.endsWith(`@${e}`)&&s(...r)}};var Xt=[];function mn(t,e=ae){let r,n=new Set;function i(a){if(he(t,a)&&(t=a,r)){let l=!Xt.length;for(let u of n)u[1](),Xt.push(u,t);if(l){for(let u=0;u<Xt.length;u+=2)Xt[u][0](Xt[u+1]);Xt.length=0}}}function s(a){i(a(t))}function o(a,l=ae){let u=[a,l];return n.add(u),n.size===1&&(r=e(i)||ae),a(t),()=>{n.delete(u),n.size===0&&(r(),r=null)}}return{set:i,update:s,subscribe:o}}var X=Ae(require("obsidian"));var te=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,le=Object.keys,xe=Array.isArray;typeof Promise!="undefined"&&!te.Promise&&(te.Promise=Promise);function Ce(t,e){return typeof e!="object"||le(e).forEach(function(r){t[r]=e[r]}),t}var Ir=Object.getPrototypeOf,Wc={}.hasOwnProperty;function Pe(t,e){return Wc.call(t,e)}function Zt(t,e){typeof e=="function"&&(e=e(Ir(t))),(typeof Reflect=="undefined"?le:Reflect.ownKeys)(e).forEach(r=>{Ye(t,r,e[r])})}var bo=Object.defineProperty;function Ye(t,e,r,n){bo(t,e,Ce(r&&Pe(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function er(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Ye(t.prototype,"constructor",t),{extend:Zt.bind(null,t.prototype)}}}}var $c=Object.getOwnPropertyDescriptor;function Ti(t,e){let r=$c(t,e),n;return r||(n=Ir(t))&&Ti(n,e)}var Uc=[].slice;function gn(t,e,r){return Uc.call(t,e,r)}function xo(t,e){return e(t)}function Pr(t){if(!t)throw new Error("Assertion Failed")}function wo(t){te.setImmediate?setImmediate(t):setTimeout(t,0)}function jo(t,e){return t.reduce((r,n,i)=>{var s=e(n,i);return s&&(r[s[0]]=s[1]),r},{})}function Gc(t,e,r){try{t.apply(null,r)}catch(n){e&&e(n)}}function Je(t,e){if(Pe(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],n=0,i=e.length;n<i;++n){var s=Je(t,e[n]);r.push(s)}return r}var o=e.indexOf(".");if(o!==-1){var a=t[e.substr(0,o)];return a===void 0?void 0:Je(a,e.substr(o+1))}}function Ke(t,e,r){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Pr(typeof r!="string"&&"length"in r);for(var n=0,i=e.length;n<i;++n)Ke(t,e[n],r[n])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")r===void 0?xe(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=r;else{var l=t[o];(!l||!Pe(t,o))&&(l=t[o]={}),Ke(l,a,r)}}else r===void 0?xe(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function qc(t,e){typeof e=="string"?Ke(t,e,void 0):"length"in e&&[].map.call(e,function(r){Ke(t,r,void 0)})}function Ao(t){var e={};for(var r in t)Pe(t,r)&&(e[r]=t[r]);return e}var Qc=[].concat;function So(t){return Qc.apply([],t)}var Co="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(So([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>te[t]),Yc=Co.map(t=>te[t]);jo(Co,t=>[t,!0]);var ft=null;function Mr(t){ft=typeof WeakMap!="undefined"&&new WeakMap;let e=Di(t);return ft=null,e}function Di(t){if(!t||typeof t!="object")return t;let e=ft&&ft.get(t);if(e)return e;if(xe(t)){e=[],ft&&ft.set(t,e);for(var r=0,n=t.length;r<n;++r)e.push(Di(t[r]))}else if(Yc.indexOf(t.constructor)>=0)e=t;else{let s=Ir(t);e=s===Object.prototype?{}:Object.create(s),ft&&ft.set(t,e);for(var i in t)Pe(t,i)&&(e[i]=Di(t[i]))}return e}var{toString:Jc}={};function Oi(t){return Jc.call(t).slice(8,-1)}var ki=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",Xc=typeof ki=="symbol"?function(t){var e;return t!=null&&(e=t[ki])&&e.apply(t)}:function(){return null},tr={};function Xe(t){var e,r,n,i;if(arguments.length===1){if(xe(t))return t.slice();if(this===tr&&typeof t=="string")return[t];if(i=Xc(t)){for(r=[];n=i.next(),!n.done;)r.push(n.value);return r}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(r=new Array(e);e--;)r[e]=t[e];return r}return[t]}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var Ii=typeof Symbol!="undefined"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1,Ue=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Fo(t,e){Ue=t,Eo=e}var Eo=()=>!0,Zc=!new Error("").stack;function It(){if(Zc)try{throw It.arguments,new Error}catch(t){return t}return new Error}function Pi(t,e){var r=t.stack;return r?(e=e||0,r.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),r.split(`
`).slice(e).filter(Eo).map(n=>`
`+n).join("")):""}var ef=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],To=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Mi=ef.concat(To),tf={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function rr(t,e){this._e=It(),this.name=t,this.message=e}er(rr).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Pi(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Do(t,e){return t+". Errors: "+Object.keys(e).map(r=>e[r].toString()).filter((r,n,i)=>i.indexOf(r)===n).join(`
`)}function yn(t,e,r,n){this._e=It(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=Do(t,e)}er(yn).from(rr);function Rr(t,e){this._e=It(),this.name="BulkError",this.failures=Object.keys(e).map(r=>e[r]),this.failuresByPos=e,this.message=Do(t,e)}er(Rr).from(rr);var Ri=Mi.reduce((t,e)=>(t[e]=e+"Error",t),{}),rf=rr,V=Mi.reduce((t,e)=>{var r=e+"Error";function n(i,s){this._e=It(),this.name=r,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=tf[e]||r,this.inner=null)}return er(n).from(rf),t[e]=n,t},{});V.Syntax=SyntaxError;V.Type=TypeError;V.Range=RangeError;var Oo=To.reduce((t,e)=>(t[e+"Error"]=V[e],t),{});function nf(t,e){if(!t||t instanceof rr||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Oo[t.name])return t;var r=new Oo[t.name](e||t.message,t);return"stack"in t&&Ye(r,"stack",{get:function(){return this.inner.stack}}),r}var vn=Mi.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=V[e]),t),{});vn.ModifyError=yn;vn.DexieError=rr;vn.BulkError=Rr;function ee(){}function Br(t){return t}function sf(t,e){return t==null||t===Br?e:function(r){return e(t(r))}}function Pt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function of(t,e){return t===ee?e:function(){var r=t.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?Pt(n,this.onsuccess):n),i&&(this.onerror=this.onerror?Pt(i,this.onerror):i),s!==void 0?s:r}}function af(t,e){return t===ee?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Pt(r,this.onsuccess):r),n&&(this.onerror=this.onerror?Pt(n,this.onerror):n)}}function uf(t,e){return t===ee?e:function(r){var n=t.apply(this,arguments);Ce(r,n);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Pt(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Pt(s,this.onerror):s),n===void 0?o===void 0?void 0:o:Ce(n,o)}}function lf(t,e){return t===ee?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function Bi(t,e){return t===ee?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return r.then(function(){return e.apply(n,s)})}return e.apply(this,arguments)}}var Lr={},cf=100,ff=20,ko=100,[Li,_n,Ni]=typeof Promise=="undefined"?[]:(()=>{let t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,Ir(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ir(e),t]})(),Io=_n&&_n.then,bn=Li&&Li.constructor,Ki=!!Ni,zi=!1,df=Ni?()=>{Ni.then(An)}:te.setImmediate?setImmediate.bind(null,An):te.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{An(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(An,0)},Nr=function(t,e){Kr.push([t,e]),xn&&(df(),xn=!1)},Vi=!0,xn=!0,Mt=[],wn=[],Hi=null,Wi=Br,nr={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ho,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Ho(t[0],t[1])}catch{}})}},N=nr,Kr=[],Rt=0,jn=[];function M(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ee,this._lib=!1;var e=this._PSD=N;if(Ue&&(this._stackHolder=It(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Lr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Ui(this,this._value);return}this._state=null,this._value=null,++e.ref,Mo(this,t)}var $i={get:function(){var t=N,e=Fn;function r(n,i){var s=!t.global&&(t!==N||e!==Fn);let o=s&&!Ze();var a=new M((l,u)=>{Gi(this,new Po(Tn(n,t,s,o),Tn(i,t,s,o),l,u,t))});return Ue&&Lo(a,this),a}return r.prototype=Lr,r},set:function(t){Ye(this,"then",t&&t.prototype===Lr?$i:{get:function(){return t},set:$i.set})}};Zt(M.prototype,{then:$i,_then:function(t,e){Gi(this,new Po(null,null,t,e,N))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],r=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?r(n):Sn(n)):this.then(null,n=>n&&n.name===e?r(n):Sn(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Sn(e)))},stack:{get:function(){if(this._stack)return this._stack;try{zi=!0;var t=Bo(this,[],ff),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{zi=!1}}},timeout:function(t,e){return t<1/0?new M((r,n)=>{var i=setTimeout(()=>n(new V.Timeout(e)),t);this.then(r,n).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&Ye(M.prototype,Symbol.toStringTag,"Dexie.Promise");nr.env=No();function Po(t,e,r,n,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=n,this.psd=i}Zt(M,{all:function(){var t=Xe.apply(null,arguments).map(En);return new M(function(e,r){t.length===0&&e([]);var n=t.length;t.forEach((i,s)=>M.resolve(i).then(o=>{t[s]=o,--n||e(t)},r))})},resolve:t=>{if(t instanceof M)return t;if(t&&typeof t.then=="function")return new M((r,n)=>{t.then(r,n)});var e=new M(Lr,!0,t);return Lo(e,Hi),e},reject:Sn,race:function(){var t=Xe.apply(null,arguments).map(En);return new M((e,r)=>{t.map(n=>M.resolve(n).then(e,r))})},PSD:{get:()=>N,set:t=>N=t},totalEchoes:{get:()=>Fn},newPSD:dt,usePSD:sr,scheduler:{get:()=>Nr,set:t=>{Nr=t}},rejectionMapper:{get:()=>Wi,set:t=>{Wi=t}},follow:(t,e)=>new M((r,n)=>dt((i,s)=>{var o=N;o.unhandleds=[],o.onunhandled=s,o.finalize=Pt(function(){pf(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),t()},e,r,n))});bn&&(bn.allSettled&&Ye(M,"allSettled",function(){let t=Xe.apply(null,arguments).map(En);return new M(e=>{t.length===0&&e([]);let r=t.length,n=new Array(r);t.forEach((i,s)=>M.resolve(i).then(o=>n[s]={status:"fulfilled",value:o},o=>n[s]={status:"rejected",reason:o}).then(()=>--r||e(n)))})}),bn.any&&typeof AggregateError!="undefined"&&Ye(M,"any",function(){let t=Xe.apply(null,arguments).map(En);return new M((e,r)=>{t.length===0&&r(new AggregateError([]));let n=t.length,i=new Array(n);t.forEach((s,o)=>M.resolve(s).then(a=>e(a),a=>{i[o]=a,--n||r(new AggregateError(i))}))})}));function Mo(t,e){try{e(r=>{if(t._state===null){if(r===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&zr();r&&typeof r.then=="function"?Mo(t,(i,s)=>{r instanceof M?r._then(i,s):r.then(i,s)}):(t._state=!0,t._value=r,Ro(t)),n&&Vr()}},Ui.bind(null,t))}catch(r){Ui(t,r)}}function Ui(t,e){if(wn.push(e),t._state===null){var r=t._lib&&zr();e=Wi(e),t._state=!1,t._value=e,Ue&&e!==null&&typeof e=="object"&&!e._promise&&Gc(()=>{var n=Ti(e,"stack");e._promise=t,Ye(e,"stack",{get:()=>zi?n&&(n.get?n.get.apply(e):n.value):t.stack})}),mf(t),Ro(t),r&&Vr()}}function Ro(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)Gi(t,e[r]);var i=t._PSD;--i.ref||i.finalize(),Rt===0&&(++Rt,Nr(()=>{--Rt==0&&qi()},[]))}function Gi(t,e){if(t._state===null){t._listeners.push(e);return}var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Rt,Nr(hf,[r,t,e])}function hf(t,e,r){try{Hi=e;var n,i=e._value;e._state?n=t(i):(wn.length&&(wn=[]),n=t(i),wn.indexOf(i)===-1&&gf(e)),r.resolve(n)}catch(s){r.reject(s)}finally{Hi=null,--Rt==0&&qi(),--r.psd.ref||r.psd.finalize()}}function Bo(t,e,r){if(e.length===r)return e;var n="";if(t._state===!1){var i=t._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,n=Pi(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+n)}return Ue&&(n=Pi(t._stackHolder,2),n&&e.indexOf(n)===-1&&e.push(n),t._prev&&Bo(t._prev,e,r)),e}function Lo(t,e){var r=e?e._numPrev+1:0;r<cf&&(t._prev=e,t._numPrev=r)}function An(){zr()&&Vr()}function zr(){var t=Vi;return Vi=!1,xn=!1,t}function Vr(){var t,e,r;do for(;Kr.length>0;)for(t=Kr,Kr=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}while(Kr.length>0);Vi=!0,xn=!0}function qi(){var t=Mt;Mt=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=jn.slice(0),r=e.length;r;)e[--r]()}function pf(t){function e(){t(),jn.splice(jn.indexOf(e),1)}jn.push(e),++Rt,Nr(()=>{--Rt==0&&qi()},[])}function mf(t){Mt.some(e=>e._value===t._value)||Mt.push(t)}function gf(t){for(var e=Mt.length;e;)if(Mt[--e]._value===t._value){Mt.splice(e,1);return}}function Sn(t){return new M(Lr,!1,t)}function ne(t,e){var r=N;return function(){var n=zr(),i=N;try{return ht(r,!0),t.apply(this,arguments)}catch(s){e&&e(s)}finally{ht(i,!1),n&&Vr()}}}var we={awaits:0,echoes:0,id:0},yf=0,Cn=[],Qi=0,Fn=0,vf=0;function dt(t,e,r,n){var i=N,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++vf;var o=nr.env;s.env=Ki?{Promise:M,PromiseProp:{value:M,configurable:!0,writable:!0},all:M.all,race:M.race,allSettled:M.allSettled,any:M.any,resolve:M.resolve,reject:M.reject,nthen:zo(o.nthen,s),gthen:zo(o.gthen,s)}:{},e&&Ce(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=sr(s,t,r,n);return s.ref===0&&s.finalize(),a}function ir(){return we.id||(we.id=++yf),++we.awaits,we.echoes+=ko,we.id}function Ze(){return we.awaits?(--we.awaits==0&&(we.id=0),we.echoes=we.awaits*ko,!0):!1}(""+Io).indexOf("[native code]")===-1&&(ir=Ze=ee);function En(t){return we.echoes&&t&&t.constructor===bn?(ir(),t.then(e=>(Ze(),e),e=>(Ze(),fe(e)))):t}function _f(t){++Fn,(!we.echoes||--we.echoes==0)&&(we.echoes=we.id=0),Cn.push(N),ht(t,!0)}function bf(){var t=Cn[Cn.length-1];Cn.pop(),ht(t,!1)}function ht(t,e){var r=N;if((e?we.echoes&&(!Qi++||t!==N):Qi&&(!--Qi||t!==N))&&Ko(e?_f.bind(null,t):bf),t!==N&&(N=t,r===nr&&(nr.env=No()),Ki)){var n=nr.env.Promise,i=t.env;_n.then=i.nthen,n.prototype.then=i.gthen,(r.global||t.global)&&(Object.defineProperty(te,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function No(){var t=te.Promise;return Ki?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(te,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:_n.then,gthen:t.prototype.then}:{}}function sr(t,e,r,n,i){var s=N;try{return ht(t,!0),e(r,n,i)}finally{ht(s,!1)}}function Ko(t){Io.call(Li,t)}function Tn(t,e,r,n){return typeof t!="function"?t:function(){var i=N;r&&ir(),ht(e,!0);try{return t.apply(this,arguments)}finally{ht(i,!1),n&&Ko(Ze)}}}function zo(t,e){return function(r,n){return t.call(this,Tn(r,e),Tn(n,e))}}var Vo="unhandledrejection";function Ho(t,e){var r;try{r=e.onuncatched(t)}catch{}if(r!==!1)try{var n,i={promise:e,reason:t};if(te.document&&document.createEvent?(n=document.createEvent("Event"),n.initEvent(Vo,!0,!0),Ce(n,i)):te.CustomEvent&&(n=new CustomEvent(Vo,{detail:i}),Ce(n,i)),n&&te.dispatchEvent&&(dispatchEvent(n),!te.PromiseRejectionEvent&&te.onunhandledrejection))try{te.onunhandledrejection(n)}catch{}Ue&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var fe=M.reject;function Yi(t,e,r,n){if(!t.idbdb||!t._state.openComplete&&!N.letThrough&&!t._vip){if(t._state.openComplete)return fe(new V.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return fe(new V.DatabaseClosed);t.open().catch(ee)}return t._state.dbReadyPromise.then(()=>Yi(t,e,r,n))}else{var i=t._createTransaction(e,r,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===Ri.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Yi(t,e,r,n))):fe(s)}return i._promise(e,(s,o)=>dt(()=>(N.trans=i,n(s,o,i)))).then(s=>i._completion.then(()=>s))}}var Wo="3.2.2",Bt=String.fromCharCode(65535),Ji=-1/0,et="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",$o="String expected.",Hr=[],Dn=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),xf=Dn,wf=Dn,Uo=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),On="__dbnames",Xi="readonly",Zi="readwrite";function Lt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Go={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function kn(t){return typeof t=="string"&&!/\./.test(t)?e=>(e[t]===void 0&&t in e&&(e=Mr(e),delete e[t]),e):e=>e}var qo=class{_trans(e,r,n){let i=this._tx||N.trans,s=this.name;function o(l,u,c){if(!c.schema[s])throw new V.NotFound("Table "+s+" not part of transaction");return r(c.idbtrans,c)}let a=zr();try{return i&&i.db===this.db?i===N.trans?i._promise(e,o,n):dt(()=>i._promise(e,o,n),{trans:i,transless:N.transless||N}):Yi(this.db,e,[this.name],o)}finally{a&&Vr()}}get(e,r){return e&&e.constructor===Object?this.where(e).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(i=>this.hook.reading.fire(i))).then(r)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(xe(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let r=le(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);let n=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&r.every(c=>u.keyPath.indexOf(c)>=0)&&u.keyPath.every(c=>r.indexOf(c)>=0))[0];if(n&&this.db._maxKey!==Bt)return this.where(n.name).equals(n.keyPath.map(u=>e[u]));!n&&Ue&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);let{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(u,c){try{return s.cmp(u,c)===0}catch{return!1}}let[a,l]=r.reduce(([u,c],h)=>{let d=i[h],g=e[h];return[u||d,u||!d?Lt(c,d&&d.multi?_=>{let w=Je(_,h);return xe(w)&&w.some(b=>o(g,b))}:_=>o(g,Je(_,h))):c]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):n?this.filter(l):this.where(r).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,xe(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let r=n=>{if(!n)return n;let i=Object.create(e.prototype);for(var s in n)if(Pe(n,s))try{i[s]=n[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e}defineClass(){function e(r){Ce(this,r)}return this.mapToClass(e)}add(e,r){let{auto:n,keyPath:i}=this.schema.primKey,s=e;return i&&n&&(s=kn(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:r!=null?[r]:null,values:[s]})).then(o=>o.numFailures?M.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Ke(e,i,o)}catch{}return o})}update(e,r){if(typeof e=="object"&&!xe(e)){let n=Je(e,this.schema.primKey.keyPath);if(n===void 0)return fe(new V.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?le(r).forEach(i=>{Ke(e,i,r[i])}):r(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}else return this.where(":id").equals(e).modify(r)}put(e,r){let{auto:n,keyPath:i}=this.schema.primKey,s=e;return i&&n&&(s=kn(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:r!=null?[r]:null})).then(o=>o.numFailures?M.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Ke(e,i,o)}catch{}return o})}delete(e){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[e]})).then(r=>r.numFailures?M.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Go})).then(e=>e.numFailures?M.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",r=>this.core.getMany({keys:e,trans:r}).then(n=>n.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let s=n?n.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new V.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new V.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(kn(l)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:c,wantResults:s}).then(({numFailures:h,results:d,lastResult:g,failures:_})=>{let w=s?d:g;if(h===0)return w;throw new Rr(`${this.name}.bulkAdd(): ${h} of ${u} operations failed`,_)})})}bulkPut(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let s=n?n.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new V.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new V.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(kn(l)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:c,wantResults:s}).then(({numFailures:h,results:d,lastResult:g,failures:_})=>{let w=s?d:g;if(h===0)return w;throw new Rr(`${this.name}.bulkPut(): ${h} of ${u} operations failed`,_)})})}bulkDelete(e){let r=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:i,failures:s})=>{if(n===0)return i;throw new Rr(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,s)})}};function Wr(t){var e={},r=function(a,l){if(l){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[a].subscribe.apply(null,c),t}else if(typeof a=="string")return e[a]};r.addEventType=s;for(var n=1,i=arguments.length;n<i;++n)s(arguments[n]);return r;function s(a,l,u){if(typeof a=="object")return o(a);l||(l=lf),u||(u=ee);var c={subscribers:[],fire:u,subscribe:function(h){c.subscribers.indexOf(h)===-1&&(c.subscribers.push(h),c.fire=l(c.fire,h))},unsubscribe:function(h){c.subscribers=c.subscribers.filter(function(d){return d!==h}),c.fire=c.subscribers.reduce(l,u)}};return e[a]=r[a]=c,c}function o(a){le(a).forEach(function(l){var u=a[l];if(xe(u))s(l,a[l][0],a[l][1]);else if(u==="asap")var c=s(l,Br,function(){for(var d=arguments.length,g=new Array(d);d--;)g[d]=arguments[d];c.subscribers.forEach(function(_){wo(function(){_.apply(null,g)})})});else throw new V.InvalidArgument("Invalid event config")})}}function $r(t,e){return er(e).from({prototype:t}),e}function jf(t){return $r(qo.prototype,function(r,n,i){this.db=t,this._tx=i,this.name=r,this.schema=n,this.hook=t._allTables[r]?t._allTables[r].hook:Wr(null,{creating:[of,ee],reading:[sf,Br],updating:[uf,ee],deleting:[af,ee]})})}function or(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function es(t,e){t.filter=Lt(t.filter,e)}function ts(t,e,r){var n=t.replayFilter;t.replayFilter=n?()=>Lt(n(),e()):e,t.justLimit=r&&!n}function Af(t,e){t.isMatch=Lt(t.isMatch,e)}function In(t,e){if(t.isPrimKey)return e.primaryKey;let r=e.getIndexByKeyPath(t.index);if(!r)throw new V.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function Qo(t,e,r){let n=In(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function Pn(t,e,r,n){let i=t.replayFilter?Lt(t.filter,t.replayFilter()):t.filter;if(t.or){let s={},o=(a,l,u)=>{if(!i||i(l,u,d=>l.stop(d),d=>l.fail(d))){var c=l.primaryKey,h=""+c;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(c)),Pe(s,h)||(s[h]=!0,e(a,l,u))}};return Promise.all([t.or._iterate(o,r),Yo(Qo(t,n,r),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}else return Yo(Qo(t,n,r),Lt(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Yo(t,e,r,n){var i=n?(o,a,l)=>r(n(o),a,l):r,s=ne(i);return t.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,l=>a=l,l=>{o.stop(l),a=ee},l=>{o.fail(l),a=ee}))&&s(o.value,o,l=>a=l),a()})})}function Fe(t,e){try{let r=Jo(t),n=Jo(e);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Cf(Xo(t),Xo(e));case"Array":return Sf(t,e)}}catch{}return NaN}function Sf(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let s=0;s<i;++s){let o=Fe(t[s],e[s]);if(o!==0)return o}return r===n?0:r<n?-1:1}function Cf(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let s=0;s<i;++s)if(t[s]!==e[s])return t[s]<e[s]?-1:1;return r===n?0:r<n?-1:1}function Jo(t){let e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";let r=Oi(t);return r==="ArrayBuffer"?"binary":r}function Xo(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Zo=class{_read(e,r){var n=this._ctx;return n.error?n.table._trans(null,fe.bind(null,n.error)):n.table._trans("readonly",e).then(r)}_write(e){var r=this._ctx;return r.error?r.table._trans(null,fe.bind(null,r.error)):r.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var r=this._ctx;r.algorithm=Lt(r.algorithm,e)}_iterate(e,r){return Pn(this._ctx,e,r,this._ctx.table.core)}clone(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&Ce(n,e),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(e){var r=this._ctx;return this._read(n=>Pn(r,e,n,r.table.core))}count(e){return this._read(r=>{let n=this._ctx,i=n.table.core;if(or(n,!0))return i.count({trans:r,query:{index:In(n,i.schema),range:n.range}}).then(o=>Math.min(o,n.limit));var s=0;return Pn(n,()=>(++s,!1),r,i).then(()=>s)}).then(e)}sortBy(e,r){let n=e.split(".").reverse(),i=n[0],s=n.length-1;function o(u,c){return c?o(u[n[c]],c-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function l(u,c){var h=o(u,s),d=o(c,s);return h<d?-a:h>d?a:0}return this.toArray(function(u){return u.sort(l)}).then(r)}toArray(e){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&or(n,!0)&&n.limit>0){let{valueMapper:i}=n,s=In(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:s,range:n.range}}).then(({result:o})=>i?o.map(i):o)}else{let i=[];return Pn(n,s=>i.push(s),r,n.table.core).then(()=>i)}},e)}offset(e){var r=this._ctx;return e<=0?this:(r.offset+=e,or(r)?ts(r,()=>{var n=e;return(i,s)=>n===0?!0:n===1?(--n,!1):(s(()=>{i.advance(n),n=0}),!1)}):ts(r,()=>{var n=e;return()=>--n<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),ts(this._ctx,()=>{var r=e;return function(n,i,s){return--r<=0&&i(s),r>=0}},!0),this}until(e,r){return es(this._ctx,function(n,i,s){return e(n.value)?(i(s),r):!0}),this}first(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return es(this._ctx,function(r){return e(r.value)}),Af(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.primaryKey,i)})}keys(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,s){n.push(s.key)}).then(function(){return n}).then(e)}primaryKeys(e){var r=this._ctx;if(r.dir==="next"&&or(r,!0)&&r.limit>0)return this._read(i=>{var s=In(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:s,range:r.range}})}).then(({result:i})=>i).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,s){n.push(s.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(r){return r[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,r=e.index&&e.table.schema.idxByName[e.index];if(!r||!r.multi)return this;var n={};return es(this._ctx,function(i){var s=i.primaryKey.toString(),o=Pe(n,s);return n[s]=!0,!o}),this}modify(e){var r=this._ctx;return this._write(n=>{var i;if(typeof e=="function")i=e;else{var s=le(e),o=s.length;i=function(w){for(var b=!1,f=0;f<o;++f){var y=s[f],p=e[y];Je(w,y)!==p&&(Ke(w,y,p),b=!0)}return b}}let a=r.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,c=this.db._options.modifyChunkSize||200,h=[],d=0,g=[],_=(w,b)=>{let{failures:f,numFailures:y}=b;d+=w-y;for(let p of le(f))h.push(f[p])};return this.clone().primaryKeys().then(w=>{let b=f=>{let y=Math.min(c,w.length-f);return a.getMany({trans:n,keys:w.slice(f,f+y),cache:"immutable"}).then(p=>{let m=[],v=[],x=l?[]:null,j=[];for(let E=0;E<y;++E){let T=p[E],I={value:Mr(T),primKey:w[f+E]};i.call(I,I.value,I)!==!1&&(I.value==null?j.push(w[f+E]):!l&&Fe(u(T),u(I.value))!==0?(j.push(w[f+E]),m.push(I.value)):(v.push(I.value),l&&x.push(w[f+E])))}let C=or(r)&&r.limit===1/0&&(typeof e!="function"||e===rs)&&{index:r.index,range:r.range};return Promise.resolve(m.length>0&&a.mutate({trans:n,type:"add",values:m}).then(E=>{for(let T in E.failures)j.splice(parseInt(T),1);_(m.length,E)})).then(()=>(v.length>0||C&&typeof e=="object")&&a.mutate({trans:n,type:"put",keys:x,values:v,criteria:C,changeSpec:typeof e!="function"&&e}).then(E=>_(v.length,E))).then(()=>(j.length>0||C&&e===rs)&&a.mutate({trans:n,type:"delete",keys:j,criteria:C}).then(E=>_(j.length,E))).then(()=>w.length>f+y&&b(f+c))})};return b(0).then(()=>{if(h.length>0)throw new yn("Error modifying one or more objects",h,d,g);return w.length})})})}delete(){var e=this._ctx,r=e.range;return or(e)&&(e.isPrimKey&&!wf||r.type===3)?this._write(n=>{let{primaryKey:i}=e.table.core.schema,s=r;return e.table.core.count({trans:n,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:n,type:"deleteRange",range:s}).then(({failures:a,lastResult:l,results:u,numFailures:c})=>{if(c)throw new yn("Could not delete some values",Object.keys(a).map(h=>a[h]),o-c);return o-c}))}):this.modify(rs)}},rs=(t,e)=>e.value=null;function Ff(t){return $r(Zo.prototype,function(r,n){this.db=t;let i=Go,s=null;if(n)try{i=n()}catch(u){s=u}let o=r._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:l!==Br?l:null}})}function Ef(t,e){return t<e?-1:t===e?0:1}function Tf(t,e){return t>e?-1:t===e?0:1}function Me(t,e,r){var n=t instanceof ns?new t.Collection(t):t;return n._ctx.error=r?new r(e):new TypeError(e),n}function ar(t){return new t.Collection(t,()=>ea("")).limit(0)}function Df(t){return t==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function Of(t){return t==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function kf(t,e,r,n,i,s){for(var o=Math.min(t.length,n.length),a=-1,l=0;l<o;++l){var u=e[l];if(u!==n[l])return i(t[l],r[l])<0?t.substr(0,l)+r[l]+r.substr(l+1):i(t[l],n[l])<0?t.substr(0,l)+n[l]+r.substr(l+1):a>=0?t.substr(0,a)+e[a]+r.substr(a+1):null;i(t[l],u)<0&&(a=l)}return o<n.length&&s==="next"?t+r.substr(t.length):o<t.length&&s==="prev"?t.substr(0,r.length):a<0?null:t.substr(0,a)+n[a]+r.substr(a+1)}function Mn(t,e,r,n){var i,s,o,a,l,u,c,h=r.length;if(!r.every(w=>typeof w=="string"))return Me(t,$o);function d(w){i=Df(w),s=Of(w),o=w==="next"?Ef:Tf;var b=r.map(function(f){return{lower:s(f),upper:i(f)}}).sort(function(f,y){return o(f.lower,y.lower)});a=b.map(function(f){return f.upper}),l=b.map(function(f){return f.lower}),u=w,c=w==="next"?"":n}d("next");var g=new t.Collection(t,()=>pt(a[0],l[h-1]+n));g._ondirectionchange=function(w){d(w)};var _=0;return g._addAlgorithm(function(w,b,f){var y=w.key;if(typeof y!="string")return!1;var p=s(y);if(e(p,l,_))return!0;for(var m=null,v=_;v<h;++v){var x=kf(y,p,a[v],l[v],o,u);x===null&&m===null?_=v+1:(m===null||o(m,x)>0)&&(m=x)}return b(m!==null?function(){w.continue(m+c)}:f),!1}),g}function pt(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function ea(t){return{type:1,lower:t,upper:t}}var ns=class{get Collection(){return this._ctx.table.db.Collection}between(e,r,n,i){n=n!==!1,i=i===!0;try{return this._cmp(e,r)>0||this._cmp(e,r)===0&&(n||i)&&!(n&&i)?ar(this):new this.Collection(this,()=>pt(e,r,!n,!i))}catch{return Me(this,et)}}equals(e){return e==null?Me(this,et):new this.Collection(this,()=>ea(e))}above(e){return e==null?Me(this,et):new this.Collection(this,()=>pt(e,void 0,!0))}aboveOrEqual(e){return e==null?Me(this,et):new this.Collection(this,()=>pt(e,void 0,!1))}below(e){return e==null?Me(this,et):new this.Collection(this,()=>pt(void 0,e,!1,!0))}belowOrEqual(e){return e==null?Me(this,et):new this.Collection(this,()=>pt(void 0,e))}startsWith(e){return typeof e!="string"?Me(this,$o):this.between(e,e+Bt,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Mn(this,(r,n)=>r.indexOf(n[0])===0,[e],Bt)}equalsIgnoreCase(e){return Mn(this,(r,n)=>r===n[0],[e],"")}anyOfIgnoreCase(){var e=Xe.apply(tr,arguments);return e.length===0?ar(this):Mn(this,(r,n)=>n.indexOf(r)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Xe.apply(tr,arguments);return e.length===0?ar(this):Mn(this,(r,n)=>n.some(i=>r.indexOf(i)===0),e,Bt)}anyOf(){let e=Xe.apply(tr,arguments),r=this._cmp;try{e.sort(r)}catch{return Me(this,et)}if(e.length===0)return ar(this);let n=new this.Collection(this,()=>pt(e[0],e[e.length-1]));n._ondirectionchange=s=>{r=s==="next"?this._ascending:this._descending,e.sort(r)};let i=0;return n._addAlgorithm((s,o,a)=>{let l=s.key;for(;r(l,e[i])>0;)if(++i,i===e.length)return o(a),!1;return r(l,e[i])===0?!0:(o(()=>{s.continue(e[i])}),!1)}),n}notEqual(e){return this.inAnyRange([[Ji,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=Xe.apply(tr,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Me(this,et)}let r=e.reduce((n,i)=>n?n.concat([[n[n.length-1][1],i]]):[[Ji,i]],null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,r){let n=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return ar(this);if(!e.every(m=>m[0]!==void 0&&m[1]!==void 0&&i(m[0],m[1])<=0))return Me(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",V.InvalidArgument);let l=!r||r.includeLowers!==!1,u=r&&r.includeUppers===!0;function c(m,v){let x=0,j=m.length;for(;x<j;++x){let C=m[x];if(n(v[0],C[1])<0&&n(v[1],C[0])>0){C[0]=o(C[0],v[0]),C[1]=a(C[1],v[1]);break}}return x===j&&m.push(v),m}let h=i;function d(m,v){return h(m[0],v[0])}let g;try{g=e.reduce(c,[]),g.sort(d)}catch{return Me(this,et)}let _=0,w=u?m=>i(m,g[_][1])>0:m=>i(m,g[_][1])>=0,b=l?m=>s(m,g[_][0])>0:m=>s(m,g[_][0])>=0;function f(m){return!w(m)&&!b(m)}let y=w,p=new this.Collection(this,()=>pt(g[0][0],g[g.length-1][1],!l,!u));return p._ondirectionchange=m=>{m==="next"?(y=w,h=i):(y=b,h=s),g.sort(d)},p._addAlgorithm((m,v,x)=>{for(var j=m.key;y(j);)if(++_,_===g.length)return v(x),!1;return f(j)?!0:(this._cmp(j,g[_][1])===0||this._cmp(j,g[_][0])===0||v(()=>{h===i?m.continue(g[_][0]):m.continue(g[_][1])}),!1)}),p}startsWithAnyOf(){let e=Xe.apply(tr,arguments);return e.every(r=>typeof r=="string")?e.length===0?ar(this):this.inAnyRange(e.map(r=>[r,r+Bt])):Me(this,"startsWithAnyOf() only works with strings")}};function If(t){return $r(ns.prototype,function(r,n,i){this.db=t,this._ctx={table:r,index:n===":id"?null:n,or:i};let s=t._deps.indexedDB;if(!s)throw new V.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=t._deps.IDBKeyRange})}function Ge(t){return ne(function(e){return Ur(e),t(e.target.error),!1})}function Ur(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Gr="storagemutated",mt="x-storagemutated-1",gt=Wr(null,Gr),ta=class{_lock(){return Pr(!N.global),++this._reculock,this._reculock===1&&!N.global&&(N.lockOwnerFor=this),this}_unlock(){if(Pr(!N.global),--this._reculock==0)for(N.global||(N.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{sr(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&N.lockOwnerFor!==this}create(e){if(!this.mode)return this;let r=this.db.idbdb,n=this.db._state.dbOpenError;if(Pr(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new V.DatabaseClosed(n);case"MissingAPIError":throw new V.MissingAPI(n.message,n);default:throw new V.OpenFailed(n)}if(!this.active)throw new V.TransactionInactive;return Pr(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=ne(i=>{Ur(i),this._reject(e.error)}),e.onabort=ne(i=>{Ur(i),this.active&&this._reject(new V.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=ne(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&gt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,r,n){if(e==="readwrite"&&this.mode!=="readwrite")return fe(new V.ReadOnly("Transaction is readonly"));if(!this.active)return fe(new V.TransactionInactive);if(this._locked())return new M((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,r,n).then(s,o)},N])});if(n)return dt(()=>{var s=new M((o,a)=>{this._lock();let l=r(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new M((s,o)=>{var a=r(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var r=this._root();let n=M.resolve(e);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var i=r.idbtrans.objectStore(r.storeNames[0]);(function o(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=r._waitingFor;return new M((o,a)=>{n.then(l=>r._waitingQueue.push(ne(o.bind(null,l))),l=>r._waitingQueue.push(ne(a.bind(null,l)))).finally(()=>{r._waitingFor===s&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new V.Abort))}table(e){let r=this._memoizedTables||(this._memoizedTables={});if(Pe(r,e))return r[e];let n=this.schema[e];if(!n)throw new V.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,n,this);return i.core=this.db.core.table(e),r[e]=i,i}};function Pf(t){return $r(ta.prototype,function(r,n,i,s,o){this.db=t,this.mode=r,this.storeNames=n,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=Wr(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new M((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),fe(a)})})}function is(t,e,r,n,i,s,o){return{name:t,keyPath:e,unique:r,multi:n,auto:i,compound:s,src:(r&&!o?"&":"")+(n?"*":"")+(i?"++":"")+ra(e)}}function ra(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function na(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:jo(r,n=>[n.name,n])}}function Mf(t){return t.length===1?t[0]:t}var qr=t=>{try{return t.only([[]]),qr=()=>[[]],[[]]}catch{return qr=()=>Bt,Bt}};function ss(t){return t==null?()=>{}:typeof t=="string"?Rf(t):e=>Je(e,t)}function Rf(t){return t.split(".").length===1?r=>r[t]:r=>Je(r,t)}function ia(t){return[].slice.call(t)}var Bf=0;function Qr(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Lf(t,e,r){function n(c,h){let d=ia(c.objectStoreNames);return{schema:{name:c.name,tables:d.map(g=>h.objectStore(g)).map(g=>{let{keyPath:_,autoIncrement:w}=g,b=xe(_),f=_==null,y={},p={name:g.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:f,compound:b,keyPath:_,autoIncrement:w,unique:!0,extractKey:ss(_)},indexes:ia(g.indexNames).map(m=>g.index(m)).map(m=>{let{name:v,unique:x,multiEntry:j,keyPath:C}=m,E=xe(C),T={name:v,compound:E,keyPath:C,unique:x,multiEntry:j,extractKey:ss(C)};return y[Qr(C)]=T,T}),getIndexByKeyPath:m=>y[Qr(m)]};return y[":id"]=p.primaryKey,_!=null&&(y[Qr(_)]=p.primaryKey),p})},hasGetAll:d.length>0&&"getAll"in h.objectStore(d[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:h,upper:d,lowerOpen:g,upperOpen:_}=c;return h===void 0?d===void 0?null:e.upperBound(d,!!_):d===void 0?e.lowerBound(h,!!g):e.bound(h,d,!!g,!!_)}function s(c){let h=c.name;function d({trans:w,type:b,keys:f,values:y,range:p}){return new Promise((m,v)=>{m=ne(m);let x=w.objectStore(h),j=x.keyPath==null,C=b==="put"||b==="add";if(!C&&b!=="delete"&&b!=="deleteRange")throw new Error("Invalid operation type: "+b);let{length:E}=f||y||{length:1};if(f&&y&&f.length!==y.length)throw new Error("Given keys array must have same length as given values array.");if(E===0)return m({numFailures:0,failures:{},results:[],lastResult:void 0});let T,I=[],B=[],O=0,K=U=>{++O,Ur(U)};if(b==="deleteRange"){if(p.type===4)return m({numFailures:O,failures:B,results:[],lastResult:void 0});p.type===3?I.push(T=x.clear()):I.push(T=x.delete(i(p)))}else{let[U,D]=C?j?[y,f]:[y,null]:[f,null];if(C)for(let A=0;A<E;++A)I.push(T=D&&D[A]!==void 0?x[b](U[A],D[A]):x[b](U[A])),T.onerror=K;else for(let A=0;A<E;++A)I.push(T=x[b](U[A])),T.onerror=K}let Y=U=>{let D=U.target.result;I.forEach((A,S)=>A.error!=null&&(B[S]=A.error)),m({numFailures:O,failures:B,results:b==="delete"?f:I.map(A=>A.result),lastResult:D})};T.onerror=U=>{K(U),Y(U)},T.onsuccess=Y})}function g({trans:w,values:b,query:f,reverse:y,unique:p}){return new Promise((m,v)=>{m=ne(m);let{index:x,range:j}=f,C=w.objectStore(h),E=x.isPrimaryKey?C:C.index(x.name),T=y?p?"prevunique":"prev":p?"nextunique":"next",I=b||!("openKeyCursor"in E)?E.openCursor(i(j),T):E.openKeyCursor(i(j),T);I.onerror=Ge(v),I.onsuccess=ne(B=>{let O=I.result;if(!O){m(null);return}O.___id=++Bf,O.done=!1;let K=O.continue.bind(O),Y=O.continuePrimaryKey;Y&&(Y=Y.bind(O));let U=O.advance.bind(O),D=()=>{throw new Error("Cursor not started")},A=()=>{throw new Error("Cursor not stopped")};O.trans=w,O.stop=O.continue=O.continuePrimaryKey=O.advance=D,O.fail=ne(v),O.next=function(){let S=1;return this.start(()=>S--?this.continue():this.stop()).then(()=>this)},O.start=S=>{let F=new Promise((Q,se)=>{Q=ne(Q),I.onerror=Ge(se),O.fail=se,O.stop=Oe=>{O.stop=O.continue=O.continuePrimaryKey=O.advance=A,Q(Oe)}}),k=()=>{if(I.result)try{S()}catch(Q){O.fail(Q)}else O.done=!0,O.start=()=>{throw new Error("Cursor behind last entry")},O.stop()};return I.onsuccess=ne(Q=>{I.onsuccess=k,k()}),O.continue=K,O.continuePrimaryKey=Y,O.advance=U,k(),F},m(O)},v)})}function _(w){return b=>new Promise((f,y)=>{f=ne(f);let{trans:p,values:m,limit:v,query:x}=b,j=v===1/0?void 0:v,{index:C,range:E}=x,T=p.objectStore(h),I=C.isPrimaryKey?T:T.index(C.name),B=i(E);if(v===0)return f({result:[]});if(w){let O=m?I.getAll(B,j):I.getAllKeys(B,j);O.onsuccess=K=>f({result:K.target.result}),O.onerror=Ge(y)}else{let O=0,K=m||!("openKeyCursor"in I)?I.openCursor(B):I.openKeyCursor(B),Y=[];K.onsuccess=U=>{let D=K.result;if(!D)return f({result:Y});if(Y.push(m?D.value:D.primaryKey),++O===v)return f({result:Y});D.continue()},K.onerror=Ge(y)}})}return{name:h,schema:c,mutate:d,getMany({trans:w,keys:b}){return new Promise((f,y)=>{f=ne(f);let p=w.objectStore(h),m=b.length,v=new Array(m),x=0,j=0,C,E=I=>{let B=I.target;(v[B._pos]=B.result)!=null,++j===x&&f(v)},T=Ge(y);for(let I=0;I<m;++I)b[I]!=null&&(C=p.get(b[I]),C._pos=I,C.onsuccess=E,C.onerror=T,++x);x===0&&f(v)})},get({trans:w,key:b}){return new Promise((f,y)=>{f=ne(f);let m=w.objectStore(h).get(b);m.onsuccess=v=>f(v.target.result),m.onerror=Ge(y)})},query:_(a),openCursor:g,count({query:w,trans:b}){let{index:f,range:y}=w;return new Promise((p,m)=>{let v=b.objectStore(h),x=f.isPrimaryKey?v:v.index(f.name),j=i(y),C=j?x.count(j):x.count();C.onsuccess=ne(E=>p(E.target.result)),C.onerror=Ge(m)})}}}let{schema:o,hasGetAll:a}=n(t,r),l=o.tables.map(c=>s(c)),u={};return l.forEach(c=>u[c.name]=c),{stack:"dbcore",transaction:t.transaction.bind(t),table(c){if(!u[c])throw new Error(`Table '${c}' not found`);return u[c]},MIN_KEY:-1/0,MAX_KEY:qr(e),schema:o}}function Nf(t,e){return e.reduce((r,{create:n})=>oe(oe({},r),n(r)),t)}function Kf(t,e,{IDBKeyRange:r,indexedDB:n},i){return{dbcore:Nf(Lf(e,r,i),t.dbcore)}}function os({_novip:t},e){let r=e.db,n=Kf(t._middlewares,r,t._deps,e);t.core=n.dbcore,t.tables.forEach(i=>{let s=i.name;t.core.schema.tables.some(o=>o.name===s)&&(i.core=t.core.table(s),t[s]instanceof t.Table&&(t[s].core=i.core))})}function Rn({_novip:t},e,r,n){r.forEach(i=>{let s=n[i];e.forEach(o=>{let a=Ti(o,i);(!a||"value"in a&&a.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?Ye(o,i,{get(){return this.table(i)},set(l){bo(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new t.Table(i,s))})})}function as({_novip:t},e){e.forEach(r=>{for(let n in r)r[n]instanceof t.Table&&delete r[n]})}function zf(t,e){return t._cfg.version-e._cfg.version}function Vf(t,e,r,n){let i=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,i);s.create(r),s._completion.catch(n);let o=s._reject.bind(s),a=N.transless||N;dt(()=>{N.trans=s,N.transless=a,e===0?(le(i).forEach(l=>{us(r,l,i[l].primKey,i[l].indexes)}),os(t,r),M.follow(()=>t.on.populate.fire(s)).catch(o)):Hf(t,e,s,r).catch(o)})}function Hf({_novip:t},e,r,n){let i=[],s=t._versions,o=t._dbSchema=cs(t,t.idbdb,n),a=!1;s.filter(c=>c._cfg.version>=e).forEach(c=>{i.push(()=>{let h=o,d=c._cfg.dbschema;fs(t,h,n),fs(t,d,n),o=t._dbSchema=d;let g=sa(h,d);g.add.forEach(w=>{us(n,w[0],w[1].primKey,w[1].indexes)}),g.change.forEach(w=>{if(w.recreate)throw new V.Upgrade("Not yet support for changing primary key");{let b=n.objectStore(w.name);w.add.forEach(f=>ls(b,f)),w.change.forEach(f=>{b.deleteIndex(f.name),ls(b,f)}),w.del.forEach(f=>b.deleteIndex(f))}});let _=c._cfg.contentUpgrade;if(_&&c._cfg.version>e){os(t,n),r._memoizedTables={},a=!0;let w=Ao(d);g.del.forEach(p=>{w[p]=h[p]}),as(t,[t.Transaction.prototype]),Rn(t,[t.Transaction.prototype],le(w),w),r.schema=w;let b=Ii(_);b&&ir();let f,y=M.follow(()=>{if(f=_(r),f&&b){var p=Ze.bind(null,null);f.then(p,p)}});return f&&typeof f.then=="function"?M.resolve(f):y.then(()=>f)}}),i.push(h=>{if(!a||!xf){let d=c._cfg.dbschema;$f(d,h)}as(t,[t.Transaction.prototype]),Rn(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),r.schema=t._dbSchema})});function u(){return i.length?M.resolve(i.shift()(r.idbtrans)).then(u):M.resolve()}return u().then(()=>{Wf(o,n)})}function sa(t,e){let r={del:[],add:[],change:[]},n;for(n in t)e[n]||r.del.push(n);for(n in e){let i=t[n],s=e[n];if(!i)r.add.push([n,s]);else{let o={name:n,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Dn)o.recreate=!0,r.change.push(o);else{let a=i.idxByName,l=s.idxByName,u;for(u in a)l[u]||o.del.push(u);for(u in l){let c=a[u],h=l[u];c?c.src!==h.src&&o.change.push(h):o.add.push(h)}(o.del.length>0||o.add.length>0||o.change.length>0)&&r.change.push(o)}}}return r}function us(t,e,r,n){let i=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(s=>ls(i,s)),i}function Wf(t,e){le(t).forEach(r=>{e.db.objectStoreNames.contains(r)||us(e,r,t[r].primKey,t[r].indexes)})}function $f(t,e){[].slice.call(e.db.objectStoreNames).forEach(r=>t[r]==null&&e.db.deleteObjectStore(r))}function ls(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function cs(t,e,r){let n={};return gn(e.objectStoreNames,0).forEach(s=>{let o=r.objectStore(s),a=o.keyPath,l=is(ra(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),u=[];for(let h=0;h<o.indexNames.length;++h){let d=o.index(o.indexNames[h]);a=d.keyPath;var c=is(d.name,a,!!d.unique,!!d.multiEntry,!1,a&&typeof a!="string",!1);u.push(c)}n[s]=na(s,l,u)}),n}function Uf({_novip:t},e,r){t.verno=e.version/10;let n=t._dbSchema=cs(t,e,r);t._storeNames=gn(e.objectStoreNames,0),Rn(t,[t._allTables],le(n),n)}function Gf(t,e){let r=cs(t,t.idbdb,e),n=sa(r,t._dbSchema);return!(n.add.length||n.change.some(i=>i.add.length||i.change.length))}function fs({_novip:t},e,r){let n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){let s=n[i],o=r.objectStore(s);t._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let l=o.indexNames[a],u=o.index(l).keyPath,c=typeof u=="string"?u:"["+gn(u).join("+")+"]";if(e[s]){let h=e[s].idxByName[c];h&&(h.name=l,delete e[s].idxByName[c],e[s].idxByName[l]=h)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&te.WorkerGlobalScope&&te instanceof te.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function qf(t){return t.split(",").map((e,r)=>{e=e.trim();let n=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return is(n,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),xe(i),r===0)})}var oa=class{_parseStoresSpec(e,r){le(e).forEach(n=>{if(e[n]!==null){var i=qf(e[n]),s=i.shift();if(s.multi)throw new V.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new V.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new V.Schema("Index must have a name and cannot be an empty string")}),r[n]=na(n,s,i)}})}stores(e){let r=this.db;this._cfg.storesSource=this._cfg.storesSource?Ce(this._cfg.storesSource,e):e;let n=r._versions,i={},s={};return n.forEach(o=>{Ce(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),r._dbSchema=s,as(r,[r._allTables,r,r.Transaction.prototype]),Rn(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],le(s),s),r._storeNames=le(s),this}upgrade(e){return this._cfg.contentUpgrade=Bi(this._cfg.contentUpgrade||ee,e),this}};function Qf(t){return $r(oa.prototype,function(r){this.db=t,this._cfg={version:r,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function ds(t,e){let r=t._dbNamesDB;return r||(r=t._dbNamesDB=new rt(On,{addons:[],indexedDB:t,IDBKeyRange:e}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function hs(t){return t&&typeof t.databases=="function"}function Yf({indexedDB:t,IDBKeyRange:e}){return hs(t)?Promise.resolve(t.databases()).then(r=>r.map(n=>n.name).filter(n=>n!==On)):ds(t,e).toCollection().primaryKeys()}function Jf({indexedDB:t,IDBKeyRange:e},r){!hs(t)&&r!==On&&ds(t,e).put({name:r}).catch(ee)}function Xf({indexedDB:t,IDBKeyRange:e},r){!hs(t)&&r!==On&&ds(t,e).delete(r).catch(ee)}function ps(t){return dt(function(){return N.letThrough=!0,t()})}function Zf(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(r){var n=function(){return indexedDB.databases().finally(r)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)})}function ed(t){let e=t._state,{indexedDB:r}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?fe(e.dbOpenError):t);Ue&&(e.openCanceller._stackHolder=It()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let n=e.openCanceller;function i(){if(e.openCanceller!==n)throw new V.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1;return M.race([n,(typeof navigator=="undefined"?M.resolve():Zf()).then(()=>new M((l,u)=>{if(i(),!r)throw new V.MissingAPI;let c=t.name,h=e.autoSchema?r.open(c):r.open(c,Math.round(t.verno*10));if(!h)throw new V.MissingAPI;h.onerror=Ge(u),h.onblocked=ne(t._fireOnBlocked),h.onupgradeneeded=ne(d=>{if(o=h.transaction,e.autoSchema&&!t._options.allowEmptyDB){h.onerror=Ur,o.abort(),h.result.close();let _=r.deleteDatabase(c);_.onsuccess=_.onerror=ne(()=>{u(new V.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{o.onerror=Ge(u);var g=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=g<1,t._novip.idbdb=h.result,Vf(t,g/10,o,u)}},u),h.onsuccess=ne(()=>{o=null;let d=t._novip.idbdb=h.result,g=gn(d.objectStoreNames);if(g.length>0)try{let _=d.transaction(Mf(g),"readonly");e.autoSchema?Uf(t,d,_):(fs(t,t._dbSchema,_),Gf(t,_)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),os(t,_)}catch{}Hr.push(t),d.onversionchange=ne(_=>{e.vcFired=!0,t.on("versionchange").fire(_)}),d.onclose=ne(_=>{t.on("close").fire(_)}),a&&Jf(t._deps,c),l()},u)}))]).then(()=>(i(),e.onReadyBeingFired=[],M.resolve(ps(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(Bi,ee);return e.onReadyBeingFired=[],M.resolve(ps(()=>u(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{o&&o.abort()}catch{}return n===e.openCanceller&&t._close(),fe(l)}).finally(()=>{e.openComplete=!0,s()})}function ms(t){var e=o=>t.next(o),r=o=>t.throw(o),n=s(e),i=s(r);function s(o){return a=>{var l=o(a),u=l.value;return l.done?u:!u||typeof u.then!="function"?xe(u)?Promise.all(u).then(n,i):n(u):u.then(n,i)}}return s(e)()}function td(t,e,r){var n=arguments.length;if(n<2)throw new V.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];r=i.pop();var s=So(i);return[t,s,r]}function aa(t,e,r,n,i){return M.resolve().then(()=>{let s=N.transless||N,o=t._createTransaction(e,r,t._dbSchema,n),a={trans:o,transless:s};if(n)o.idbtrans=n.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(h){return h.name===Ri.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>aa(t,e,r,null,i))):fe(h)}let l=Ii(i);l&&ir();let u,c=M.follow(()=>{if(u=i.call(o,o),u)if(l){var h=Ze.bind(null,null);u.then(h,h)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=ms(u))},a);return(u&&typeof u.then=="function"?M.resolve(u).then(h=>o.active?h:fe(new V.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(h=>(n&&o._resolve(),o._completion.then(()=>h))).catch(h=>(o._reject(h),fe(h)))})}function Bn(t,e,r){let n=xe(t)?t.slice():[t];for(let i=0;i<r;++i)n.push(e);return n}function rd(t){return je(oe({},t),{table(e){let r=t.table(e),{schema:n}=r,i={},s=[];function o(d,g,_){let w=Qr(d),b=i[w]=i[w]||[],f=d==null?0:typeof d=="string"?1:d.length,y=g>0,p=je(oe({},_),{isVirtual:y,keyTail:g,keyLength:f,extractKey:ss(d),unique:!y&&_.unique});if(b.push(p),p.isPrimaryKey||s.push(p),f>1){let m=f===2?d[0]:d.slice(0,f-1);o(m,g+1,_)}return b.sort((m,v)=>m.keyTail-v.keyTail),p}let a=o(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(let d of n.indexes)o(d.keyPath,0,d);function l(d){let g=i[Qr(d)];return g&&g[0]}function u(d,g){return{type:d.type===1?2:d.type,lower:Bn(d.lower,d.lowerOpen?t.MAX_KEY:t.MIN_KEY,g),lowerOpen:!0,upper:Bn(d.upper,d.upperOpen?t.MIN_KEY:t.MAX_KEY,g),upperOpen:!0}}function c(d){let g=d.query.index;return g.isVirtual?je(oe({},d),{query:{index:g,range:u(d.query.range,g.keyTail)}}):d}return je(oe({},r),{schema:je(oe({},n),{primaryKey:a,indexes:s,getIndexByKeyPath:l}),count(d){return r.count(c(d))},query(d){return r.query(c(d))},openCursor(d){let{keyTail:g,isVirtual:_,keyLength:w}=d.query.index;if(!_)return r.openCursor(d);function b(f){function y(m){m!=null?f.continue(Bn(m,d.reverse?t.MAX_KEY:t.MIN_KEY,g)):d.unique?f.continue(f.key.slice(0,w).concat(d.reverse?t.MIN_KEY:t.MAX_KEY,g)):f.continue()}return Object.create(f,{continue:{value:y},continuePrimaryKey:{value(m,v){f.continuePrimaryKey(Bn(m,t.MAX_KEY,g),v)}},primaryKey:{get(){return f.primaryKey}},key:{get(){let m=f.key;return w===1?m[0]:m.slice(0,w)}},value:{get(){return f.value}}})}return r.openCursor(c(d)).then(f=>f&&b(f))}})}})}var nd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:rd};function gs(t,e,r,n){return r=r||{},n=n||"",le(t).forEach(i=>{if(!Pe(e,i))r[n+i]=void 0;else{var s=t[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=Oi(s),l=Oi(o);a!==l?r[n+i]=e[i]:a==="Object"?gs(s,o,r,n+i+"."):s!==o&&(r[n+i]=e[i])}else s!==o&&(r[n+i]=e[i])}}),le(e).forEach(i=>{Pe(t,i)||(r[n+i]=e[i])}),r}function id(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var sd={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>je(oe({},t),{table(e){let r=t.table(e),{primaryKey:n}=r.schema;return je(oe({},r),{mutate(s){let o=N.trans,{deleting:a,creating:l,updating:u}=o.table(e).hook;switch(s.type){case"add":if(l.fire===ee)break;return o._promise("readwrite",()=>c(s),!0);case"put":if(l.fire===ee&&u.fire===ee)break;return o._promise("readwrite",()=>c(s),!0);case"delete":if(a.fire===ee)break;return o._promise("readwrite",()=>c(s),!0);case"deleteRange":if(a.fire===ee)break;return o._promise("readwrite",()=>h(s),!0)}return r.mutate(s);function c(g){let _=N.trans,w=g.keys||id(n,g);if(!w)throw new Error("Keys missing");return g=g.type==="add"||g.type==="put"?je(oe({},g),{keys:w}):oe({},g),g.type!=="delete"&&(g.values=[...g.values]),g.keys&&(g.keys=[...g.keys]),od(r,g,w).then(b=>{let f=w.map((y,p)=>{let m=b[p],v={onerror:null,onsuccess:null};if(g.type==="delete")a.fire.call(v,y,m,_);else if(g.type==="add"||m===void 0){let x=l.fire.call(v,y,g.values[p],_);y==null&&x!=null&&(y=x,g.keys[p]=y,n.outbound||Ke(g.values[p],n.keyPath,y))}else{let x=gs(m,g.values[p]),j=u.fire.call(v,x,y,m,_);if(j){let C=g.values[p];Object.keys(j).forEach(E=>{Pe(C,E)?C[E]=j[E]:Ke(C,E,j[E])})}}return v});return r.mutate(g).then(({failures:y,results:p,numFailures:m,lastResult:v})=>{for(let x=0;x<w.length;++x){let j=p?p[x]:w[x],C=f[x];j==null?C.onerror&&C.onerror(y[x]):C.onsuccess&&C.onsuccess(g.type==="put"&&b[x]?g.values[x]:j)}return{failures:y,results:p,numFailures:m,lastResult:v}}).catch(y=>(f.forEach(p=>p.onerror&&p.onerror(y)),Promise.reject(y)))})}function h(g){return d(g.trans,g.range,1e4)}function d(g,_,w){return r.query({trans:g,values:!1,query:{index:n,range:_},limit:w}).then(({result:b})=>c({type:"delete",keys:b,trans:g}).then(f=>f.numFailures>0?Promise.reject(f.failures[0]):b.length<w?{failures:[],numFailures:0,lastResult:void 0}:d(g,je(oe({},_),{lower:b[b.length-1],lowerOpen:!0}),w)))}}})}})};function od(t,e,r){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:r,cache:"immutable"})}function ua(t,e,r){try{if(!e||e.keys.length<t.length)return null;let n=[];for(let i=0,s=0;i<e.keys.length&&s<t.length;++i)Fe(e.keys[i],t[s])===0&&(n.push(r?Mr(e.values[i]):e.values[i]),++s);return n.length===t.length?n:null}catch{return null}}var ad={stack:"dbcore",level:-1,create:t=>({table:e=>{let r=t.table(e);return je(oe({},r),{getMany:n=>{if(!n.cache)return r.getMany(n);let i=ua(n.keys,n.trans._cache,n.cache==="clone");return i?M.resolve(i):r.getMany(n).then(s=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?Mr(s):s},s))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))})}})};function ys(t){return!("from"in t)}var tt=function(t,e){if(this)Ce(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{let r=new tt;return t&&"d"in t&&Ce(r,t),r}};Zt(tt.prototype,{add(t){return Ln(this,t),this},addKey(t){return Yr(this,t,t),this},addKeys(t){return t.forEach(e=>Yr(this,e,e)),this},[ki](){return vs(this)}});function Yr(t,e,r){let n=Fe(e,r);if(isNaN(n))return;if(n>0)throw RangeError();if(ys(t))return Ce(t,{from:e,to:r,d:1});let i=t.l,s=t.r;if(Fe(r,t.from)<0)return i?Yr(i,e,r):t.l={from:e,to:r,d:1,l:null,r:null},la(t);if(Fe(e,t.to)>0)return s?Yr(s,e,r):t.r={from:e,to:r,d:1,l:null,r:null},la(t);Fe(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),Fe(r,t.to)>0&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1);let o=!t.r;i&&!t.l&&Ln(t,i),s&&o&&Ln(t,s)}function Ln(t,e){function r(n,{from:i,to:s,l:o,r:a}){Yr(n,i,s),o&&r(n,o),a&&r(n,a)}ys(e)||r(t,e)}function ud(t,e){let r=vs(e),n=r.next();if(n.done)return!1;let i=n.value,s=vs(t),o=s.next(i.from),a=o.value;for(;!n.done&&!o.done;){if(Fe(a.from,i.to)<=0&&Fe(a.to,i.from)>=0)return!0;Fe(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function vs(t){let e=ys(t)?null:{s:0,n:t};return{next(r){let n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&Fe(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||Fe(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function la(t){var e,r;let n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((r=t.l)===null||r===void 0?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){let s=i==="r"?"l":"r",o=oe({},t),a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],o[i]=a[s],t[s]=o,o.d=ca(o)}t.d=ca(t)}function ca({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}var ld={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,r=new tt(t.MIN_KEY,t.MAX_KEY);return je(oe({},t),{table:n=>{let i=t.table(n),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,u=je(oe({},i),{mutate:d=>{let g=d.trans,_=g.mutatedParts||(g.mutatedParts={}),w=x=>{let j=`idb://${e}/${n}/${x}`;return _[j]||(_[j]=new tt)},b=w(""),f=w(":dels"),{type:y}=d,[p,m]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[],v=d.trans._cache;return i.mutate(d).then(x=>{if(xe(p)){y!=="delete"&&(p=x.results),b.addKeys(p);let j=ua(p,v);!j&&y!=="add"&&f.addKeys(p),(j||m)&&cd(w,s,j,m)}else if(p){let j={from:p.lower,to:p.upper};f.add(j),b.add(j)}else b.add(r),f.add(r),s.indexes.forEach(j=>w(j.name).add(r));return x})}}),c=({query:{index:d,range:g}})=>{var _,w;return[d,new tt((_=g.lower)!==null&&_!==void 0?_:t.MIN_KEY,(w=g.upper)!==null&&w!==void 0?w:t.MAX_KEY)]},h={get:d=>[o,new tt(d.key)],getMany:d=>[o,new tt().addKeys(d.keys)],count:c,query:c,openCursor:c};return le(h).forEach(d=>{u[d]=function(g){let{subscr:_}=N;if(_){let w=m=>{let v=`idb://${e}/${n}/${m}`;return _[v]||(_[v]=new tt)},b=w(""),f=w(":dels"),[y,p]=h[d](g);if(w(y.name||"").add(p),!y.isPrimaryKey)if(d==="count")f.add(r);else{let m=d==="query"&&l&&g.values&&i.query(je(oe({},g),{values:!1}));return i[d].apply(this,arguments).then(v=>{if(d==="query"){if(l&&g.values)return m.then(({result:j})=>(b.addKeys(j),v));let x=g.values?v.result.map(a):v.result;g.values?b.addKeys(x):f.addKeys(x)}else if(d==="openCursor"){let x=v,j=g.values;return x&&Object.create(x,{key:{get(){return f.addKey(x.primaryKey),x.key}},primaryKey:{get(){let C=x.primaryKey;return f.addKey(C),C}},value:{get(){return j&&b.addKey(x.primaryKey),x.value}}})}return v})}}return i[d].apply(this,arguments)}}),u}})}};function cd(t,e,r,n){function i(s){let o=t(s.name||"");function a(u){return u!=null?s.extractKey(u):null}let l=u=>s.multiEntry&&xe(u)?u.forEach(c=>o.addKey(c)):o.addKey(u);(r||n).forEach((u,c)=>{let h=r&&a(r[c]),d=n&&a(n[c]);Fe(h,d)!==0&&(h!=null&&l(h),d!=null&&l(d))})}e.indexes.forEach(i)}var rt=class{constructor(e,r){this._middlewares={},this.verno=0;let n=rt.dependencies;this._options=r=oe({addons:rt.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};let{addons:i}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ee,dbReadyPromise:null,cancelOpen:ee,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new M(o=>{s.dbReadyResolve=o}),s.openCanceller=new M((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=Wr(this,"populate","blocked","versionchange","close",{ready:[Bi,ee]}),this.on.ready.subscribe=xo(this.on.ready.subscribe,o=>(a,l)=>{rt.vip(()=>{let u=this._state;if(u.openComplete)u.dbOpenError||M.resolve().then(a),l&&o(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),l&&o(a);else{o(a);let c=this;l||o(function h(){c.on.ready.unsubscribe(a),c.on.ready.unsubscribe(h)})}})}),this.Collection=Ff(this),this.Table=jf(this),this.Transaction=Pf(this),this.Version=Qf(this),this.WhereClause=If(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=qr(r.IDBKeyRange),this._createTransaction=(o,a,l,u)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,u),this._fireOnBlocked=o=>{this.on("blocked").fire(o),Hr.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(nd),this.use(sd),this.use(ld),this.use(ad),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new V.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new V.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let r=this._versions;var n=r.filter(i=>i._cfg.version===e)[0];return n||(n=new this.Version(e),r.push(n),r.sort(zf),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||N.letThrough||this._vip)?e():new M((r,n)=>{if(this._state.openComplete)return n(new V.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){n(new V.DatabaseClosed);return}this.open().catch(ee)}this._state.dbReadyPromise.then(r,n)}).then(e)}use({stack:e,create:r,level:n,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:r,level:n??10,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:r,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>n?i.create!==n:r?i.name!==r:!1)),this}open(){return ed(this)}_close(){let e=this._state,r=Hr.indexOf(this);if(r>=0&&Hr.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new M(n=>{e.dbReadyResolve=n}),e.openCanceller=new M((n,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new V.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,r=this._state;return new M((n,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=ne(()=>{Xf(this._deps,this.name),n()}),o.onerror=Ge(i),o.onblocked=this._fireOnBlocked};if(e)throw new V.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return le(this._allTables).map(e=>this._allTables[e])}transaction(){let e=td.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,r,n){let i=N.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=r.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===Xi)o=Xi;else if(e=="rw"||e==Zi)o=Zi;else throw new V.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===Xi&&o===Zi)if(s)i=null;else throw new V.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1)if(s)i=null;else throw new V.SubTransaction("Table "+u+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(c,h)=>{h(u)}):fe(u)}let l=aa.bind(null,this,o,a,i,n);return i?i._promise(o,l,"lock"):N.trans?sr(N.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!Pe(this._allTables,e))throw new V.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},fd=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",fa=class{constructor(e){this._subscribe=e}subscribe(e,r,n){return this._subscribe(!e||typeof e=="function"?{next:e,error:r,complete:n}:e)}[fd](){return this}};function da(t,e){return le(e).forEach(r=>{let n=t[r]||(t[r]=new tt);Ln(n,e[r])}),t}function dd(t){return new fa(e=>{let r=Ii(t);function n(g){r&&ir();let _=()=>dt(t,{subscr:g,trans:null}),w=N.trans?sr(N.transless,_):_();return r&&w.then(Ze,Ze),w}let i=!1,s={},o={},a={get closed(){return i},unsubscribe:()=>{i=!0,gt.storagemutated.unsubscribe(h)}};e.start&&e.start(a);let l=!1,u=!1;function c(){return le(o).some(g=>s[g]&&ud(s[g],o[g]))}let h=g=>{da(s,g),c()&&d()},d=()=>{if(l||i)return;s={};let g={},_=n(g);u||(gt(Gr,h),u=!0),l=!0,Promise.resolve(_).then(w=>{l=!1,!i&&(c()?d():(s={},o=g,e.next&&e.next(w)))},w=>{l=!1,e.error&&e.error(w),a.unsubscribe()})};return d(),a})}var _s;try{_s={indexedDB:te.indexedDB||te.mozIndexedDB||te.webkitIndexedDB||te.msIndexedDB,IDBKeyRange:te.IDBKeyRange||te.webkitIDBKeyRange}}catch{_s={indexedDB:null,IDBKeyRange:null}}var Nt=rt;Zt(Nt,je(oe({},vn),{delete(t){return new Nt(t,{addons:[]}).delete()},exists(t){return new Nt(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(t){try{return Yf(Nt.dependencies).then(t)}catch{return fe(new V.MissingAPI)}},defineClass(){function t(e){Ce(this,e)}return t},ignoreTransaction(t){return N.trans?sr(N.transless,t):t()},vip:ps,async:function(t){return function(){try{var e=ms(t.apply(this,arguments));return!e||typeof e.then!="function"?M.resolve(e):e}catch(r){return fe(r)}}},spawn:function(t,e,r){try{var n=ms(t.apply(r,e||[]));return!n||typeof n.then!="function"?M.resolve(n):n}catch(i){return fe(i)}},currentTransaction:{get:()=>N.trans||null},waitFor:function(t,e){let r=M.resolve(typeof t=="function"?Nt.ignoreTransaction(t):t).timeout(e||6e4);return N.trans?N.trans.waitFor(r):r},Promise:M,debug:{get:()=>Ue,set:t=>{Fo(t,t==="dexie"?()=>!0:Uo)}},derive:er,extend:Ce,props:Zt,override:xo,Events:Wr,on:gt,liveQuery:dd,extendObservabilitySet:da,getByKeyPath:Je,setByKeyPath:Ke,delByKeyPath:qc,shallowClone:Ao,deepClone:Mr,getObjectDiff:gs,cmp:Fe,asap:wo,minKey:Ji,addons:[],connections:Hr,errnames:Ri,dependencies:_s,semVer:Wo,version:Wo.split(".").map(t=>parseInt(t)).reduce((t,e,r)=>t+e/Math.pow(10,r*2))}));Nt.maxKey=qr(Nt.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(gt(Gr,t=>{if(!nt){let e;Dn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(mt,!0,!0,t)):e=new CustomEvent(mt,{detail:t}),nt=!0,dispatchEvent(e),nt=!1}}),addEventListener(mt,({detail:t})=>{nt||Nn(t)}));function Nn(t){let e=nt;try{nt=!0,gt.storagemutated.fire(t)}finally{nt=e}}var nt=!1;if(typeof BroadcastChannel!="undefined"){let t=new BroadcastChannel(mt);gt(Gr,e=>{nt||t.postMessage(e)}),t.onmessage=e=>{e.data&&Nn(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){gt(Gr,e=>{try{nt||(typeof localStorage!="undefined"&&localStorage.setItem(mt,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:mt,changedParts:e})))}catch{}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===mt){let r=JSON.parse(e.newValue);r&&Nn(r.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",hd)}function hd({data:t}){t&&t.type===mt&&Nn(t.changedParts)}M.rejectionMapper=nf;Fo(Ue,Uo);var qe=class extends rt{constructor(){super(qe.dbName);this.version(qe.dbVersion).stores({searchHistory:"++id",minisearch:"date"})}static async clearOldDatabases(){let e=(await indexedDB.databases()).filter(r=>r.name===qe.dbName&&r.version!==qe.dbVersion*10);if(e.length){console.log("Omnisearch - Those IndexedDb databases will be deleted:");for(let r of e)r.name&&indexedDB.deleteDatabase(r.name)}}static getInstance(){return qe.instance||(qe.instance=new qe),qe.instance}async clearCache(){await this.minisearch.clear()}},ur=qe;ur.dbVersion=8,ur.dbName="omnisearch/cache/"+app.appId;var Re=ur.getInstance();var Kt=mn(!1),bs=class extends X.PluginSettingTab{constructor(e){super(app,e);this.plugin=e,Kt.subscribe(async r=>{P.showExcerpt=r,await ye(this.plugin)})}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Omnisearch"});let r=e.createDiv();r.innerHTML=`
        <iframe src="https://github.com/sponsors/scambier/button" title="Sponsor scambier" height="35" width="116" style="border: 0;"></iframe>
        <a href='https://ko-fi.com/B0B6LQ2C' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://cdn.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
    `,new X.Setting(e).setName("Indexing").setHeading();let n=new DocumentFragment;Qe()?n.createSpan({},u=>{u.innerHTML=`\u{1F44D} You have installed <a href="https://github.com/scambier/obsidian-text-extractor">Text Extractor</a>, Omnisearch will use it to index PDFs and images.
            <br />Text extraction only works on desktop, but the cache can be synchronized with your mobile device.`}):n.createSpan({},u=>{u.innerHTML='\u26A0\uFE0F Omnisearch requires <a href="https://github.com/scambier/obsidian-text-extractor">Text Extractor</a> to index PDFs and images.'}),new X.Setting(e).setDesc(n);let i=new DocumentFragment;i.createSpan({},u=>{u.innerHTML="Include PDFs in search results"}),new X.Setting(e).setName(`PDFs Indexing ${Qe()?"":"\u26A0\uFE0F Disabled"}`).setDesc(i).addToggle(u=>u.setValue(P.PDFIndexing).onChange(async c=>{P.PDFIndexing=c,await ye(this.plugin)})).setDisabled(!Qe());let s=new DocumentFragment;s.createSpan({},u=>{u.innerHTML="Include images in search results"}),new X.Setting(e).setName(`Images Indexing ${Qe()?"":"\u26A0\uFE0F Disabled"}`).setDesc(s).addToggle(u=>u.setValue(P.imagesIndexing).onChange(async c=>{P.imagesIndexing=c,await ye(this.plugin)})).setDisabled(!Qe());let o=new DocumentFragment;o.createSpan({},u=>{u.innerHTML=`In addition to standard <code>md</code> files, Omnisearch can also index other <strong style="color: var(--text-accent)">plaintext</strong> files.<br/>
      Add extensions separated by a space, without the dot. Example: "<code>txt org</code>".<br />
      \u26A0\uFE0F <span style="color: var(--text-accent)">Using extensions of non-plaintext files (like .docx or .pptx) WILL cause crashes,
      because Omnisearch will try to index their content.</span><br />
      <strong style="color: var(--text-accent)">Needs a restart to fully take effect.</strong>`}),new X.Setting(e).setName("Additional files to index").setDesc(o).addText(u=>{u.setValue(P.indexedFileTypes.join(" ")).setPlaceholder("Example: txt org").onChange(async c=>{P.indexedFileTypes=c.split(" "),await ye(this.plugin)})}),new X.Setting(e).setName("Behavior").setHeading(),new X.Setting(e).setName("Save index to cache").setDesc("Enable caching to speed up indexing time. In rare cases, the cache write may cause a freeze in Obsidian. This option will disable itself if it happens.").addToggle(u=>u.setValue(P.useCache).onChange(async c=>{P.useCache=c,await ye(this.plugin)})),new X.Setting(e).setName(`Respect Obsidian's "Excluded Files"`).setDesc(`By default, files that are in Obsidian's "Options > Files & Links > Excluded Files" list are downranked in results.
        Enable this option to completely hide them`).addToggle(u=>u.setValue(P.hideExcluded).onChange(async c=>{P.hideExcluded=c,await ye(this.plugin)}));let a=new DocumentFragment;a.createSpan({},u=>{u.innerHTML=`Normalize diacritics in search terms. Words like "br\xFBl\xE9e" or "\u017Elu\u0165ou\u010Dk\xFD" will be indexed as "brulee" and "zlutoucky".<br/>
        \u26A0\uFE0F <span style="color: var(--text-accent)">You probably should <strong>NOT</strong> disable this.</span><br>
        \u26A0\uFE0F <span style="color: var(--text-accent)">Changing this setting will clear the cache.</span><br>
        <strong style="color: var(--text-accent)">Needs a restart to fully take effect.</strong>
        `}),new X.Setting(e).setName("Ignore diacritics").setDesc(a).addToggle(u=>u.setValue(P.ignoreDiacritics).onChange(async c=>{await Re.clearCache(),P.ignoreDiacritics=c,await ye(this.plugin)})),new X.Setting(e).setName("Simpler search").setDesc(`Enable this if Obsidian often freezes while making searches.
        Words shorter than 3 characters won't be used as prefixes; this can reduce search delay but will return fewer results.`).addToggle(u=>u.setValue(P.simpleSearch).onChange(async c=>{P.simpleSearch=c,await ye(this.plugin)})),new X.Setting(e).setName("User Interface").setHeading(),new X.Setting(e).setName("Show ribbon button").setDesc("Add a button on the sidebar to open the Vault search modal.").addToggle(u=>u.setValue(P.ribbonIcon).onChange(async c=>{P.ribbonIcon=c,await ye(this.plugin),c?this.plugin.addRibbonButton():this.plugin.removeRibbonButton()})),new X.Setting(e).setName("Show excerpts").setDesc("Shows the contextual part of the note that matches the search. Disable this to only show filenames in results.").addToggle(u=>u.setValue(P.showExcerpt).onChange(async c=>{Kt.set(c)})),new X.Setting(e).setName("Render line return in excerpts").setDesc("Activate this option to render line returns in result excerpts.").addToggle(u=>u.setValue(P.renderLineReturnInExcerpts).onChange(async c=>{P.renderLineReturnInExcerpts=c,await ye(this.plugin)})),new X.Setting(e).setName("Show previous query results").setDesc("Re-executes the previous query when opening Omnisearch.").addToggle(u=>u.setValue(P.showPreviousQueryResults).onChange(async c=>{P.showPreviousQueryResults=c,await ye(this.plugin)}));let l=new DocumentFragment;if(l.createSpan({},u=>{u.innerHTML=`Shows a button next to the search input, to create a note.
        Acts the same as the <code>shift \u21B5</code> shortcut, can be useful for mobile device users.`}),new X.Setting(e).setName('Show "Create note" button').setDesc(l).addToggle(u=>u.setValue(P.showCreateButton).onChange(async c=>{P.showCreateButton=c,await ye(this.plugin)})),new X.Setting(e).setName("Highlight matching words in results").setDesc("Will highlight matching results when enabled. See README for more customization options.").addToggle(u=>u.setValue(P.hightlight).onChange(async c=>{P.hightlight=c,await ye(this.plugin)})),new X.Setting(e).setName("Results weighting").setHeading(),new X.Setting(e).setName(`File name & declared aliases (default: ${lr.weightBasename})`).addSlider(u=>this.weightSlider(u,"weightBasename")),new X.Setting(e).setName(`Headings level 1 (default: ${lr.weightH1})`).addSlider(u=>this.weightSlider(u,"weightH1")),new X.Setting(e).setName(`Headings level 2 (default: ${lr.weightH2})`).addSlider(u=>this.weightSlider(u,"weightH2")),new X.Setting(e).setName(`Headings level 3 (default: ${lr.weightH3})`).addSlider(u=>this.weightSlider(u,"weightH3")),yt()){new X.Setting(e).setName("Danger Zone").setHeading();let u=new DocumentFragment;u.createSpan({},c=>{c.innerHTML=`Erase all Omnisearch cache data.
      Use this if Omnisearch results are inconsistent, missing, or appear outdated.<br>
      <strong style="color: var(--text-accent)">Needs a restart to fully take effect.</strong>`}),new X.Setting(e).setName("Clear cache data").setDesc(u).addButton(c=>{c.setButtonText("Clear cache"),c.onClick(async()=>{await Re.clearCache(),new X.Notice("Omnisearch - Cache cleared. Please restart Obsidian.")})})}}weightSlider(e,r){e.setLimits(1,5,.1).setValue(P[r]).setDynamicTooltip().onChange(n=>{P[r]=n,ye(this.plugin)})}},lr={useCache:!0,hideExcluded:!1,ignoreDiacritics:!0,indexedFileTypes:[],PDFIndexing:!1,imagesIndexing:!1,ribbonIcon:!0,showExcerpt:!0,renderLineReturnInExcerpts:!0,showCreateButton:!1,hightlight:!0,showPreviousQueryResults:!0,simpleSearch:!1,weightBasename:2,weightH1:1.5,weightH2:1.3,weightH3:1.1,welcomeMessage:""},P=Object.assign({},lr);async function ha(t){P=Object.assign({},lr,await t.loadData()),Kt.set(P.showExcerpt)}async function ye(t){await t.saveData(P)}var pa=Ae(require("obsidian"));var ma=/^"|"$|^'|'$/g,ga=/[\u4e00-\u9fa5]/,xs=/(?:^|\s)\.(\w+)/g,ya=100,Jr=300,va=`suggestion-highlight omnisearch-highlight ${P.hightlight?"omnisearch-default-highlight":""}`,G=new Ei,Kn={ToggleExcerpts:"toggle-excerpts"},Le=(s=>(s[s.Done=0]="Done",s[s.LoadingCache=1]="LoadingCache",s[s.ReadingFiles=2]="ReadingFiles",s[s.IndexingFiles=3]="IndexingFiles",s[s.WritingCache=4]="WritingCache",s))(Le||{});var vt=mn(0),_a=!1;function ws(t){_a=t}function ba(){return _a}function zn(){return app.plugins.plugins["cm-chs-patch"]}function Qe(){return app.plugins?.plugins?.["text-extractor"]?.api}function yt(){return!pa.Platform.isIosApp&&P.useCache}var Xr=/[|\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var ka=Ae(require("obsidian"));var it=Ae(require("obsidian"));var wa=Ae(require("crypto")),ja=Ae(xa());function _t(t){return`<span class="${va}">${t}</span>`}function pd(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function Aa(t){let e=t.split("/");return e.pop(),e.join("/")}function md(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function bt(t){if(!t.length)return/^$/g;let e=t.map(n=>(zn()?"":"\\b")+md(n)).join("|");return new RegExp(`(${e})`,"gi")}function Vn(t,e){return t.headings?.filter(r=>r.level===e).map(r=>r.heading)??[]}function Hn(t,e){return(t+e)%e}function cr(t,e){try{let r=e??-1,n=Math.max(0,r-ya),i=Math.min(t.length,r+Jr);if(r>-1?t=(n>0?"\u2026":"")+t.slice(n,i).trim()+(i<t.length-1?"\u2026":""):t=t.slice(0,Jr),P.renderLineReturnInExcerpts){let s=new RegExp(/(?:\r\n|\r|\n)/g);t=t.split(s).filter(a=>a).join(`
`);let o=t.lastIndexOf(`
`,r-n);o>0&&(t=t.slice(o))}return t=pd(t),P.renderLineReturnInExcerpts&&(t=t.trim().replaceAll(`
`,"<br>")),t}catch(r){return new it.Notice("Omnisearch - Error while creating excerpt, see developer console"),console.error("Omnisearch - Error while creating excerpt"),console.error(r),""}}function Sa(t){return t.replace(ma,"")}function As(t){return t.replace(/(\*|_)+(.+?)(\*|_)+/g,(e,r,n)=>n)}function Ca(t){return t?.frontmatter?(0,it.parseFrontMatterAliases)(t.frontmatter)??[]:[]}function Fa(t){let e=t?(0,it.getAllTags)(t)??[]:[];return e=[...new Set(e.reduce((r,n)=>[...r,...n.split("/").filter(i=>i).map(i=>i.startsWith("#")?i:`#${i}`),n],[]))],e}function st(t){return t==null?"":(t=t.replaceAll("`","[__omnisearch__backtick__]"),t=t.normalize("NFD").replace(/\p{Diacritic}/gu,""),t=t.replaceAll("[__omnisearch__backtick__]","`"),t)}function Ea(){return it.Platform.isMacOS?"\u2318":"ctrl"}function en(t){let e=!!Qe(),r=e&&P.PDFIndexing,n=e&&P.imagesIndexing;return Ss(t)||Cs(t)||r&&tn(t)||n&&Wn(t)}function Wn(t){return t.endsWith(".png")||t.endsWith(".jpg")||t.endsWith(".jpeg")}function tn(t){return t.endsWith(".pdf")}function Ss(t){return[...P.indexedFileTypes,"md"].some(e=>t.endsWith(`.${e}`))}function Cs(t){return t.endsWith(".canvas")}function Ta(t){let e=t.split(".");return e[e.length-1]??""}function Da(t){return it.Platform.isMobileApp?(0,ja.md5)(t.toString()):(0,wa.createHash)("md5").update(t).digest("hex")}function Oa(t,e){let r=[],n=0,i=t.length;for(;n<i;)r.push(t.slice(n,n+=e));return r}async function gd(t){let e=app.vault.getFiles().find(s=>s.path===t);if(!e)throw new Error(`Invalid file path: "${t}"`);let r=null,n=Qe();if(Ss(t))r=await app.vault.cachedRead(e);else if(Cs(t)){let s=JSON.parse(await app.vault.cachedRead(e)),o=[];for(let a of s.nodes)a.type==="text"?o.push(a.text):a.type==="file"&&o.push(a.file);for(let a of s.edges.filter(l=>!!l.label))o.push(a.label);r=o.join(`\r
`)}else if(n?.canFileBeExtracted(t))r=await n.extractText(e);else throw new Error(`Unsupported file type: "${t}"`);r==null&&(console.warn(`Omnisearch: ${r} content for file`,e.path),r=""),r=st(r);let i=app.metadataCache.getFileCache(e);if(i&&i.frontmatter?.["excalidraw-plugin"]){let s=i.sections?.filter(o=>o.type==="comment")??[];for(let{start:o,end:a}of s.map(l=>l.position))r=r.substring(0,o.offset-1)+r.substring(a.offset)}return{basename:st(e.basename),content:r,path:e.path,mtime:e.stat.mtime,tags:Fa(i),aliases:Ca(i).join(""),headings1:i?Vn(i,1).join(" "):"",headings2:i?Vn(i,2).join(" "):"",headings3:i?Vn(i,3).join(" "):""}}var Ia=class{constructor(){this.nextQueryIsEmpty=!1;this.documents=new Map}async addToLiveCache(e){try{let r=await gd(e);if(!r.path){console.error(`Missing .path field in IndexedDocument "${r.basename}", skipping`);return}this.documents.set(e,r)}catch(r){console.warn(`Omnisearch: Error while adding "${e}" to live cache`,r),this.removeFromLiveCache(e)}}removeFromLiveCache(e){this.documents.delete(e)}async getDocument(e){return this.documents.has(e)?this.documents.get(e):(await this.addToLiveCache(e),this.documents.get(e))}async addToSearchHistory(e){if(!e){this.nextQueryIsEmpty=!0;return}this.nextQueryIsEmpty=!1;let r=await Re.searchHistory.toArray();r=r.filter(n=>n.query!==e).reverse(),r.unshift({query:e}),r=r.slice(0,10),await Re.searchHistory.clear(),await Re.searchHistory.bulkAdd(r)}async getSearchHistory(){let e=(await Re.searchHistory.toArray()).reverse().map(r=>r.query);return this.nextQueryIsEmpty&&e.unshift(""),e}getDocumentsChecksum(e){return Da(JSON.stringify(e.sort((r,n)=>r.path<n.path?-1:r.path>n.path?1:0)))}async getMinisearchCache(){try{return(await Re.minisearch.toArray())[0]}catch(e){return new ka.Notice("Omnisearch - Cache missing or invalid. Some freezes may occur while Omnisearch indexes your vault."),console.error("Omnisearch - Error while loading Minisearch cache"),console.error(e),null}}async writeMinisearchCache(e,r){let n=Array.from(r).map(([i,s])=>({path:i,mtime:s}));await Re.minisearch.clear(),await Re.minisearch.add({date:new Date().toISOString(),paths:n,data:e.toJSON()}),console.log("Omnisearch - Search cache written")}},pe=new Ia;function yd(t){let e,r,n,i,s,o,a,l,u=t[9].default,c=Ut(u,t,t[8],null);return{c(){e=L("div"),r=L("div"),n=L("input"),s=q(),c&&c.c(),z(n,"class","prompt-input"),z(n,"placeholder",t[0]),z(n,"spellcheck","false"),z(n,"type","text"),z(r,"class","omnisearch-input-field"),z(e,"class","omnisearch-input-container")},m(h,d){W(h,e,d),R(e,r),R(r,n),t[10](n),xi(n,t[1]),R(e,s),c&&c.m(e,null),o=!0,a||(l=[ke(n,"input",t[11]),po(i=t[3].call(null,n)),ke(n,"compositionend",t[12]),ke(n,"compositionstart",t[13]),ke(n,"input",t[4])],a=!0)},p(h,[d]){(!o||d&1)&&z(n,"placeholder",h[0]),d&2&&n.value!==h[1]&&xi(n,h[1]),c&&c.p&&(!o||d&256)&&qt(c,u,h,h[8],o?Gt(u,h[8],d,null):Qt(h[8]),null)},i(h){o||(J(c,h),o=!0)},o(h){Z(c,h),o=!1},d(h){h&&H(e),t[10](null),c&&c.d(h),a=!1,Ne(l)}}}function vd(t,e,r){let{$$slots:n={},$$scope:i}=e,{initialValue:s=""}=e,o=!1,{placeholder:a=""}=e,l="",u,c=Ai();function h(y){r(1,l=y)}function d(y){ct().then(()=>(u.focus(),ct())).then(()=>{u.select()})}let g=(0,Pa.debounce)(()=>{pe.addToSearchHistory(""),c("input",l)},250);function _(y){lt[y?"unshift":"push"](()=>{u=y,r(2,u)})}function w(){l=this.value,r(1,l),r(5,s),r(7,o)}let b=y=>ws(!1),f=y=>ws(!0);return t.$$set=y=>{"initialValue"in y&&r(5,s=y.initialValue),"placeholder"in y&&r(0,a=y.placeholder),"$$scope"in y&&r(8,i=y.$$scope)},t.$$.update=()=>{if(t.$$.dirty&162){e:s&&!o&&!l&&(r(7,o=!0),r(1,l=s),d())}},[a,l,u,d,g,s,h,o,i,n,_,w,b,f]}var Ma=class extends ge{constructor(e){super();be(this,e,vd,yd,he,{initialValue:5,placeholder:0,setInputValue:6})}get setInputValue(){return this.$$.ctx[6]}},$n=Ma;function _d(t){let e,r,n,i,s=t[1].default,o=Ut(s,t,t[0],null);return{c(){e=L("div"),o&&o.c(),z(e,"class","prompt-results")},m(a,l){W(a,e,l),o&&o.m(e,null),r=!0,n||(i=ke(e,"mousedown",bd),n=!0)},p(a,[l]){o&&o.p&&(!r||l&1)&&qt(o,s,a,a[0],r?Gt(s,a[0],l,null):Qt(a[0]),null)},i(a){r||(J(o,a),r=!0)},o(a){Z(o,a),r=!1},d(a){a&&H(e),o&&o.d(a),n=!1,i()}}}var bd=t=>t.preventDefault();function xd(t,e,r){let{$$slots:n={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&r(0,i=s.$$scope)},[i,n]}var Ra=class extends ge{constructor(e){super();be(this,e,xd,_d,he,{})}},Un=Ra;var Fs=Ae(require("obsidian"));async function Gn(t,e=!1){let r=bt(t.foundWords);r.exec(t.content);let n=r.lastIndex,i=!1;app.workspace.iterateAllLeaves(a=>{a.view instanceof Fs.MarkdownView&&!e&&a.getViewState().state?.file===t.path&&a.getViewState()?.pinned&&(app.workspace.setActiveLeaf(a,{focus:!0}),i=!0)}),i||await app.workspace.openLinkText(t.path,"",e);let s=app.workspace.getActiveViewOfType(Fs.MarkdownView);if(!s)return;let o=s.editor.offsetToPos(n);o.ch=0,s.editor.setCursor(o),s.editor.scrollIntoView({from:{line:o.line-10,ch:0},to:{line:o.line+10,ch:0}})}async function Ba(t,e=!1){try{let r;switch(app.vault.getConfig("newFileLocation")){case"current":r=(app.workspace.getActiveFile()?.parent.path??"")+"/";break;case"folder":r=app.vault.getConfig("newFileFolderPath")+"/";break;default:r="";break}await app.workspace.openLinkText(`${r}${t}.md`,"",e)}catch(r){throw r.message="OmniSearch - Could not create note: "+r.message,console.error(r),r}}function wd(t){let e;return{c(){e=L("span"),e.innerHTML='<svg viewBox="0 0 100 100" class="add-note-glyph" width="16" height="16"><path fill="currentColor" stroke="currentColor" d="M23.3,6.7c-3.7,0-6.7,3-6.7,6.7v73.3c0,3.7,3,6.7,6.7,6.7h28.4c-3.2-4.8-5.1-10.5-5.1-16.7c0-16.6,13.4-30,30-30 c2.3,0,4.5,0.3,6.7,0.8V31.7c0-0.9-0.3-1.7-1-2.4L60.7,7.6c-0.6-0.6-1.5-1-2.4-1L23.3,6.7z M56.7,13L77,33.3H60 c-1.8,0-3.3-1.5-3.3-3.3L56.7,13z M76.7,53.3c-12.9,0-23.3,10.4-23.3,23.3S63.8,100,76.7,100S100,89.6,100,76.7 S89.6,53.3,76.7,53.3z M76.7,63.3c1.8,0,3.3,1.5,3.3,3.3v6.7h6.7c1.8,0,3.3,1.5,3.3,3.3c0,1.8-1.5,3.3-3.3,3.3H80v6.7 c0,1.8-1.5,3.3-3.3,3.3c-1.8,0-3.3-1.5-3.3-3.3V80h-6.7c-1.8,0-3.3-1.5-3.3-3.3s1.5-3.3,3.3-3.3h6.7v-6.7 C73.3,64.8,74.8,63.3,76.7,63.3L76.7,63.3z"></path></svg>',z(e,"class","suggestion-flair"),z(e,"aria-label","Not created yet, select to create")},m(r,n){W(r,e,n)},p:ae,i:ae,o:ae,d(r){r&&H(e)}}}function jd(t){"use strict";return[]}var La=class extends ge{constructor(e){super();be(this,e,jd,wd,he,{})}},Na=La;function Ka(t){let e,r;return e=new Na({}),{c(){Te(e.$$.fragment)},m(n,i){Se(e,n,i),r=!0},i(n){r||(J(e.$$.fragment,n),r=!0)},o(n){Z(e.$$.fragment,n),r=!1},d(n){_e(e,n)}}}function Ad(t){let e,r,n,i,s,o=t[2]&&Ka(t),a=t[4].default,l=Ut(a,t,t[3],null);return{c(){e=L("div"),o&&o.c(),r=q(),l&&l.c(),z(e,"data-result-id",t[0]),z(e,"class","suggestion-item omnisearch-result"),wi(e,"is-selected",t[1])},m(u,c){W(u,e,c),o&&o.m(e,null),R(e,r),l&&l.m(e,null),n=!0,i||(s=[ke(e,"mousemove",t[5]),ke(e,"click",t[6]),ke(e,"auxclick",t[7])],i=!0)},p(u,[c]){u[2]?o?c&4&&J(o,1):(o=Ka(u),o.c(),J(o,1),o.m(e,r)):o&&(Ot(),Z(o,1,1,()=>{o=null}),kt()),l&&l.p&&(!n||c&8)&&qt(l,a,u,u[3],n?Gt(a,u[3],c,null):Qt(u[3]),null),(!n||c&1)&&z(e,"data-result-id",u[0]),(!n||c&2)&&wi(e,"is-selected",u[1])},i(u){n||(J(o),J(l,u),n=!0)},o(u){Z(o),Z(l,u),n=!1},d(u){u&&H(e),o&&o.d(),l&&l.d(u),i=!1,Ne(s)}}}function Sd(t,e,r){let{$$slots:n={},$$scope:i}=e,{id:s}=e,{selected:o=!1}=e,{glyph:a=!1}=e;function l(h){$e.call(this,t,h)}function u(h){$e.call(this,t,h)}function c(h){$e.call(this,t,h)}return t.$$set=h=>{"id"in h&&r(0,s=h.id),"selected"in h&&r(1,o=h.selected),"glyph"in h&&r(2,a=h.glyph),"$$scope"in h&&r(3,i=h.$$scope)},[s,o,a,i,n,l,u,c]}var za=class extends ge{constructor(e){super();be(this,e,Sd,Ad,he,{id:0,selected:1,glyph:2})}},qn=za;var rn=Ae(require("obsidian"));function Va(t){let e,r=t[1].matches.length+"",n,i,s=(t[1].matches.length>1?"matches":"match")+"",o;return{c(){e=L("span"),n=Be(r),i=Be("\xA0"),o=Be(s),z(e,"class","omnisearch-result__counter")},m(a,l){W(a,e,l),R(e,n),R(e,i),R(e,o)},p(a,l){l&2&&r!==(r=a[1].matches.length+"")&&Jt(n,r),l&2&&s!==(s=(a[1].matches.length>1?"matches":"match")+"")&&Jt(o,s)},d(a){a&&H(e)}}}function Ha(t){let e,r=t[7].replace(t[8],_t)+"";return{c(){e=L("div"),z(e,"class","omnisearch-result__body")},m(n,i){W(n,e,i),e.innerHTML=r},p(n,i){i&384&&r!==(r=n[7].replace(n[8],_t)+"")&&(e.innerHTML=r)},d(n){n&&H(e)}}}function Wa(t){let e,r,n;return{c(){e=L("div"),r=L("img"),Ie(r,"width","100px"),bi(r.src,n=t[4])||z(r,"src",n),z(r,"alt",""),z(e,"class","omnisearch-result__image-container")},m(i,s){W(i,e,s),R(e,r)},p(i,s){s&16&&!bi(r.src,n=i[4])&&z(r,"src",n)},d(i){i&&H(e)}}}function Cd(t){let e,r,n,i,s=t[2].replace(t[8],_t)+"",o,a,l,u,c,h,d,g,_,w,b=t[1].matches.length>0&&Va(t),f=t[9]&&Ha(t),y=t[4]&&Wa(t);return{c(){e=L("div"),r=L("div"),n=L("span"),i=L("span"),o=q(),b&&b.c(),a=q(),l=L("div"),u=L("span"),c=q(),h=L("span"),d=Be(t[5]),g=q(),_=L("div"),f&&f.c(),w=q(),y&&y.c(),z(n,"class","omnisearch-result__title"),z(r,"class","omnisearch-result__title-container"),z(l,"class","omnisearch-result__folder-path"),Ie(_,"display","flex"),Ie(_,"flex-direction","row")},m(p,m){W(p,e,m),R(e,r),R(r,n),R(n,i),i.innerHTML=s,R(n,o),b&&b.m(n,null),R(e,a),R(e,l),R(l,u),t[10](u),R(l,c),R(l,h),R(h,d),R(e,g),R(e,_),f&&f.m(_,null),R(_,w),y&&y.m(_,null)},p(p,m){m&260&&s!==(s=p[2].replace(p[8],_t)+"")&&(i.innerHTML=s),p[1].matches.length>0?b?b.p(p,m):(b=Va(p),b.c(),b.m(n,null)):b&&(b.d(1),b=null),m&32&&Jt(d,p[5]),p[9]?f?f.p(p,m):(f=Ha(p),f.c(),f.m(_,w)):f&&(f.d(1),f=null),p[4]?y?y.p(p,m):(y=Wa(p),y.c(),y.m(_,null)):y&&(y.d(1),y=null)},d(p){p&&H(e),b&&b.d(),t[10](null),f&&f.d(),y&&y.d()}}}function Fd(t){let e,r;return e=new qn({props:{glyph:t[6],id:t[1].path,selected:t[0],$$slots:{default:[Cd]},$$scope:{ctx:t}}}),e.$on("click",t[11]),e.$on("mousemove",t[12]),{c(){Te(e.$$.fragment)},m(n,i){Se(e,n,i),r=!0},p(n,[i]){let s={};i&64&&(s.glyph=n[6]),i&2&&(s.id=n[1].path),i&1&&(s.selected=n[0]),i&17342&&(s.$$scope={dirty:i,ctx:n}),e.$set(s)},i(n){r||(J(e.$$.fragment,n),r=!0)},o(n){Z(e.$$.fragment,n),r=!1},d(n){_e(e,n)}}}function Ed(t,e,r){let n,i,s,o;cn(t,Kt,f=>r(9,o=f));let{selected:a=!1}=e,{note:l}=e,u=null,c="",h="",d,g;function _(f){lt[f?"unshift":"push"](()=>{d=f,r(3,d)})}function w(f){$e.call(this,t,f)}function b(f){$e.call(this,t,f)}t.$$set=f=>{"selected"in f&&r(0,a=f.selected),"note"in f&&r(1,l=f.note)},t.$$.update=()=>{if(t.$$.dirty&2){e:if(r(4,u=null),Wn(l.path)){let f=app.vault.getFiles().find(y=>y.path===l.path);f&&r(4,u=app.vault.getResourcePath(f))}}if(t.$$.dirty&2){e:r(8,n=bt(l.foundWords))}if(t.$$.dirty&2){e:r(7,i=cr(l.content,l.matches[0]?.offset??-1))}if(t.$$.dirty&14){e:r(2,c=l.basename),r(5,h=Aa(l.path)),P.ignoreDiacritics&&r(2,c=st(c)),d&&(0,rn.setIcon)(d,"folder-open"),g&&(Wn(l.path)?(0,rn.setIcon)(g,"file-image"):tn(l.path)?(0,rn.setIcon)(g,"file-line-chart"):(0,rn.setIcon)(g,"file-text"))}};e:r(6,s=!1);return[a,l,c,d,u,h,s,i,n,o,_,w,b]}var $a=class extends ge{constructor(e){super();be(this,e,Ed,Fd,he,{selected:0,note:1})}},Ua=$a;function Ga(t,e){e?e.offsets=typeof e.offsets=="undefined"?!0:e.offsets:e={offsets:!0,tokenize:!0},t||(t="");let r={text:[],offsets:[],exclude:{text:[]}};e.offsets&&(r.offsets=[]);let n={text:[]},i=[],s=/(\S+:'(?:[^'\\]|\\.)*')|(\S+:"(?:[^"\\]|\\.)*")|(-?"(?:[^"\\]|\\.)*")|(-?'(?:[^'\\]|\\.)*')|\S+|\S+:\S+/g,o,a=0;for(;(o=s.exec(t))!==null&&!(++a>=100);){let u=o[0],c=u.indexOf(":");if(c!==-1){let h=u.slice(0,c),d=u.slice(c+1);d=(d+"").replace(/\\(.?)/g,function(g,_){switch(_){case"\\":return"\\";case"0":return"\0";case"":return"";default:return _}}),i.push({keyword:h,value:d,offsetStart:o.index,offsetEnd:o.index+u.length})}else{let h=!1;u[0]==="-"&&(h=!0,u=u.slice(1)),u=(u+"").replace(/\\(.?)/g,function(d,g){switch(g){case"\\":return"\\";case"0":return"\0";case"":return"";default:return g}}),h?n.text.push(u):i.push({text:u,offsetStart:o.index,offsetEnd:o.index+u.length})}}i.reverse();let l;for(;l=i.pop();)if(l.text)r.text.push(l.text),e.offsets&&r.offsets.push(l);else if(l.keyword){let u=l.keyword;e.keywords=e.keywords||[];let c=!1,h=!1;if(!/^-/.test(u))c=e.keywords.indexOf(u)!==-1;else if(u[0]==="-"){let g=u.slice(1);c=e.keywords.indexOf(g)!==-1,c&&(u=g,h=!0)}e.ranges=e.ranges||[];let d=e.ranges.indexOf(u)!==-1;if(c){e.offsets&&r.offsets.push({keyword:u,value:l.value,offsetStart:h?l.offsetStart+1:l.offsetStart,offsetEnd:l.offsetEnd});let g=l.value;if(g.length){let _=g.split(",");h?n[u]?n[u]instanceof Array?_.length>1?n[u]=n[u].concat(_):n[u].push(g):(n[u]=[n[u]],n[u].push(g)):_.length>1?n[u]=_:e.alwaysArray?n[u]=[g]:n[u]=g:r[u]?r[u]instanceof Array?_.length>1?r[u]=r[u].concat(_):r[u].push(g):(r[u]=[r[u]],r[u].push(g)):_.length>1?r[u]=_:e.alwaysArray?r[u]=[g]:r[u]=g}}else if(d){e.offsets&&r.offsets.push(l);let g=l.value,_=g.split("-");r[u]={},_.length===2?(r[u].from=_[0],r[u].to=_[1]):r[u].from=g}else{let g=l.keyword+":"+l.value;r.text.push(g),e.offsets&&r.offsets.push({text:g,offsetStart:l.offsetStart,offsetEnd:l.offsetEnd})}}return r.exclude=n,r}var zt=class{constructor(e=""){this.segments=[];this.exclusions=[];this.extensions=[];this.extensions=this.extractExtensions(e),e=this.removeExtensions(e),P.ignoreDiacritics&&(e=st(e));let r=Ga(e.toLowerCase(),{tokenize:!0});this.exclusions=r.exclude.text.map(this.formatToken).filter(n=>!!n.value),this.segments=r.text.reduce((n,i)=>{let s=this.formatToken(i);return s.value&&n.push(s),n},[])}isEmpty(){return this.segments.length===0}segmentsToStr(){return this.segments.map(({value:e})=>e).join(" ")}getExactTerms(){return this.segments.filter(({exact:e})=>e).map(({value:e})=>e)}formatToken(e){let r=Sa(e);return{value:r,exact:r!==e}}extractExtensions(e){let r=(e.match(xs)??[]).map(n=>n.trim());return r?r.map(n=>n.toLowerCase()):[]}removeExtensions(e){return e.replace(xs,"")}};var ie=function(){return ie=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ie.apply(this,arguments)};function Td(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(c){try{u(n.next(c))}catch(h){o(h)}}function l(c){try{u(n.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((n=n.apply(t,e||[])).next())})}function Dd(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(c){u=[6,c],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function $(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ce(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}var Od="ENTRIES",qa="KEYS",Qa="VALUES",ve="",Es=function(){function t(e,r){var n=e._tree,i=Array.from(n.keys());this.set=e,this._type=r,this._path=i.length>0?[{node:n,keys:i}]:[]}return t.prototype.next=function(){var e=this.dive();return this.backtrack(),e},t.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=fr(this._path),r=e.node,n=e.keys;if(fr(n)===ve)return{done:!1,value:this.result()};var i=r.get(fr(n));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},t.prototype.backtrack=function(){if(this._path.length!==0){var e=fr(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},t.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var r=e.keys;return fr(r)}).filter(function(e){return e!==ve}).join("")},t.prototype.value=function(){return fr(this._path).node.get(ve)},t.prototype.result=function(){switch(this._type){case Qa:return this.value();case qa:return this.key();default:return[this.key(),this.value()]}},t.prototype[Symbol.iterator]=function(){return this},t}(),fr=function(t){return t[t.length-1]},kd=function(t,e,r){var n=new Map;if(e===void 0)return n;for(var i=e.length+1,s=i+r,o=new Uint8Array(s*i).fill(r+1),a=0;a<i;++a)o[a]=a;for(var l=1;l<s;++l)o[l*i]=l;return Ya(t,e,r,n,o,1,i,""),n},Ya=function(t,e,r,n,i,s,o,a){var l,u,c=s*o;try{e:for(var h=$(t.keys()),d=h.next();!d.done;d=h.next()){var g=d.value;if(g===ve){var _=i[c-1];_<=r&&n.set(a,[t.get(g),_])}else{for(var w=s,b=0;b<g.length;++b,++w){for(var f=g[b],y=o*w,p=y-o,m=i[y],v=Math.max(0,w-r-1),x=Math.min(o-1,w+r),j=v;j<x;++j){var C=f!==e[j],E=i[p+j]+ +C,T=i[p+j+1]+1,I=i[y+j]+1,B=i[y+j+1]=Math.min(E,T,I);B<m&&(m=B)}if(m>r)continue e}Ya(t.get(g),e,r,n,i,w,o,a+g)}}}catch(O){l={error:O}}finally{try{d&&!d.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}},Ts=function(){function t(e,r){e===void 0&&(e=new Map),r===void 0&&(r=""),this._size=void 0,this._tree=e,this._prefix=r}return t.prototype.atPrefix=function(e){var r,n;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=ce(Qn(this._tree,e.slice(this._prefix.length)),2),s=i[0],o=i[1];if(s===void 0){var a=ce(ks(o),2),l=a[0],u=a[1];try{for(var c=$(l.keys()),h=c.next();!h.done;h=c.next()){var d=h.value;if(d!==ve&&d.startsWith(u)){var g=new Map;return g.set(d.slice(u.length),l.get(d)),new t(g,e)}}}catch(_){r={error:_}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}return new t(s,e)},t.prototype.clear=function(){this._size=void 0,this._tree.clear()},t.prototype.delete=function(e){return this._size=void 0,Id(this._tree,e)},t.prototype.entries=function(){return new Es(this,Od)},t.prototype.forEach=function(e){var r,n;try{for(var i=$(this),s=i.next();!s.done;s=i.next()){var o=ce(s.value,2),a=o[0],l=o[1];e(a,l,this)}}catch(u){r={error:u}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.fuzzyGet=function(e,r){return kd(this._tree,e,r)},t.prototype.get=function(e){var r=Ds(this._tree,e);return r!==void 0?r.get(ve):void 0},t.prototype.has=function(e){var r=Ds(this._tree,e);return r!==void 0&&r.has(ve)},t.prototype.keys=function(){return new Es(this,qa)},t.prototype.set=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Os(this._tree,e);return n.set(ve,r),this},Object.defineProperty(t.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),t.prototype.update=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Os(this._tree,e);return n.set(ve,r(n.get(ve))),this},t.prototype.fetch=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Os(this._tree,e),i=n.get(ve);return i===void 0&&n.set(ve,i=r()),i},t.prototype.values=function(){return new Es(this,Qa)},t.prototype[Symbol.iterator]=function(){return this.entries()},t.from=function(e){var r,n,i=new t;try{for(var s=$(e),o=s.next();!o.done;o=s.next()){var a=ce(o.value,2),l=a[0],u=a[1];i.set(l,u)}}catch(c){r={error:c}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},t.fromObject=function(e){return t.from(Object.entries(e))},t}(),Qn=function(t,e,r){var n,i;if(r===void 0&&(r=[]),e.length===0||t==null)return[t,r];try{for(var s=$(t.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;if(a!==ve&&e.startsWith(a))return r.push([t,a]),Qn(t.get(a),e.slice(a.length),r)}}catch(l){n={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return r.push([t,e]),Qn(void 0,"",r)},Ds=function(t,e){var r,n;if(e.length===0||t==null)return t;try{for(var i=$(t.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!==ve&&e.startsWith(o))return Ds(t.get(o),e.slice(o.length))}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},Os=function(t,e){var r,n,i=e.length;e:for(var s=0;t&&s<i;){try{for(var o=(r=void 0,$(t.keys())),a=o.next();!a.done;a=o.next()){var l=a.value;if(l!==ve&&e[s]===l[0]){for(var u=Math.min(i-s,l.length),c=1;c<u&&e[s+c]===l[c];)++c;var h=t.get(l);if(c===l.length)t=h;else{var d=new Map;d.set(l.slice(c),h),t.set(e.slice(s,s+c),d),t.delete(l),t=d}s+=c;continue e}}}catch(_){r={error:_}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}var g=new Map;return t.set(e.slice(s),g),g}return t},Id=function(t,e){var r=ce(Qn(t,e),2),n=r[0],i=r[1];if(n!==void 0){if(n.delete(ve),n.size===0)Ja(i);else if(n.size===1){var s=ce(n.entries().next().value,2),o=s[0],a=s[1];Xa(i,o,a)}}},Ja=function(t){if(t.length!==0){var e=ce(ks(t),2),r=e[0],n=e[1];if(r.delete(n),r.size===0)Ja(t.slice(0,-1));else if(r.size===1){var i=ce(r.entries().next().value,2),s=i[0],o=i[1];s!==ve&&Xa(t.slice(0,-1),s,o)}}},Xa=function(t,e,r){if(t.length!==0){var n=ce(ks(t),2),i=n[0],s=n[1];i.set(s+e,r),i.delete(s)}},ks=function(t){return t[t.length-1]},nn,Is="or",Za="and",Pd="and_not",Ps=function(){function t(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var r=e.autoVacuum==null||e.autoVacuum===!0?Ns:e.autoVacuum;this._options=ie(ie(ie({},Rs),e),{autoVacuum:r,searchOptions:ie(ie({},eu),e.searchOptions||{}),autoSuggestOptions:ie(ie({},Nd),e.autoSuggestOptions||{})}),this._index=new Ts,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Ls,this.addFields(this._options.fields)}return t.prototype.add=function(e){var r,n,i,s,o,a,l=this._options,u=l.extractField,c=l.tokenize,h=l.processTerm,d=l.fields,g=l.idField,_=u(e,g);if(_==null)throw new Error('MiniSearch: document does not have ID field "'.concat(g,'"'));if(this._idToShortId.has(_))throw new Error("MiniSearch: duplicate ID ".concat(_));var w=this.addDocumentId(_);this.saveStoredFields(w,e);try{for(var b=$(d),f=b.next();!f.done;f=b.next()){var y=f.value,p=u(e,y);if(p!=null){var m=c(p.toString(),y),v=this._fieldIds[y],x=new Set(m).size;this.addFieldLength(w,v,this._documentCount-1,x);try{for(var j=(i=void 0,$(m)),C=j.next();!C.done;C=j.next()){var E=C.value,T=h(E,y);if(Array.isArray(T))try{for(var I=(o=void 0,$(T)),B=I.next();!B.done;B=I.next()){var O=B.value;this.addTerm(v,w,O)}}catch(K){o={error:K}}finally{try{B&&!B.done&&(a=I.return)&&a.call(I)}finally{if(o)throw o.error}}else T&&this.addTerm(v,w,T)}}catch(K){i={error:K}}finally{try{C&&!C.done&&(s=j.return)&&s.call(j)}finally{if(i)throw i.error}}}}}catch(K){r={error:K}}finally{try{f&&!f.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}},t.prototype.addAll=function(e){var r,n;try{for(var i=$(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.add(o)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.addAllAsync=function(e,r){var n=this;r===void 0&&(r={});var i=r.chunkSize,s=i===void 0?10:i,o={chunk:[],promise:Promise.resolve()},a=e.reduce(function(c,h,d){var g=c.chunk,_=c.promise;return g.push(h),(d+1)%s==0?{chunk:[],promise:_.then(function(){return new Promise(function(w){return setTimeout(w,0)})}).then(function(){return n.addAll(g)})}:{chunk:g,promise:_}},o),l=a.chunk,u=a.promise;return u.then(function(){return n.addAll(l)})},t.prototype.remove=function(e){var r,n,i,s,o,a,l=this._options,u=l.tokenize,c=l.processTerm,h=l.extractField,d=l.fields,g=l.idField,_=h(e,g);if(_==null)throw new Error('MiniSearch: document does not have ID field "'.concat(g,'"'));var w=this._idToShortId.get(_);if(w==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(_,": it is not in the index"));try{for(var b=$(d),f=b.next();!f.done;f=b.next()){var y=f.value,p=h(e,y);if(p!=null){var m=u(p.toString(),y),v=this._fieldIds[y],x=new Set(m).size;this.removeFieldLength(w,v,this._documentCount,x);try{for(var j=(i=void 0,$(m)),C=j.next();!C.done;C=j.next()){var E=C.value,T=c(E,y);if(Array.isArray(T))try{for(var I=(o=void 0,$(T)),B=I.next();!B.done;B=I.next()){var O=B.value;this.removeTerm(v,w,O)}}catch(K){o={error:K}}finally{try{B&&!B.done&&(a=I.return)&&a.call(I)}finally{if(o)throw o.error}}else T&&this.removeTerm(v,w,T)}}catch(K){i={error:K}}finally{try{C&&!C.done&&(s=j.return)&&s.call(j)}finally{if(i)throw i.error}}}}}catch(K){r={error:K}}finally{try{f&&!f.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}this._storedFields.delete(w),this._documentIds.delete(w),this._idToShortId.delete(_),this._fieldLength.delete(w),this._documentCount-=1},t.prototype.removeAll=function(e){var r,n;if(e)try{for(var i=$(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.remove(o)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new Ts,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},t.prototype.discard=function(e){var r=this,n=this._idToShortId.get(e);if(n==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(n),this._storedFields.delete(n),(this._fieldLength.get(n)||[]).forEach(function(i,s){r.removeFieldLength(n,s,r._documentCount,i)}),this._fieldLength.delete(n),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},t.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,r=e.minDirtFactor,n=e.minDirtCount,i=e.batchSize,s=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:n,minDirtFactor:r})}},t.prototype.discardAll=function(e){var r,n,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var s=$(e),o=s.next();!o.done;o=s.next()){var a=o.value;this.discard(a)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},t.prototype.replace=function(e){var r=this._options,n=r.idField,i=r.extractField,s=i(e,n);this.discard(s),this.add(e)},t.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},t.prototype.conditionalVacuum=function(e,r){var n=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&r,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=n._enqueuedVacuumConditions;return n._enqueuedVacuumConditions=Ls,n.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(r)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},t.prototype.performVacuuming=function(e,r){return Td(this,void 0,void 0,function(){var n,i,s,o,a,l,u,c,h,d,g,_,w,b,f,y,p,m,v,x,j,C,E,T,I;return Dd(this,function(B){switch(B.label){case 0:if(n=this._dirtCount,!this.vacuumConditionsMet(r))return[3,10];i=e.batchSize||Bs.batchSize,s=e.batchWait||Bs.batchWait,o=1,B.label=1;case 1:B.trys.push([1,7,8,9]),a=$(this._index),l=a.next(),B.label=2;case 2:if(l.done)return[3,6];u=ce(l.value,2),c=u[0],h=u[1];try{for(d=(C=void 0,$(h)),g=d.next();!g.done;g=d.next()){_=ce(g.value,2),w=_[0],b=_[1];try{for(f=(T=void 0,$(b)),y=f.next();!y.done;y=f.next())p=ce(y.value,1),m=p[0],!this._documentIds.has(m)&&(b.size<=1?h.delete(w):b.delete(m))}catch(O){T={error:O}}finally{try{y&&!y.done&&(I=f.return)&&I.call(f)}finally{if(T)throw T.error}}}}catch(O){C={error:O}}finally{try{g&&!g.done&&(E=d.return)&&E.call(d)}finally{if(C)throw C.error}}return this._index.get(c).size===0&&this._index.delete(c),o%i!=0?[3,4]:[4,new Promise(function(O){return setTimeout(O,s)})];case 3:B.sent(),B.label=4;case 4:o+=1,B.label=5;case 5:return l=a.next(),[3,2];case 6:return[3,9];case 7:return v=B.sent(),x={error:v},[3,9];case 8:try{l&&!l.done&&(j=a.return)&&j.call(a)}finally{if(x)throw x.error}return[7];case 9:this._dirtCount-=n,B.label=10;case 10:return[4,null];case 11:return B.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},t.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var r=e.minDirtCount,n=e.minDirtFactor;return r=r||Ns.minDirtCount,n=n||Ns.minDirtFactor,this.dirtCount>=r&&this.dirtFactor>=n},Object.defineProperty(t.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),t.prototype.has=function(e){return this._idToShortId.has(e)},t.prototype.search=function(e,r){var n,i;r===void 0&&(r={});var s=this.executeQuery(e,r),o=[];try{for(var a=$(s),l=a.next();!l.done;l=a.next()){var u=ce(l.value,2),c=u[0],h=u[1],d=h.score,g=h.terms,_=h.match,w=g.length,b={id:this._documentIds.get(c),score:d*w,terms:Object.keys(_),match:_};Object.assign(b,this._storedFields.get(c)),(r.filter==null||r.filter(b))&&o.push(b)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o.sort(ru),o},t.prototype.autoSuggest=function(e,r){var n,i,s,o;r===void 0&&(r={}),r=ie(ie({},this._options.autoSuggestOptions),r);var a=new Map;try{for(var l=$(this.search(e,r)),u=l.next();!u.done;u=l.next()){var c=u.value,h=c.score,d=c.terms,g=d.join(" "),_=a.get(g);_!=null?(_.score+=h,_.count+=1):a.set(g,{score:h,terms:d,count:1})}}catch(v){n={error:v}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}var w=[];try{for(var b=$(a),f=b.next();!f.done;f=b.next()){var y=ce(f.value,2),_=y[0],p=y[1],h=p.score,d=p.terms,m=p.count;w.push({suggestion:_,terms:d,score:h/m})}}catch(v){s={error:v}}finally{try{f&&!f.done&&(o=b.return)&&o.call(b)}finally{if(s)throw s.error}}return w.sort(ru),w},Object.defineProperty(t.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),t.loadJSON=function(e,r){if(r==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),r)},t.getDefault=function(e){if(Rs.hasOwnProperty(e))return Ms(Rs,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},t.loadJS=function(e,r){var n,i,s,o,a,l,u=e.index,c=e.documentCount,h=e.nextId,d=e.documentIds,g=e.fieldIds,_=e.fieldLength,w=e.averageFieldLength,b=e.storedFields,f=e.dirtCount,y=e.serializationVersion;if(y!==1&&y!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var p=new t(r);p._documentCount=c,p._nextId=h,p._documentIds=Yn(d),p._idToShortId=new Map,p._fieldIds=g,p._fieldLength=Yn(_),p._avgFieldLength=w,p._storedFields=Yn(b),p._dirtCount=f||0,p._index=new Ts;try{for(var m=$(p._documentIds),v=m.next();!v.done;v=m.next()){var x=ce(v.value,2),j=x[0],C=x[1];p._idToShortId.set(C,j)}}catch(S){n={error:S}}finally{try{v&&!v.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}try{for(var E=$(u),T=E.next();!T.done;T=E.next()){var I=ce(T.value,2),B=I[0],O=I[1],K=new Map;try{for(var Y=(a=void 0,$(Object.keys(O))),U=Y.next();!U.done;U=Y.next()){var D=U.value,A=O[D];y===1&&(A=A.ds),K.set(parseInt(D,10),Yn(A))}}catch(S){a={error:S}}finally{try{U&&!U.done&&(l=Y.return)&&l.call(Y)}finally{if(a)throw a.error}}p._index.set(B,K)}}catch(S){s={error:S}}finally{try{T&&!T.done&&(o=E.return)&&o.call(E)}finally{if(s)throw s.error}}return p},t.prototype.executeQuery=function(e,r){var n=this;if(r===void 0&&(r={}),typeof e!="string"){var i=ie(ie(ie({},r),e),{queries:void 0}),s=e.queries.map(function(b){return n.executeQuery(b,i)});return this.combineResults(s,e.combineWith)}var o=this._options,a=o.tokenize,l=o.processTerm,u=o.searchOptions,c=ie(ie({tokenize:a,processTerm:l},u),r),h=c.tokenize,d=c.processTerm,g=h(e).flatMap(function(b){return d(b)}).filter(function(b){return!!b}),_=g.map(Ld(c)),w=_.map(function(b){return n.executeQuerySpec(b,c)});return this.combineResults(w,c.combineWith)},t.prototype.executeQuerySpec=function(e,r){var n,i,s,o,a=ie(ie({},this._options.searchOptions),r),l=(a.fields||this._options.fields).reduce(function(D,A){var S;return ie(ie({},D),(S={},S[A]=Ms(D,A)||1,S))},a.boost||{}),u=a.boostDocument,c=a.weights,h=a.maxFuzzy,d=a.bm25,g=ie(ie({},eu.weights),c),_=g.fuzzy,w=g.prefix,b=this._index.get(e.term),f=this.termResults(e.term,e.term,1,b,l,u,d),y,p;if(e.prefix&&(y=this._index.atPrefix(e.term)),e.fuzzy){var m=e.fuzzy===!0?.2:e.fuzzy,v=m<1?Math.min(h,Math.round(e.term.length*m)):m;v&&(p=this._index.fuzzyGet(e.term,v))}if(y)try{for(var x=$(y),j=x.next();!j.done;j=x.next()){var C=ce(j.value,2),E=C[0],T=C[1],I=E.length-e.term.length;if(!!I){p==null||p.delete(E);var B=w*E.length/(E.length+.3*I);this.termResults(e.term,E,B,T,l,u,d,f)}}}catch(D){n={error:D}}finally{try{j&&!j.done&&(i=x.return)&&i.call(x)}finally{if(n)throw n.error}}if(p)try{for(var O=$(p.keys()),K=O.next();!K.done;K=O.next()){var E=K.value,Y=ce(p.get(E),2),U=Y[0],I=Y[1];if(!!I){var B=_*E.length/(E.length+I);this.termResults(e.term,E,B,U,l,u,d,f)}}}catch(D){s={error:D}}finally{try{K&&!K.done&&(o=O.return)&&o.call(O)}finally{if(s)throw s.error}}return f},t.prototype.combineResults=function(e,r){if(r===void 0&&(r=Is),e.length===0)return new Map;var n=r.toLowerCase();return e.reduce(Md[n])||new Map},t.prototype.toJSON=function(){var e,r,n,i,s=[];try{for(var o=$(this._index),a=o.next();!a.done;a=o.next()){var l=ce(a.value,2),u=l[0],c=l[1],h={};try{for(var d=(n=void 0,$(c)),g=d.next();!g.done;g=d.next()){var _=ce(g.value,2),w=_[0],b=_[1];h[w]=Object.fromEntries(b)}}catch(f){n={error:f}}finally{try{g&&!g.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}s.push([u,h])}}catch(f){e={error:f}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:s,serializationVersion:2}},t.prototype.termResults=function(e,r,n,i,s,o,a,l){var u,c,h,d,g;if(l===void 0&&(l=new Map),i==null)return l;try{for(var _=$(Object.keys(s)),w=_.next();!w.done;w=_.next()){var b=w.value,f=s[b],y=this._fieldIds[b],p=i.get(y);if(p!=null){var m=p.size,v=this._avgFieldLength[y];try{for(var x=(h=void 0,$(p.keys())),j=x.next();!j.done;j=x.next()){var C=j.value;if(!this._documentIds.has(C)){this.removeTerm(y,C,r),m-=1;continue}var E=o?o(this._documentIds.get(C),r):1;if(!!E){var T=p.get(C),I=this._fieldLength.get(C)[y],B=Bd(T,m,this._documentCount,I,v,a),O=n*f*E*B,K=l.get(C);if(K){K.score+=O,Kd(K.terms,e);var Y=Ms(K.match,r);Y?Y.push(b):K.match[r]=[b]}else l.set(C,{score:O,terms:[e],match:(g={},g[r]=[b],g)})}}}catch(U){h={error:U}}finally{try{j&&!j.done&&(d=x.return)&&d.call(x)}finally{if(h)throw h.error}}}}}catch(U){u={error:U}}finally{try{w&&!w.done&&(c=_.return)&&c.call(_)}finally{if(u)throw u.error}}return l},t.prototype.addTerm=function(e,r,n){var i=this._index.fetch(n,nu),s=i.get(e);if(s==null)s=new Map,s.set(r,1),i.set(e,s);else{var o=s.get(r);s.set(r,(o||0)+1)}},t.prototype.removeTerm=function(e,r,n){if(!this._index.has(n)){this.warnDocumentChanged(r,e,n);return}var i=this._index.fetch(n,nu),s=i.get(e);s==null||s.get(r)==null?this.warnDocumentChanged(r,e,n):s.get(r)<=1?s.size<=1?i.delete(e):s.delete(r):s.set(r,s.get(r)-1),this._index.get(n).size===0&&this._index.delete(n)},t.prototype.warnDocumentChanged=function(e,r,n){var i,s;try{for(var o=$(Object.keys(this._fieldIds)),a=o.next();!a.done;a=o.next()){var l=a.value;if(this._fieldIds[l]===r){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(n,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.addDocumentId=function(e){var r=this._nextId;return this._idToShortId.set(e,r),this._documentIds.set(r,e),this._documentCount+=1,this._nextId+=1,r},t.prototype.addFields=function(e){for(var r=0;r<e.length;r++)this._fieldIds[e[r]]=r},t.prototype.addFieldLength=function(e,r,n,i){var s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[r]=i;var o=this._avgFieldLength[r]||0,a=o*n+i;this._avgFieldLength[r]=a/(n+1)},t.prototype.removeFieldLength=function(e,r,n,i){if(n===1){this._avgFieldLength[r]=0;return}var s=this._avgFieldLength[r]*n-i;this._avgFieldLength[r]=s/(n-1)},t.prototype.saveStoredFields=function(e,r){var n,i,s=this._options,o=s.storeFields,a=s.extractField;if(!(o==null||o.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var u=$(o),c=u.next();!c.done;c=u.next()){var h=c.value,d=a(r,h);d!==void 0&&(l[h]=d)}}catch(g){n={error:g}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}},t}(),Ms=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},Md=(nn={},nn[Is]=function(t,e){var r,n;try{for(var i=$(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=t.get(o);if(a==null)t.set(o,e.get(o));else{var l=e.get(o),u=l.score,c=l.terms,h=l.match;a.score=a.score+u,a.match=Object.assign(a.match,h),tu(a.terms,c)}}}catch(d){r={error:d}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},nn[Za]=function(t,e){var r,n,i=new Map;try{for(var s=$(e.keys()),o=s.next();!o.done;o=s.next()){var a=o.value,l=t.get(a);if(l!=null){var u=e.get(a),c=u.score,h=u.terms,d=u.match;tu(l.terms,h),i.set(a,{score:l.score+c,terms:l.terms,match:Object.assign(l.match,d)})}}}catch(g){r={error:g}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},nn[Pd]=function(t,e){var r,n;try{for(var i=$(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;t.delete(o)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},nn),Rd={k:1.2,b:.7,d:.5},Bd=function(t,e,r,n,i,s){var o=s.k,a=s.b,l=s.d,u=Math.log(1+(r-e+.5)/(e+.5));return u*(l+t*(o+1)/(t+o*(1-a+a*n/i)))},Ld=function(t){return function(e,r,n){var i=typeof t.fuzzy=="function"?t.fuzzy(e,r,n):t.fuzzy||!1,s=typeof t.prefix=="function"?t.prefix(e,r,n):t.prefix===!0;return{term:e,fuzzy:i,prefix:s}}},Rs={idField:"id",extractField:function(t,e){return t[e]},tokenize:function(t,e){return t.split(zd)},processTerm:function(t,e){return t.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(t,e,r){return console!=null&&console.warn!=null&&console[t](e)},autoVacuum:!0},eu={combineWith:Is,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Rd},Nd={combineWith:Za,prefix:function(t,e,r){return e===r.length-1}},Bs={batchSize:1e3,batchWait:10},Ls={minDirtFactor:.1,minDirtCount:20},Ns=ie(ie({},Bs),Ls),Kd=function(t,e){t.includes(e)||t.push(e)},tu=function(t,e){var r,n;try{for(var i=$(e),s=i.next();!s.done;s=i.next()){var o=s.value;t.includes(o)||t.push(o)}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},ru=function(t,e){var r=t.score,n=e.score;return n-r},nu=function(){return new Map},Yn=function(t){var e,r,n=new Map;try{for(var i=$(Object.keys(t)),s=i.next();!s.done;s=i.next()){var o=s.value;n.set(parseInt(o,10),t[o])}}catch(a){e={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},zd=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var oc=Ae(require("obsidian"));var Vd=typeof global=="object"&&global&&global.Object===Object&&global,Jn=Vd;var Hd=typeof self=="object"&&self&&self.Object===Object&&self,Wd=Jn||Hd||Function("return this")(),me=Wd;var $d=me.Symbol,Ee=$d;var iu=Object.prototype,Ud=iu.hasOwnProperty,Gd=iu.toString,sn=Ee?Ee.toStringTag:void 0;function qd(t){var e=Ud.call(t,sn),r=t[sn];try{t[sn]=void 0;var n=!0}catch{}var i=Gd.call(t);return n&&(e?t[sn]=r:delete t[sn]),i}var su=qd;var Qd=Object.prototype,Yd=Qd.toString;function Jd(t){return Yd.call(t)}var ou=Jd;var Xd="[object Null]",Zd="[object Undefined]",au=Ee?Ee.toStringTag:void 0;function eh(t){return t==null?t===void 0?Zd:Xd:au&&au in Object(t)?su(t):ou(t)}var ze=eh;function th(t){return t!=null&&typeof t=="object"}var Ve=th;var rh="[object Symbol]";function nh(t){return typeof t=="symbol"||Ve(t)&&ze(t)==rh}var ot=nh;function ih(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var dr=ih;var sh=Array.isArray,ue=sh;var oh=1/0,uu=Ee?Ee.prototype:void 0,lu=uu?uu.toString:void 0;function cu(t){if(typeof t=="string")return t;if(ue(t))return dr(t,cu)+"";if(ot(t))return lu?lu.call(t):"";var e=t+"";return e=="0"&&1/t==-oh?"-0":e}var fu=cu;function ah(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var xt=ah;function uh(t){return t}var wt=uh;var lh="[object AsyncFunction]",ch="[object Function]",fh="[object GeneratorFunction]",dh="[object Proxy]";function hh(t){if(!xt(t))return!1;var e=ze(t);return e==ch||e==fh||e==lh||e==dh}var Xn=hh;var ph=me["__core-js_shared__"],Zn=ph;var du=function(){var t=/[^.]+$/.exec(Zn&&Zn.keys&&Zn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function mh(t){return!!du&&du in t}var hu=mh;var gh=Function.prototype,yh=gh.toString;function vh(t){if(t!=null){try{return yh.call(t)}catch{}try{return t+""}catch{}}return""}var at=vh;var _h=/[\\^$.*+?()[\]{}|]/g,bh=/^\[object .+?Constructor\]$/,xh=Function.prototype,wh=Object.prototype,jh=xh.toString,Ah=wh.hasOwnProperty,Sh=RegExp("^"+jh.call(Ah).replace(_h,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ch(t){if(!xt(t)||hu(t))return!1;var e=Xn(t)?Sh:bh;return e.test(at(t))}var pu=Ch;function Fh(t,e){return t==null?void 0:t[e]}var mu=Fh;function Eh(t,e){var r=mu(t,e);return pu(r)?r:void 0}var De=Eh;var Th=De(me,"WeakMap"),ei=Th;function Dh(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var gu=Dh;var Oh=800,kh=16,Ih=Date.now;function Ph(t){var e=0,r=0;return function(){var n=Ih(),i=kh-(n-r);if(r=n,i>0){if(++e>=Oh)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var yu=Ph;function Mh(t){return function(){return t}}var vu=Mh;var Rh=function(){try{var t=De(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Ks=Rh;var Bh=Ks?function(t,e){return Ks(t,"toString",{configurable:!0,enumerable:!1,value:vu(e),writable:!0})}:wt,_u=Bh;var Lh=yu(_u),bu=Lh;var Nh=9007199254740991,Kh=/^(?:0|[1-9]\d*)$/;function zh(t,e){var r=typeof t;return e=e??Nh,!!e&&(r=="number"||r!="symbol"&&Kh.test(t))&&t>-1&&t%1==0&&t<e}var hr=zh;function Vh(t,e){return t===e||t!==t&&e!==e}var pr=Vh;var xu=Math.max;function Hh(t,e,r){return e=xu(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=xu(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),gu(t,this,a)}}var wu=Hh;function Wh(t,e){return bu(wu(t,e,wt),t+"")}var ju=Wh;var $h=9007199254740991;function Uh(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=$h}var mr=Uh;function Gh(t){return t!=null&&mr(t.length)&&!Xn(t)}var jt=Gh;function qh(t,e,r){if(!xt(r))return!1;var n=typeof e;return(n=="number"?jt(r)&&hr(e,r.length):n=="string"&&e in r)?pr(r[e],t):!1}var zs=qh;var Qh=Object.prototype;function Yh(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Qh;return t===r}var Au=Yh;function Jh(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var Su=Jh;var Xh="[object Arguments]";function Zh(t){return Ve(t)&&ze(t)==Xh}var Vs=Zh;var Cu=Object.prototype,ep=Cu.hasOwnProperty,tp=Cu.propertyIsEnumerable,rp=Vs(function(){return arguments}())?Vs:function(t){return Ve(t)&&ep.call(t,"callee")&&!tp.call(t,"callee")},gr=rp;function np(){return!1}var Fu=np;var Eu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Tu=Eu&&typeof module=="object"&&module&&!module.nodeType&&module,ip=Tu&&Tu.exports===Eu,Du=ip?me.Buffer:void 0,sp=Du?Du.isBuffer:void 0,op=sp||Fu,on=op;var ap="[object Arguments]",up="[object Array]",lp="[object Boolean]",cp="[object Date]",fp="[object Error]",dp="[object Function]",hp="[object Map]",pp="[object Number]",mp="[object Object]",gp="[object RegExp]",yp="[object Set]",vp="[object String]",_p="[object WeakMap]",bp="[object ArrayBuffer]",xp="[object DataView]",wp="[object Float32Array]",jp="[object Float64Array]",Ap="[object Int8Array]",Sp="[object Int16Array]",Cp="[object Int32Array]",Fp="[object Uint8Array]",Ep="[object Uint8ClampedArray]",Tp="[object Uint16Array]",Dp="[object Uint32Array]",re={};re[wp]=re[jp]=re[Ap]=re[Sp]=re[Cp]=re[Fp]=re[Ep]=re[Tp]=re[Dp]=!0;re[ap]=re[up]=re[bp]=re[lp]=re[xp]=re[cp]=re[fp]=re[dp]=re[hp]=re[pp]=re[mp]=re[gp]=re[yp]=re[vp]=re[_p]=!1;function Op(t){return Ve(t)&&mr(t.length)&&!!re[ze(t)]}var Ou=Op;function kp(t){return function(e){return t(e)}}var ti=kp;var ku=typeof exports=="object"&&exports&&!exports.nodeType&&exports,an=ku&&typeof module=="object"&&module&&!module.nodeType&&module,Ip=an&&an.exports===ku,Hs=Ip&&Jn.process,Pp=function(){try{var t=an&&an.require&&an.require("util").types;return t||Hs&&Hs.binding&&Hs.binding("util")}catch{}}(),Ws=Pp;var Iu=Ws&&Ws.isTypedArray,Mp=Iu?ti(Iu):Ou,ri=Mp;var Rp=Object.prototype,Bp=Rp.hasOwnProperty;function Lp(t,e){var r=ue(t),n=!r&&gr(t),i=!r&&!n&&on(t),s=!r&&!n&&!i&&ri(t),o=r||n||i||s,a=o?Su(t.length,String):[],l=a.length;for(var u in t)(e||Bp.call(t,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||hr(u,l)))&&a.push(u);return a}var Pu=Lp;function Np(t,e){return function(r){return t(e(r))}}var Mu=Np;var Kp=Mu(Object.keys,Object),Ru=Kp;var zp=Object.prototype,Vp=zp.hasOwnProperty;function Hp(t){if(!Au(t))return Ru(t);var e=[];for(var r in Object(t))Vp.call(t,r)&&r!="constructor"&&e.push(r);return e}var Bu=Hp;function Wp(t){return jt(t)?Pu(t):Bu(t)}var yr=Wp;var $p=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Up=/^\w*$/;function Gp(t,e){if(ue(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||ot(t)?!0:Up.test(t)||!$p.test(t)||e!=null&&t in Object(e)}var vr=Gp;var qp=De(Object,"create"),ut=qp;function Qp(){this.__data__=ut?ut(null):{},this.size=0}var Lu=Qp;function Yp(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Nu=Yp;var Jp="__lodash_hash_undefined__",Xp=Object.prototype,Zp=Xp.hasOwnProperty;function em(t){var e=this.__data__;if(ut){var r=e[t];return r===Jp?void 0:r}return Zp.call(e,t)?e[t]:void 0}var Ku=em;var tm=Object.prototype,rm=tm.hasOwnProperty;function nm(t){var e=this.__data__;return ut?e[t]!==void 0:rm.call(e,t)}var zu=nm;var im="__lodash_hash_undefined__";function sm(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ut&&e===void 0?im:e,this}var Vu=sm;function _r(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}_r.prototype.clear=Lu;_r.prototype.delete=Nu;_r.prototype.get=Ku;_r.prototype.has=zu;_r.prototype.set=Vu;var $s=_r;function om(){this.__data__=[],this.size=0}var Hu=om;function am(t,e){for(var r=t.length;r--;)if(pr(t[r][0],e))return r;return-1}var At=am;var um=Array.prototype,lm=um.splice;function cm(t){var e=this.__data__,r=At(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():lm.call(e,r,1),--this.size,!0}var Wu=cm;function fm(t){var e=this.__data__,r=At(e,t);return r<0?void 0:e[r][1]}var $u=fm;function dm(t){return At(this.__data__,t)>-1}var Uu=dm;function hm(t,e){var r=this.__data__,n=At(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var Gu=hm;function br(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}br.prototype.clear=Hu;br.prototype.delete=Wu;br.prototype.get=$u;br.prototype.has=Uu;br.prototype.set=Gu;var St=br;var pm=De(me,"Map"),Ct=pm;function mm(){this.size=0,this.__data__={hash:new $s,map:new(Ct||St),string:new $s}}var qu=mm;function gm(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var Qu=gm;function ym(t,e){var r=t.__data__;return Qu(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Ft=ym;function vm(t){var e=Ft(this,t).delete(t);return this.size-=e?1:0,e}var Yu=vm;function _m(t){return Ft(this,t).get(t)}var Ju=_m;function bm(t){return Ft(this,t).has(t)}var Xu=bm;function xm(t,e){var r=Ft(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var Zu=xm;function xr(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}xr.prototype.clear=qu;xr.prototype.delete=Yu;xr.prototype.get=Ju;xr.prototype.has=Xu;xr.prototype.set=Zu;var Vt=xr;var wm="Expected a function";function Us(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(wm);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(Us.Cache||Vt),r}Us.Cache=Vt;var el=Us;var jm=500;function Am(t){var e=el(t,function(n){return r.size===jm&&r.clear(),n}),r=e.cache;return e}var tl=Am;var Sm=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Cm=/\\(\\)?/g,Fm=tl(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Sm,function(r,n,i,s){e.push(i?s.replace(Cm,"$1"):n||r)}),e}),rl=Fm;function Em(t){return t==null?"":fu(t)}var nl=Em;function Tm(t,e){return ue(t)?t:vr(t,e)?[t]:rl(nl(t))}var ni=Tm;var Dm=1/0;function Om(t){if(typeof t=="string"||ot(t))return t;var e=t+"";return e=="0"&&1/t==-Dm?"-0":e}var Et=Om;function km(t,e){e=ni(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Et(e[r++])];return r&&r==n?t:void 0}var wr=km;function Im(t,e,r){var n=t==null?void 0:wr(t,e);return n===void 0?r:n}var il=Im;function Pm(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var ii=Pm;var sl=Ee?Ee.isConcatSpreadable:void 0;function Mm(t){return ue(t)||gr(t)||!!(sl&&t&&t[sl])}var ol=Mm;function al(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=ol),i||(i=[]);++s<o;){var a=t[s];e>0&&r(a)?e>1?al(a,e-1,r,n,i):ii(i,a):n||(i[i.length]=a)}return i}var ul=al;function Rm(){this.__data__=new St,this.size=0}var ll=Rm;function Bm(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var cl=Bm;function Lm(t){return this.__data__.get(t)}var fl=Lm;function Nm(t){return this.__data__.has(t)}var dl=Nm;var Km=200;function zm(t,e){var r=this.__data__;if(r instanceof St){var n=r.__data__;if(!Ct||n.length<Km-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Vt(n)}return r.set(t,e),this.size=r.size,this}var hl=zm;function jr(t){var e=this.__data__=new St(t);this.size=e.size}jr.prototype.clear=ll;jr.prototype.delete=cl;jr.prototype.get=fl;jr.prototype.has=dl;jr.prototype.set=hl;var Ar=jr;function Vm(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}var pl=Vm;function Hm(){return[]}var ml=Hm;var Wm=Object.prototype,$m=Wm.propertyIsEnumerable,gl=Object.getOwnPropertySymbols,Um=gl?function(t){return t==null?[]:(t=Object(t),pl(gl(t),function(e){return $m.call(t,e)}))}:ml,yl=Um;function Gm(t,e,r){var n=e(t);return ue(t)?n:ii(n,r(t))}var vl=Gm;function qm(t){return vl(t,yr,yl)}var Gs=qm;var Qm=De(me,"DataView"),si=Qm;var Ym=De(me,"Promise"),oi=Ym;var Jm=De(me,"Set"),ai=Jm;var _l="[object Map]",Xm="[object Object]",bl="[object Promise]",xl="[object Set]",wl="[object WeakMap]",jl="[object DataView]",Zm=at(si),eg=at(Ct),tg=at(oi),rg=at(ai),ng=at(ei),Ht=ze;(si&&Ht(new si(new ArrayBuffer(1)))!=jl||Ct&&Ht(new Ct)!=_l||oi&&Ht(oi.resolve())!=bl||ai&&Ht(new ai)!=xl||ei&&Ht(new ei)!=wl)&&(Ht=function(t){var e=ze(t),r=e==Xm?t.constructor:void 0,n=r?at(r):"";if(n)switch(n){case Zm:return jl;case eg:return _l;case tg:return bl;case rg:return xl;case ng:return wl}return e});var qs=Ht;var ig=me.Uint8Array,Qs=ig;var sg="__lodash_hash_undefined__";function og(t){return this.__data__.set(t,sg),this}var Al=og;function ag(t){return this.__data__.has(t)}var Sl=ag;function ui(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Vt;++e<r;)this.add(t[e])}ui.prototype.add=ui.prototype.push=Al;ui.prototype.has=Sl;var Cl=ui;function ug(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}var Fl=ug;function lg(t,e){return t.has(e)}var El=lg;var cg=1,fg=2;function dg(t,e,r,n,i,s){var o=r&cg,a=t.length,l=e.length;if(a!=l&&!(o&&l>a))return!1;var u=s.get(t),c=s.get(e);if(u&&c)return u==e&&c==t;var h=-1,d=!0,g=r&fg?new Cl:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var _=t[h],w=e[h];if(n)var b=o?n(w,_,h,e,t,s):n(_,w,h,t,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(g){if(!Fl(e,function(f,y){if(!El(g,y)&&(_===f||i(_,f,r,n,s)))return g.push(y)})){d=!1;break}}else if(!(_===w||i(_,w,r,n,s))){d=!1;break}}return s.delete(t),s.delete(e),d}var li=dg;function hg(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}var Tl=hg;function pg(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var Dl=pg;var mg=1,gg=2,yg="[object Boolean]",vg="[object Date]",_g="[object Error]",bg="[object Map]",xg="[object Number]",wg="[object RegExp]",jg="[object Set]",Ag="[object String]",Sg="[object Symbol]",Cg="[object ArrayBuffer]",Fg="[object DataView]",Ol=Ee?Ee.prototype:void 0,Ys=Ol?Ol.valueOf:void 0;function Eg(t,e,r,n,i,s,o){switch(r){case Fg:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Cg:return!(t.byteLength!=e.byteLength||!s(new Qs(t),new Qs(e)));case yg:case vg:case xg:return pr(+t,+e);case _g:return t.name==e.name&&t.message==e.message;case wg:case Ag:return t==e+"";case bg:var a=Tl;case jg:var l=n&mg;if(a||(a=Dl),t.size!=e.size&&!l)return!1;var u=o.get(t);if(u)return u==e;n|=gg,o.set(t,e);var c=li(a(t),a(e),n,i,s,o);return o.delete(t),c;case Sg:if(Ys)return Ys.call(t)==Ys.call(e)}return!1}var kl=Eg;var Tg=1,Dg=Object.prototype,Og=Dg.hasOwnProperty;function kg(t,e,r,n,i,s){var o=r&Tg,a=Gs(t),l=a.length,u=Gs(e),c=u.length;if(l!=c&&!o)return!1;for(var h=l;h--;){var d=a[h];if(!(o?d in e:Og.call(e,d)))return!1}var g=s.get(t),_=s.get(e);if(g&&_)return g==e&&_==t;var w=!0;s.set(t,e),s.set(e,t);for(var b=o;++h<l;){d=a[h];var f=t[d],y=e[d];if(n)var p=o?n(y,f,d,e,t,s):n(f,y,d,t,e,s);if(!(p===void 0?f===y||i(f,y,r,n,s):p)){w=!1;break}b||(b=d=="constructor")}if(w&&!b){var m=t.constructor,v=e.constructor;m!=v&&"constructor"in t&&"constructor"in e&&!(typeof m=="function"&&m instanceof m&&typeof v=="function"&&v instanceof v)&&(w=!1)}return s.delete(t),s.delete(e),w}var Il=kg;var Ig=1,Pl="[object Arguments]",Ml="[object Array]",ci="[object Object]",Pg=Object.prototype,Rl=Pg.hasOwnProperty;function Mg(t,e,r,n,i,s){var o=ue(t),a=ue(e),l=o?Ml:qs(t),u=a?Ml:qs(e);l=l==Pl?ci:l,u=u==Pl?ci:u;var c=l==ci,h=u==ci,d=l==u;if(d&&on(t)){if(!on(e))return!1;o=!0,c=!1}if(d&&!c)return s||(s=new Ar),o||ri(t)?li(t,e,r,n,i,s):kl(t,e,l,r,n,i,s);if(!(r&Ig)){var g=c&&Rl.call(t,"__wrapped__"),_=h&&Rl.call(e,"__wrapped__");if(g||_){var w=g?t.value():t,b=_?e.value():e;return s||(s=new Ar),i(w,b,r,n,s)}}return d?(s||(s=new Ar),Il(t,e,r,n,i,s)):!1}var Bl=Mg;function Ll(t,e,r,n,i){return t===e?!0:t==null||e==null||!Ve(t)&&!Ve(e)?t!==t&&e!==e:Bl(t,e,r,n,Ll,i)}var fi=Ll;var Rg=1,Bg=2;function Lg(t,e,r,n){var i=r.length,s=i,o=!n;if(t==null)return!s;for(t=Object(t);i--;){var a=r[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){a=r[i];var l=a[0],u=t[l],c=a[1];if(o&&a[2]){if(u===void 0&&!(l in t))return!1}else{var h=new Ar;if(n)var d=n(u,c,l,t,e,h);if(!(d===void 0?fi(c,u,Rg|Bg,n,h):d))return!1}}return!0}var Nl=Lg;function Ng(t){return t===t&&!xt(t)}var di=Ng;function Kg(t){for(var e=yr(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,di(i)]}return e}var Kl=Kg;function zg(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}var hi=zg;function Vg(t){var e=Kl(t);return e.length==1&&e[0][2]?hi(e[0][0],e[0][1]):function(r){return r===t||Nl(r,t,e)}}var zl=Vg;function Hg(t,e){return t!=null&&e in Object(t)}var Vl=Hg;function Wg(t,e,r){e=ni(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=Et(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&mr(i)&&hr(o,i)&&(ue(t)||gr(t)))}var Hl=Wg;function $g(t,e){return t!=null&&Hl(t,e,Vl)}var Wl=$g;var Ug=1,Gg=2;function qg(t,e){return vr(t)&&di(e)?hi(Et(t),e):function(r){var n=il(r,t);return n===void 0&&n===e?Wl(r,t):fi(e,n,Ug|Gg)}}var $l=qg;function Qg(t){return function(e){return e==null?void 0:e[t]}}var Ul=Qg;function Yg(t){return function(e){return wr(e,t)}}var Gl=Yg;function Jg(t){return vr(t)?Ul(Et(t)):Gl(t)}var ql=Jg;function Xg(t){return typeof t=="function"?t:t==null?wt:typeof t=="object"?ue(t)?$l(t[0],t[1]):zl(t):ql(t)}var Ql=Xg;function Zg(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var l=o[t?a:++i];if(r(s[l],l,s)===!1)break}return e}}var Yl=Zg;var ey=Yl(),Jl=ey;function ty(t,e){return t&&Jl(t,e,yr)}var Xl=ty;function ry(t,e){return function(r,n){if(r==null)return r;if(!jt(r))return t(r,n);for(var i=r.length,s=e?i:-1,o=Object(r);(e?s--:++s<i)&&n(o[s],s,o)!==!1;);return r}}var Zl=ry;var ny=Zl(Xl),ec=ny;function iy(t,e){var r=-1,n=jt(t)?Array(t.length):[];return ec(t,function(i,s,o){n[++r]=e(i,s,o)}),n}var tc=iy;function sy(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}var rc=sy;function oy(t,e){if(t!==e){var r=t!==void 0,n=t===null,i=t===t,s=ot(t),o=e!==void 0,a=e===null,l=e===e,u=ot(e);if(!a&&!u&&!s&&t>e||s&&o&&l&&!a&&!u||n&&o&&l||!r&&l||!i)return 1;if(!n&&!s&&!u&&t<e||u&&r&&i&&!n&&!s||a&&r&&i||!o&&i||!l)return-1}return 0}var nc=oy;function ay(t,e,r){for(var n=-1,i=t.criteria,s=e.criteria,o=i.length,a=r.length;++n<o;){var l=nc(i[n],s[n]);if(l){if(n>=a)return l;var u=r[n];return l*(u=="desc"?-1:1)}}return t.index-e.index}var ic=ay;function uy(t,e,r){e.length?e=dr(e,function(s){return ue(s)?function(o){return wr(o,s.length===1?s[0]:s)}:s}):e=[wt];var n=-1;e=dr(e,ti(Ql));var i=tc(t,function(s,o,a){var l=dr(e,function(u){return u(s)});return{criteria:l,index:++n,value:s}});return rc(i,function(s,o){return ic(s,o,r)})}var sc=uy;var ly=ju(function(t,e){if(t==null)return[];var r=e.length;return r>1&&zs(t,e[0],e[1])?e=[]:r>2&&zs(e[0],e[1],e[2])&&(e=[e[0]]),sc(t,ul(e,1),[])}),Js=ly;var cy=t=>{let e=t.split(Xr),r=zn();return r?e.flatMap(n=>ga.test(n)?r.cut(n):[n]):e},pi=class{constructor(){this.indexedDocuments=new Map;this.previousResults=[];this.previousQuery=null;this.minisearch=new Ps(pi.options)}async loadCache(){let e=await pe.getMinisearchCache();return e?(this.minisearch=Ps.loadJS(e.data,pi.options),this.indexedDocuments=new Map(e.paths.map(r=>[r.path,r.mtime])),!0):(console.log("Omnisearch - No cache found"),!1)}getDiff(e){let r=new Map(e.map(s=>[s.path,s.mtime])),n=e.filter(s=>!this.indexedDocuments.has(s.path)||this.indexedDocuments.get(s.path)!==s.mtime),i=[...this.indexedDocuments].filter(([s,o])=>!r.has(s)||r.get(s)!==o).map(s=>({path:s[0],mtime:s[1]}));return{toAdd:n,toRemove:i}}async addFromPaths(e){let r=(await Promise.all(e.map(async i=>await pe.getDocument(i)))).filter(i=>!!i?.path);r=Js(r,i=>i.path.endsWith(".md")?0:1),this.removeFromPaths(r.filter(i=>this.indexedDocuments.has(i.path)).map(i=>i.path));let n=Oa(r,500);for(let i of n){i.forEach(o=>this.indexedDocuments.set(o.path,o.mtime));let s=i.filter(o=>this.minisearch.has(o.path));this.removeFromPaths(s.map(o=>o.path)),await this.minisearch.addAllAsync(i)}}removeFromPaths(e){e.forEach(n=>this.indexedDocuments.delete(n));let r=e.filter(n=>this.minisearch.has(n));this.minisearch.discardAll(r)}async search(e,r){if(e.isEmpty())return this.previousResults=[],this.previousQuery=null,[];let n=this.minisearch.search(e.segmentsToStr(),{prefix:l=>l.length>=r.prefixLength,fuzzy:l=>l.length<=3?0:l.length<=5?.1:.2,combineWith:"AND",boost:{basename:P.weightBasename,aliases:P.weightBasename,headings1:P.weightH1,headings2:P.weightH2,headings3:P.weightH3}});if(e.extensions.length&&(n=n.filter(l=>e.extensions.some(u=>l.id.endsWith(u)))),!n.length)return[];if(r.singleFilePath)return n.filter(l=>l.id===r.singleFilePath);P.hideExcluded?n=n.filter(l=>!(app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(l.id))):n.forEach(l=>{app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(l.id)&&(l.score/=10)});let i=e.segments.filter(l=>l.value.startsWith("#")).map(l=>l.value);for(let l of i)for(let u of n)(u.tags??[]).includes(l)&&(u.score*=100);n=n.slice(0,50);let s=await Promise.all(n.map(async l=>await pe.getDocument(l.id))),o=e.getExactTerms();o.length&&(n=n.filter(l=>{let u=s.find(d=>d.path===l.id),c=u?.path.toLowerCase()??"",h=As(u?.content??"").toLowerCase();return o.every(d=>h.includes(d)||c.includes(d))}));let a=e.exclusions;return a.length&&(n=n.filter(l=>{let u=As(s.find(c=>c.path===l.id)?.content??"").toLowerCase();return a.every(c=>!u.includes(c.value))})),n=n.filter((l,u,c)=>c.findIndex(h=>h.id===l.id)===u),this.previousQuery=e,this.previousResults=n,n}getMatches(e,r,n){let i=null,s=[],o=0;for(;(i=r.exec(e))!==null&&!(++o>=100);){let l=i[0];l&&s.push({match:l,offset:i.index})}let a=e.toLowerCase().indexOf(n.segmentsToStr());return a>-1&&s.unshift({offset:a,match:n.segmentsToStr()}),s}async getSuggestions(e,r){let n;P.simpleSearch?n=await this.search(e,{prefixLength:3,singleFilePath:r?.singleFilePath}):n=await this.search(e,{prefixLength:1,singleFilePath:r?.singleFilePath});let i=e.segments.filter(a=>a.value.startsWith("#")).map(a=>a.value),s=await Promise.all(n.map(async a=>await pe.getDocument(a.id)));return n.map(a=>{let l=s.find(d=>d.path===a.id);l||(console.warn(`Omnisearch - Note "${a.id}" not in the live cache`),l={content:"",basename:a.id,path:a.id}),e.segments.forEach(d=>{d.value=d.value.replace(/^#/,"")});let u=[...Object.keys(a.match),...e.segments.filter(d=>d.exact).map(d=>d.value),...i].filter(d=>d.length>1),c=this.getMatches(l.content,bt(u),e);return oe({score:a.score,foundWords:u,matches:c},l)})}async writeToCache(){await pe.writeMinisearchCache(this.minisearch,this.indexedDocuments)}},Xs=pi;Xs.options={tokenize:cy,processTerm:e=>(P.ignoreDiacritics?st(e):e).toLowerCase(),idField:"path",fields:["basename","aliases","content","headings1","headings2","headings3"],storeFields:["tags"],logger(e,r,n){n==="version_conflict"&&new oc.Notice("Omnisearch - Your index cache may be incorrect or corrupted. If this message keeps appearing, go to Settings to clear the cache.",5e3)}};var de=new Xs;var Zs=new Set;function ac(t){Zs.add(t)}async function mi(){let t=[...Zs].map(e=>e.path);t.length&&(de.removeFromPaths(t),de.addFromPaths(t),Zs.clear())}var lc=Ae(uc());function cc(t,e,r){let n=t.slice();return n[30]=e[r],n[32]=r,n}function fy(t){let e,r,n;return{c(){e=L("button"),e.textContent="Create note"},m(i,s){W(i,e,s),r||(n=ke(e,"click",t[7]),r=!0)},p:ae,d(i){i&&H(e),r=!1,n()}}}function dy(t){let e,r=P.showCreateButton&&fy(t);return{c(){r&&r.c(),e=Yt()},m(n,i){r&&r.m(n,i),W(n,e,i)},p(n,i){P.showCreateButton&&r.p(n,i)},d(n){r&&r.d(n),n&&H(e)}}}function fc(t){let e,r,n;return{c(){e=L("div"),r=Be("\u23F3 Work in progress: "),n=Be(t[3]),Ie(e,"text-align","center"),Ie(e,"color","var(--text-accent)"),Ie(e,"margin-top","10px")},m(i,s){W(i,e,s),R(e,r),R(e,n)},p(i,s){s[0]&8&&Jt(n,i[3])},d(i){i&&H(e)}}}function dc(t){let e,r;function n(...i){return t[14](t[32],...i)}return e=new Ua({props:{selected:t[32]===t[0],note:t[30]}}),e.$on("mousemove",n),e.$on("click",t[6]),{c(){Te(e.$$.fragment)},m(i,s){Se(e,i,s),r=!0},p(i,s){t=i;let o={};s[0]&1&&(o.selected=t[32]===t[0]),s[0]&4&&(o.note=t[30]),e.$set(o)},i(i){r||(J(e.$$.fragment,i),r=!0)},o(i){Z(e.$$.fragment,i),r=!1},d(i){_e(e,i)}}}function hy(t){let e;return{c(){e=Be("Searching...")},m(r,n){W(r,e,n)},p:ae,d(r){r&&H(e)}}}function py(t){let e,r=P.simpleSearch&&t[1].split(Xr).some(pc),n,i=r&&hc(t);return{c(){e=Be(`We found 0 result for your search here.
      `),i&&i.c(),n=Yt()},m(s,o){W(s,e,o),i&&i.m(s,o),W(s,n,o)},p(s,o){o[0]&2&&(r=P.simpleSearch&&s[1].split(Xr).some(pc)),r?i||(i=hc(s),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(s){s&&H(e),i&&i.d(s),s&&H(n)}}}function hc(t){let e,r,n;return{c(){e=L("br"),r=q(),n=L("span"),n.textContent=`You have enabled "Simpler Search" in the settings, try to type more
          characters.`,Ie(n,"color","var(--text-accent)"),Ie(n,"font-size","small")},m(i,s){W(i,e,s),W(i,r,s),W(i,n,s)},d(i){i&&H(e),i&&H(r),i&&H(n)}}}function my(t){let e,r,n,i=t[2],s=[];for(let c=0;c<i.length;c+=1)s[c]=dc(cc(t,i,c));let o=c=>Z(s[c],1,1,()=>{s[c]=null});function a(c,h){if(!c[2].length&&c[1]&&!c[4])return py;if(c[4])return hy}let l=a(t,[-1,-1]),u=l&&l(t);return{c(){for(let c=0;c<s.length;c+=1)s[c].c();e=q(),r=L("div"),u&&u.c(),Ie(r,"text-align","center")},m(c,h){for(let d=0;d<s.length;d+=1)s[d].m(c,h);W(c,e,h),W(c,r,h),u&&u.m(r,null),n=!0},p(c,h){if(h[0]&69){i=c[2];let d;for(d=0;d<i.length;d+=1){let g=cc(c,i,d);s[d]?(s[d].p(g,h),J(s[d],1)):(s[d]=dc(g),s[d].c(),J(s[d],1),s[d].m(e.parentNode,e))}for(Ot(),d=i.length;d<s.length;d+=1)o(d);kt()}l===(l=a(c,h))&&u?u.p(c,h):(u&&u.d(1),u=l&&l(c),u&&(u.c(),u.m(r,null)))},i(c){if(!n){for(let h=0;h<i.length;h+=1)J(s[h]);n=!0}},o(c){s=s.filter(Boolean);for(let h=0;h<s.length;h+=1)Z(s[h]);n=!1},d(c){fn(s,c),c&&H(e),c&&H(r),u&&u.d()}}}function gy(t){let e,r,n,i,s,o,a,l,u,c,h,d,g,_,w,b,f,y,p,m,v,x,j,C,E,T,I,B,O,K,Y,U,D,A={initialValue:t[1],placeholder:"Omnisearch - Vault",$$slots:{default:[dy]},$$scope:{ctx:t}};e=new $n({props:A}),t[12](e),e.$on("input",t[13]);let S=t[3]&&fc(t);return i=new Un({props:{$$slots:{default:[my]},$$scope:{ctx:t}}}),{c(){Te(e.$$.fragment),r=q(),S&&S.c(),n=q(),Te(i.$$.fragment),s=q(),o=L("div"),a=L("div"),a.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',l=q(),u=L("div"),u.innerHTML=`<span class="prompt-instruction-command">alt \u2191\u2193</span> 
    <span>to cycle history</span>`,c=q(),h=L("div"),h.innerHTML='<span class="prompt-instruction-command">\u21B5</span><span>to open</span>',d=q(),g=L("div"),g.innerHTML=`<span class="prompt-instruction-command">\u21B9</span> 
    <span>to switch to In-File Search</span>`,_=q(),w=L("br"),b=q(),f=L("div"),y=L("span"),y.textContent=`${Ea()} \u21B5`,p=q(),m=L("span"),m.textContent="to open in a new pane",v=q(),x=L("div"),x.innerHTML=`<span class="prompt-instruction-command">shift \u21B5</span> 
    <span>to create</span>`,j=q(),C=L("div"),C.innerHTML=`<span class="prompt-instruction-command">ctrl shift \u21B5</span> 
    <span>to create in a new pane</span>`,E=q(),T=L("br"),I=q(),B=L("div"),B.innerHTML=`<span class="prompt-instruction-command">alt \u21B5</span> 
    <span>to insert a link</span>`,O=q(),K=L("div"),K.innerHTML=`<span class="prompt-instruction-command">ctrl+h</span> 
    <span>to toggle excerpts</span>`,Y=q(),U=L("div"),U.innerHTML='<span class="prompt-instruction-command">esc</span><span>to close</span>',z(a,"class","prompt-instruction"),z(u,"class","prompt-instruction"),z(h,"class","prompt-instruction"),z(g,"class","prompt-instruction"),z(y,"class","prompt-instruction-command"),z(f,"class","prompt-instruction"),z(x,"class","prompt-instruction"),z(C,"class","prompt-instruction"),z(B,"class","prompt-instruction"),z(K,"class","prompt-instruction"),z(U,"class","prompt-instruction"),z(o,"class","prompt-instructions")},m(F,k){Se(e,F,k),W(F,r,k),S&&S.m(F,k),W(F,n,k),Se(i,F,k),W(F,s,k),W(F,o,k),R(o,a),R(o,l),R(o,u),R(o,c),R(o,h),R(o,d),R(o,g),R(o,_),R(o,w),R(o,b),R(o,f),R(f,y),R(f,p),R(f,m),R(o,v),R(o,x),R(o,j),R(o,C),R(o,E),R(o,T),R(o,I),R(o,B),R(o,O),R(o,K),R(o,Y),R(o,U),D=!0},p(F,k){let Q={};k[0]&2&&(Q.initialValue=F[1]),k[1]&4&&(Q.$$scope={dirty:k,ctx:F}),e.$set(Q),F[3]?S?S.p(F,k):(S=fc(F),S.c(),S.m(n.parentNode,n)):S&&(S.d(1),S=null);let se={};k[0]&23|k[1]&4&&(se.$$scope={dirty:k,ctx:F}),i.$set(se)},i(F){D||(J(e.$$.fragment,F),J(i.$$.fragment,F),D=!0)},o(F){Z(e.$$.fragment,F),Z(i.$$.fragment,F),D=!1},d(F){t[12](null),_e(e,F),F&&H(r),S&&S.d(F),F&&H(n),_e(i,F),F&&H(s),F&&H(o)}}}var pc=t=>t.length<3;function yy(t,e,r){let n,i;cn(t,vt,D=>r(11,i=D));let{modal:s}=e,{previousQuery:o}=e,a=0,l=0,u,c=[],h,d="",g=!0,_,w=null;Dr(async()=>{G.enable("vault"),G.on("vault","enter",m),G.on("vault","create-note",E),G.on("vault","open-in-new-pane",v),G.on("vault","insert-link",T),G.on("vault","tab",I),G.on("vault","arrow-up",()=>B(-1)),G.on("vault","arrow-down",()=>B(1)),G.on("vault","prev-search-history",b),G.on("vault","next-search-history",f),await mi(),P.showPreviousQueryResults&&r(8,o=(await pe.getSearchHistory())[0])}),Or(()=>{G.disable("vault")});async function b(){let D=(await pe.getSearchHistory()).filter(A=>A);++l>=D.length&&(l=0),r(1,u=D[l]),_?.setInputValue(u)}async function f(){let D=(await pe.getSearchHistory()).filter(A=>A);--l<0&&(l=D.length?D.length-1:0),r(1,u=D[l]),_?.setInputValue(u)}async function y(){h=new zt(u),r(2,c=(await de.getSuggestions(h)).sort((D,A)=>A.score-D.score)),r(0,a=0),await O()}function p(D){!n||(D?.ctrlKey?v():m(),s.close())}function m(){!n||(j(n),s.close())}function v(){!n||(j(n,!0),s.close())}function x(){u&&pe.addToSearchHistory(u)}function j(D,A=!1){x(),Gn(D,A)}async function C(D){await E()}async function E(D){if(u){try{await Ba(u,D?.newLeaf)}catch(A){new Tt.Notice(A.message);return}s.close()}}function T(){if(!n)return;let D=app.vault.getMarkdownFiles().find(Q=>Q.path===n.path),A=app.workspace.getActiveFile(),S=app.workspace.getActiveViewOfType(Tt.MarkdownView);if(!S?.editor){new Tt.Notice("Omnisearch - Error - No active editor",3e3);return}let F;D&&A?F=app.fileManager.generateMarkdownLink(D,A.path):F=`[[${n.basename}.${Ta(n.path)}]]`;let k=S.editor.getCursor();S.editor.replaceRange(F,k,k),k.ch+=F.length,S.editor.setCursor(k),s.close()}function I(){if(!(n&&(tn(n?.path)||!n?.matches.length)))if(x(),s.close(),n){let D=app.vault.getAbstractFileByPath(n.path);D&&D instanceof Tt.TFile&&new Sr(app,D,u).open()}else{let D=app.workspace.getActiveViewOfType(Tt.MarkdownView);D&&new Sr(app,D.file,u).open()}}function B(D){r(0,a=Hn(a+D,c.length)),O()}async function O(){await ct(),n&&document.querySelector(`[data-result-id="${n.path}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}function K(D){lt[D?"unshift":"push"](()=>{_=D,r(5,_)})}let Y=D=>r(1,u=D.detail),U=(D,A)=>r(0,a=D);return t.$$set=D=>{"modal"in D&&r(9,s=D.modal),"previousQuery"in D&&r(8,o=D.previousQuery)},t.$$.update=()=>{if(t.$$.dirty[0]&258){e:r(1,u=u??o)}if(t.$$.dirty[0]&1026){e:u?(w&&(w.cancel(),r(10,w=null)),r(4,g=!0),r(10,w=(0,lc.cancelable)(new Promise((D,A)=>{y().then(()=>{r(4,g=!1),D(null)}).catch(S=>{A(S)})})))):(r(4,g=!1),r(2,c=[]))}if(t.$$.dirty[0]&5){e:n=c[a]}if(t.$$.dirty[0]&2048){e:switch(i){case Le.LoadingCache:r(3,d="Loading cache...");break;case Le.ReadingFiles:r(3,d="Reading files...");break;case Le.IndexingFiles:r(3,d="Indexing files...");break;case Le.WritingCache:y(),r(3,d="Updating cache...");break;default:y(),r(3,d="");break}}},[a,u,c,d,g,_,p,C,o,s,w,i,K,Y,U]}var mc=class extends ge{constructor(e){super();be(this,e,yy,gy,he,{modal:9,previousQuery:8},null,[-1,-1])}},gc=mc;var _c=Ae(require("obsidian"));function vy(t){let e,r=t[2].replace(t[3],_t)+"";return{c(){e=L("div"),z(e,"class","omnisearch-result__body")},m(n,i){W(n,e,i),e.innerHTML=r},p(n,i){i&12&&r!==(r=n[2].replace(n[3],_t)+"")&&(e.innerHTML=r)},d(n){n&&H(e)}}}function _y(t){let e,r;return e=new qn({props:{id:t[0].toString(),selected:t[1],$$slots:{default:[vy]},$$scope:{ctx:t}}}),e.$on("mousemove",t[6]),e.$on("click",t[7]),{c(){Te(e.$$.fragment)},m(n,i){Se(e,n,i),r=!0},p(n,[i]){let s={};i&1&&(s.id=n[0].toString()),i&2&&(s.selected=n[1]),i&268&&(s.$$scope={dirty:i,ctx:n}),e.$set(s)},i(n){r||(J(e.$$.fragment,n),r=!0)},o(n){Z(e.$$.fragment,n),r=!1},d(n){_e(e,n)}}}function by(t,e,r){let n,i,{offset:s}=e,{note:o}=e,{index:a=0}=e,{selected:l=!1}=e;function u(h){$e.call(this,t,h)}function c(h){$e.call(this,t,h)}return t.$$set=h=>{"offset"in h&&r(4,s=h.offset),"note"in h&&r(5,o=h.note),"index"in h&&r(0,a=h.index),"selected"in h&&r(1,l=h.selected)},t.$$.update=()=>{if(t.$$.dirty&32){e:r(3,n=bt(o.foundWords))}if(t.$$.dirty&48){e:r(2,i=cr(o?.content??"",s))}},[a,l,i,n,s,o,u,c]}var yc=class extends ge{constructor(e){super();be(this,e,by,_y,he,{offset:4,note:5,index:0,selected:1})}},vc=yc;function bc(t,e,r){let n=t.slice();return n[16]=e[r],n[18]=r,n}function xy(t){let e;return{c(){e=L("div"),e.textContent="We found 0 result for your search here.",Ie(e,"text-align","center")},m(r,n){W(r,e,n)},p:ae,i:ae,o:ae,d(r){r&&H(e)}}}function wy(t){let e,r,n=t[4],i=[];for(let o=0;o<n.length;o+=1)i[o]=xc(bc(t,n,o));let s=o=>Z(i[o],1,1,()=>{i[o]=null});return{c(){for(let o=0;o<i.length;o+=1)i[o].c();e=Yt()},m(o,a){for(let l=0;l<i.length;l+=1)i[l].m(o,a);W(o,e,a),r=!0},p(o,a){if(a&120){n=o[4];let l;for(l=0;l<n.length;l+=1){let u=bc(o,n,l);i[l]?(i[l].p(u,a),J(i[l],1)):(i[l]=xc(u),i[l].c(),J(i[l],1),i[l].m(e.parentNode,e))}for(Ot(),l=n.length;l<i.length;l+=1)s(l);kt()}},i(o){if(!r){for(let a=0;a<n.length;a+=1)J(i[a]);r=!0}},o(o){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)Z(i[a]);r=!1},d(o){fn(i,o),o&&H(e)}}}function xc(t){let e,r;function n(...i){return t[11](t[18],...i)}return e=new vc({props:{offset:t[16],note:t[3],index:t[18],selected:t[18]===t[5]}}),e.$on("mousemove",n),e.$on("click",t[6]),{c(){Te(e.$$.fragment)},m(i,s){Se(e,i,s),r=!0},p(i,s){t=i;let o={};s&16&&(o.offset=t[16]),s&8&&(o.note=t[3]),s&32&&(o.selected=t[18]===t[5]),e.$set(o)},i(i){r||(J(e.$$.fragment,i),r=!0)},o(i){Z(e.$$.fragment,i),r=!1},d(i){_e(e,i)}}}function jy(t){let e,r,n,i,s=[wy,xy],o=[];function a(l,u){return l[4].length&&l[3]?0:1}return e=a(t,-1),r=o[e]=s[e](t),{c(){r.c(),n=Yt()},m(l,u){o[e].m(l,u),W(l,n,u),i=!0},p(l,u){let c=e;e=a(l,u),e===c?o[e].p(l,u):(Ot(),Z(o[c],1,1,()=>{o[c]=null}),kt(),r=o[e],r?r.p(l,u):(r=o[e]=s[e](l),r.c()),J(r,1),r.m(n.parentNode,n))},i(l){i||(J(r),i=!0)},o(l){Z(r),i=!1},d(l){o[e].d(l),l&&H(n)}}}function Ay(t){let e;return{c(){e=L("span"),e.textContent="to close"},m(r,n){W(r,e,n)},d(r){r&&H(e)}}}function Sy(t){let e;return{c(){e=L("span"),e.textContent="to go back to Vault Search"},m(r,n){W(r,e,n)},d(r){r&&H(e)}}}function Cy(t){let e,r,n,i,s,o,a,l,u,c,h,d,g,_,w;e=new $n({props:{placeholder:"Omnisearch - File",initialValue:t[1]}}),e.$on("input",t[10]),n=new Un({props:{$$slots:{default:[jy]},$$scope:{ctx:t}}});function b(p,m){return p[0]?Sy:Ay}let f=b(t,-1),y=f(t);return{c(){Te(e.$$.fragment),r=q(),Te(n.$$.fragment),i=q(),s=L("div"),o=L("div"),o.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',a=q(),l=L("div"),l.innerHTML='<span class="prompt-instruction-command">\u21B5</span><span>to open</span>',u=q(),c=L("div"),c.innerHTML=`<span class="prompt-instruction-command">\u21B9</span> 
    <span>to switch to Vault Search</span>`,h=q(),d=L("div"),g=L("span"),g.textContent="esc",_=q(),y.c(),z(o,"class","prompt-instruction"),z(l,"class","prompt-instruction"),z(c,"class","prompt-instruction"),z(g,"class","prompt-instruction-command"),z(d,"class","prompt-instruction"),z(s,"class","prompt-instructions")},m(p,m){Se(e,p,m),W(p,r,m),Se(n,p,m),W(p,i,m),W(p,s,m),R(s,o),R(s,a),R(s,l),R(s,u),R(s,c),R(s,h),R(s,d),R(d,g),R(d,_),y.m(d,null),w=!0},p(p,[m]){let v={};m&2&&(v.initialValue=p[1]),e.$set(v);let x={};m&524344&&(x.$$scope={dirty:m,ctx:p}),n.$set(x),f!==(f=b(p,m))&&(y.d(1),y=f(p),y&&(y.c(),y.m(d,null)))},i(p){w||(J(e.$$.fragment,p),J(n.$$.fragment,p),w=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),w=!1},d(p){_e(e,p),p&&H(r),_e(n,p),p&&H(i),p&&H(s),y.d()}}}function Fy(t,e,r){let n=t.find(i=>i.offset>e);return n?t.filter(i=>i.offset>e&&i.offset<=n.offset+r):[]}function Ey(t,e,r){let{modal:n}=e,{parent:i=null}=e,{singleFilePath:s=""}=e,{previousQuery:o}=e,a,l=[],u=0,c,h;Dr(()=>{G.enable("infile"),G.on("infile","enter",w),G.on("infile","arrow-up",()=>g(-1)),G.on("infile","arrow-down",()=>g(1)),G.on("infile","tab",b)}),Or(()=>{G.disable("infile")});function d(p){let m=[],v=-1,x=0;for(;;){let j=Fy(p,v,Jr);if(!j.length||(v=j.last().offset,m.push(j),++x>100))break}return m}function g(p){r(5,u=Hn(u+p,l.length)),_()}async function _(){await ct(),document.querySelector(`[data-result-id="${u}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}async function w(p){if(c){n.close(),i&&i.close(),await Gn(c,p?.ctrlKey);let m=app.workspace.getActiveViewOfType(_c.MarkdownView);if(!m)return;let v=l[u]??0,x=m.editor.offsetToPos(v);x.ch=0,m.editor.setCursor(x),m.editor.scrollIntoView({from:{line:x.line-10,ch:0},to:{line:x.line+10,ch:0}})}}function b(){new Wt(app,o).open(),n.close()}let f=p=>r(2,a=p.detail),y=(p,m)=>r(5,u=p);return t.$$set=p=>{"modal"in p&&r(7,n=p.modal),"parent"in p&&r(0,i=p.parent),"singleFilePath"in p&&r(8,s=p.singleFilePath),"previousQuery"in p&&r(1,o=p.previousQuery)},t.$$.update=()=>{if(t.$$.dirty&2){e:r(2,a=o??"")}if(t.$$.dirty&772){e:(async()=>{a&&(r(9,h=new zt(a)),r(3,c=(await de.getSuggestions(h,{singleFilePath:s}))[0]??null)),r(5,u=0),await _()})()}if(t.$$.dirty&8){e:if(c){let p=d(c.matches);r(4,l=p.map(m=>Math.round((m.first().offset+m.last().offset)/2)))}}},[i,o,a,c,l,u,w,n,s,h,f,y]}var wc=class extends ge{constructor(e){super();be(this,e,Ey,Cy,he,{modal:7,parent:0,singleFilePath:8,previousQuery:1})}},jc=wc;var to=class extends Ac.Modal{constructor(e){super(e);this.modalEl.replaceChildren(),this.modalEl.addClass("omnisearch-modal","prompt"),this.modalEl.removeClass("modal"),this.modalEl.tabIndex=-1,this.scope.register([],"ArrowDown",r=>{r.preventDefault(),G.emit("arrow-down")}),this.scope.register([],"ArrowUp",r=>{r.preventDefault(),G.emit("arrow-up")});for(let r of[{k:"J",dir:"down"},{k:"K",dir:"up"}])for(let n of["Ctrl","Mod"])this.scope.register([n],r.k,i=>{this.app.vault.getConfig("vimMode")&&G.emit("arrow-"+r.dir)});for(let r of[{k:"N",dir:"down"},{k:"P",dir:"up"}])for(let n of["Ctrl","Mod"])this.scope.register([n],r.k,i=>{this.app.vault.getConfig("vimMode")&&G.emit("arrow-"+r.dir)});this.scope.register(["Mod"],"Enter",r=>{r.preventDefault(),G.emit("open-in-new-pane")}),this.scope.register(["Alt"],"Enter",r=>{r.preventDefault(),G.emit("insert-link")}),this.scope.register(["Shift"],"Enter",r=>{r.preventDefault(),G.emit("create-note")}),this.scope.register(["Ctrl","Shift"],"Enter",r=>{r.preventDefault(),G.emit("create-note",{newLeaf:!0})}),this.scope.register([],"Enter",r=>{ba()||(r.preventDefault(),G.emit("enter"))}),this.scope.register([],"Tab",r=>{r.preventDefault(),G.emit("tab")}),this.scope.register(["Alt"],"ArrowDown",r=>{r.preventDefault(),G.emit("next-search-history")}),this.scope.register(["Alt"],"ArrowUp",r=>{r.preventDefault(),G.emit("prev-search-history")}),this.scope.register(["Ctrl"],"H",r=>{G.emit(Kn.ToggleExcerpts)})}},Wt=class extends to{constructor(e,r){super(e);let n=new gc({target:this.modalEl,props:{modal:this,previousQuery:r}});this.onClose=()=>{n.$destroy()}}},Sr=class extends to{constructor(e,r,n="",i){super(e);let s=new jc({target:this.modalEl,props:{modal:this,singleFilePath:r.path,parent:i,previousQuery:n}});i&&i.containerEl.toggleVisibility(!1),this.onClose=()=>{i&&i.containerEl.toggleVisibility(!0),s.$destroy()}}};var Sc=!1,yi=[];function Ty(t){return t.map(e=>{let{score:r,path:n,basename:i,foundWords:s,matches:o,content:a}=e,l=cr(a,o[0]?.offset??-1);return{score:r,path:n,basename:i,foundWords:s,matches:o.map(u=>({match:u.match,offset:u.offset})),excerpt:l}})}async function Dy(t){let e=new zt(t),r=await de.getSuggestions(e);return Ty(r)}function Oy(t){yi.push(t),Sc&&t()}function ky(t){yi=yi.filter(e=>e!==t)}function Cc(){Sc=!0,yi.forEach(t=>t())}var ro={search:Dy,registerOnIndexed:Oy,unregisterOnIndexed:ky,refreshIndex:mi};var no=class extends Cr.Plugin{async onload(){await ha(this),await Iy(),await ur.clearOldDatabases(),Py(this),P.ribbonIcon&&this.addRibbonButton(),this.addSettingTab(new bs(this)),G.disable("vault"),G.disable("infile"),G.on("global",Kn.ToggleExcerpts,()=>{Kt.set(!P.showExcerpt)}),this.addCommand({id:"show-modal",name:"Vault search",callback:()=>{new Wt(app).open()}}),this.addCommand({id:"show-modal-infile",name:"In-file search",editorCallback:(e,r)=>{r.file&&new Sr(app,r.file).open()}}),app.workspace.onLayoutReady(async()=>{this.registerEvent(this.app.vault.on("create",e=>{en(e.path)&&de.addFromPaths([e.path])})),this.registerEvent(this.app.vault.on("delete",e=>{pe.removeFromLiveCache(e.path),de.removeFromPaths([e.path])})),this.registerEvent(this.app.vault.on("modify",async e=>{en(e.path)&&(await pe.addToLiveCache(e.path),ac(e))})),this.registerEvent(this.app.vault.on("rename",async(e,r)=>{en(e.path)&&(pe.removeFromLiveCache(r),pe.addToLiveCache(e.path),de.removeFromPaths([r]),await de.addFromPaths([e.path]))})),this.executeFirstLaunchTasks(),await this.populateIndex()})}executeFirstLaunchTasks(){let e="1.10.1";if(P.welcomeMessage!==e){let r=new DocumentFragment;r.createSpan({},n=>{n.innerHTML="\u{1F50E} Omnisearch now requires the <strong>Text Extractor</strong> plugin to index PDF and images. See Omnisearch settings for more information."}),new Cr.Notice(r,2e4)}P.welcomeMessage=e,this.saveData(P)}async onunload(){delete globalThis.omnisearch,await Re.clearCache()}addRibbonButton(){this.ribbonButton=this.addRibbonIcon("search","Omnisearch",e=>{new Wt(app).open()})}removeRibbonButton(){this.ribbonButton&&this.ribbonButton.parentNode?.removeChild(this.ribbonButton)}async populateIndex(){console.time("Omnisearch - Indexing total time"),vt.set(Le.ReadingFiles);let e=app.vault.getFiles().filter(n=>en(n.path));console.log(`Omnisearch - ${e.length} files total`),console.log(`Omnisearch - Cache is ${yt()?"enabled":"disabled"}`),yt()&&(console.time("Omnisearch - Loading index from cache"),vt.set(Le.LoadingCache),await de.loadCache()&&console.timeEnd("Omnisearch - Loading index from cache"));let r=de.getDiff(e.map(n=>({path:n.path,mtime:n.stat.mtime})));yt()&&(r.toAdd.length&&console.log("Omnisearch - Total number of files to add/update: "+r.toAdd.length),r.toRemove.length&&console.log("Omnisearch - Total number of files to remove: "+r.toRemove.length)),r.toAdd.length>=1e3&&yt()&&new Cr.Notice(`Omnisearch - ${r.toAdd.length} files need to be indexed. Obsidian may experience stutters and freezes during the process`,1e4),vt.set(Le.IndexingFiles),de.removeFromPaths(r.toRemove.map(n=>n.path)),await de.addFromPaths(r.toAdd.map(n=>n.path)),(r.toRemove.length||r.toAdd.length)&&yt()&&(vt.set(Le.WritingCache),P.useCache=!1,ye(this),await de.writeToCache(),P.useCache=!0,ye(this)),console.timeEnd("Omnisearch - Indexing total time"),r.toAdd.length>=1e3&&new Cr.Notice("Omnisearch - Your files have been indexed."),vt.set(Le.Done),Cc()}};async function Iy(){let t=[`${app.vault.configDir}/plugins/omnisearch/searchIndex.json`,`${app.vault.configDir}/plugins/omnisearch/notesCache.json`,`${app.vault.configDir}/plugins/omnisearch/notesCache.data`,`${app.vault.configDir}/plugins/omnisearch/searchIndex.data`,`${app.vault.configDir}/plugins/omnisearch/historyCache.json`,`${app.vault.configDir}/plugins/omnisearch/pdfCache.data`];for(let e of t)if(await app.vault.adapter.exists(e))try{await app.vault.adapter.remove(e)}catch{}}function Py(t){t.registerObsidianProtocolHandler("omnisearch",e=>{new Wt(app,e.query).open()}),globalThis.omnisearch=ro,app.plugins.plugins.omnisearch.api=ro}
